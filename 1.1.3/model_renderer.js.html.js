tui.util.defineNamespace("fedoc.content", {});
fedoc.content["model_renderer.js.html"] = "      <div id=\"main\" class=\"main\">\n\n\n\n    \n    <section>\n        <article>\n            <pre class=\"prettyprint source linenums\"><code>/**\n * @fileoverview Rendering 모델\n * @author NHN Ent. FE Development Team\n */\n'use strict';\n\nvar Model = require('../base/model');\nvar RowList = require('./rowList');\nvar renderStateMap = require('../common/constMap').renderState;\n\n/**\n * View 에서 Rendering 시 사용할 객체\n * @module model/renderer\n * @extends module:base/model\n */\nvar Renderer = Model.extend(/**@lends module:model/renderer.prototype */{\n    /**\n     * @constructs\n     * @param {Object} attrs - Attributes\n     * @param {Object} options - Options\n     */\n    initialize: function(attrs, options) {\n        var lside, rside, rowListOptions;\n\n        this.setOwnProperties({\n            dataModel: options.dataModel,\n            columnModel: options.columnModel,\n            dimensionModel: options.dimensionModel,\n            timeoutIdForRefresh: 0,\n            isColumnModelChanged: false\n        });\n        rowListOptions = {\n            dataModel: this.dataModel,\n            columnModel: this.columnModel\n        };\n\n        lside = new RowList([], rowListOptions);\n        rside = new RowList([], rowListOptions);\n        this.set({\n            lside: lside,\n            rside: rside\n        });\n\n        this.listenTo(this.columnModel, 'all', this._onColumnModelChange)\n            .listenTo(this.dataModel, 'add remove sort reset', this._onRowListChange)\n            .listenTo(this.dataModel, 'beforeReset', this._onBeforeResetData)\n            .listenTo(lside, 'valueChange', this._executeRelation)\n            .listenTo(rside, 'valueChange', this._executeRelation)\n            .listenTo(this.dimensionModel, 'change:width', this._updateMaxScrollLeft)\n            .listenTo(this.dimensionModel, 'change:totalRowHeight change:scrollBarSize change:bodyHeight',\n                this._updateMaxScrollTop);\n\n        if (this.get('showDummyRows')) {\n            this.listenTo(this.dimensionModel, 'change:displayRowCount', this._resetDummyRows);\n        }\n\n        this._updateMaxScrollLeft();\n    },\n\n    defaults: {\n        top: 0,\n        scrollTop: 0,\n        scrollLeft: 0,\n        maxScrollLeft: 0,\n        maxScrollTop: 0,\n        startIndex: 0,\n        endIndex: 0,\n        startNumber: 1,\n        lside: null,\n        rside: null,\n        showDummyRows: false,\n        dummyRowCount: 0,\n\n        // text that will be shown if no data to render (custom value set by user)\n        emptyMessage: null,\n\n        // constMap.renderState\n        state: renderStateMap.EMPTY\n    },\n\n    /**\n     * Event handler for 'chage:width' event on Dimension.\n     * @private\n     */\n    _updateMaxScrollLeft: function() {\n        var dimension = this.dimensionModel,\n            maxScrollLeft = dimension.getFrameWidth('R') - dimension.get('rsideWidth') +\n                dimension.getScrollYWidth();\n\n        this.set('maxScrollLeft', maxScrollLeft);\n    },\n\n    /**\n     * Event handler to reset 'maxScrollTop' attribute.\n     * @private\n     */\n    _updateMaxScrollTop: function() {\n        var dimension = this.dimensionModel,\n            maxScrollTop = dimension.get('totalRowHeight') - dimension.get('bodyHeight') +\n                dimension.get('scrollBarSize');\n\n        this.set('maxScrollTop', maxScrollTop);\n    },\n\n    /**\n     * Event handler for 'beforeReset' event on dataModel\n     * @private\n     */\n    _onBeforeResetData: function() {\n        this.set('state', renderStateMap.LOADING);\n    },\n\n    /**\n     * Initializes own properties.\n     * (called by module:addon/net)\n     */\n    initializeVariables: function() {\n        this.set({\n            top: 0,\n            scrollTop: 0,\n            scrollLeft: 0,\n            startIndex: 0,\n            endIndex: 0,\n            startNumber: 1\n        });\n    },\n\n    /**\n     * 열고정 영역 또는 열고정이 아닌 영역에 대한 Render Collection 을 반환한다.\n     * @param {String} [whichSide='R']    어느 영역인지 여부. 'L|R' 중에 하나의 값을 넘긴다.\n     * @returns {Object} collection  해당 영역의 랜더 데이터 콜랙션\n     */\n    getCollection: function(whichSide) {\n        return this.get(tui.util.isString(whichSide) ? whichSide.toLowerCase() + 'side' : 'rside');\n    },\n\n    /**\n     * Data.ColumnModel 이 변경되었을 때 열고정 영역 frame, 열고정 영역이 아닌 frame 의 list 를 재생성 하기 위한 이벤트 핸들러\n     * @private\n     */\n    _onColumnModelChange: function() {\n        this.set({\n            scrollTop: 0,\n            top: 0,\n            startIndex: 0,\n            endIndex: 0\n        });\n        this.isColumnModelChanged = true;\n        clearTimeout(this.timeoutIdForRefresh);\n        this.timeoutIdForRefresh = setTimeout($.proxy(this.refresh, this), 0);\n    },\n\n    /**\n     * Data.RowList 가 변경되었을 때 열고정 영역 frame, 열고정 영역이 아닌 frame 의 list 를 재생성 하기 위한 이벤트 핸들러\n     * @private\n     */\n    _onRowListChange: function() {\n        clearTimeout(this.timeoutIdForRefresh);\n        this.timeoutIdForRefresh = setTimeout($.proxy(this.refresh, this, true), 0);\n    },\n\n    /**\n     * Resets dummy rows and trigger 'rowListChanged' event.\n     * @private\n     */\n    _resetDummyRows: function() {\n        this._clearDummyRows();\n        this._fillDummyRows();\n        this.trigger('rowListChanged');\n    },\n\n    /**\n     * rendering 할 index 범위를 결정한다.\n     * Smart rendering 을 사용하지 않을 경우 전체 범위로 랜더링한다.\n     * @private\n     */\n    _setRenderingRange: function() {\n        this.set({\n            startIndex: 0,\n            endIndex: this.dataModel.length - 1\n        });\n    },\n\n    /**\n     * Returns the new data object for rendering based on rowDataModel and specified column names.\n     * @param  {Object} rowDataModel - Instance of module:model/data/row\n     * @param  {Array.&lt;String>} columnNames - Column names\n     * @param  {Number} rowNum - Row number\n     * @returns {Object} - view data object\n     * @private\n     */\n    _createViewDataFromDataModel: function(rowDataModel, columnNames, rowNum) {\n        var viewData = {\n            rowKey: rowDataModel.get('rowKey'),\n            _extraData: rowDataModel.get('_extraData')\n        };\n\n        _.each(columnNames, function(columnName) {\n            var value = rowDataModel.get(columnName);\n            if (columnName === '_number') {\n                value = rowNum;\n            }\n            viewData[columnName] = value;\n        });\n\n        return viewData;\n    },\n\n    /**\n     * Returns the object that contains two array of column names splitted by columnFixCount.\n     * @returns {{lside: Array, rside: Array}} - Column names map\n     * @private\n     */\n    _getColumnNamesOfEachSide: function() {\n        var columnFixCount = this.columnModel.getVisibleColumnFixCount(true),\n            columnModels = this.columnModel.getVisibleColumnModelList(null, true),\n            columnNames = _.pluck(columnModels, 'columnName');\n\n        return {\n            lside: columnNames.slice(0, columnFixCount),\n            rside: columnNames.slice(columnFixCount)\n        };\n    },\n\n    /**\n     * Resets specified view model list.\n     * @param  {String} attrName - 'lside' or 'rside'\n     * @param  {Object} viewData - Converted data for rendering view\n     * @private\n     */\n    _resetViewModelList: function(attrName, viewData) {\n        this.get(attrName).clear().reset(viewData, {\n            parse: true\n        });\n    },\n\n    /**\n     * Resets both sides(lside, rside) of view model list with given range of data model list.\n     * @param  {Number} startIndex - Start index\n     * @param  {Number} endIndex - End index\n     * @private\n     */\n    _resetAllViewModelListWithRange: function(startIndex, endIndex) {\n        var columnNamesMap = this._getColumnNamesOfEachSide(),\n            rowNum = this.get('startNumber') + startIndex,\n            lsideData = [],\n            rsideData = [],\n            rowDataModel, i;\n\n        for (i = startIndex; i &lt;= endIndex; i += 1) {\n            rowDataModel = this.dataModel.at(i);\n            lsideData.push(this._createViewDataFromDataModel(rowDataModel, columnNamesMap.lside, rowNum));\n            rsideData.push(this._createViewDataFromDataModel(rowDataModel, columnNamesMap.rside));\n            rowNum += 1;\n        }\n\n        this._resetViewModelList('lside', lsideData);\n        this._resetViewModelList('rside', rsideData);\n    },\n\n    /**\n     * Returns the count of rows (except dummy rows) in view model list\n     * @returns {Number} Count of rows\n     * @private\n     */\n    _getActualRowCount: function() {\n        return this.get('endIndex') - this.get('startIndex') + 1;\n    },\n\n    /**\n     * Removes all dummy rows in the view model list.\n     * @private\n     */\n    _clearDummyRows: function() {\n        var dataRowCount = this.get('endIndex') - this.get('startIndex') + 1;\n\n        _.each(['lside', 'rside'], function(attrName) {\n            var rowList = this.get(attrName);\n            while (rowList.length > dataRowCount) {\n                rowList.pop();\n            }\n        }, this);\n    },\n\n    /**\n     * fills the empty area with dummy rows.\n     * @private\n     */\n    _fillDummyRows: function() {\n        var displayRowCount = this.dimensionModel.get('displayRowCount'),\n            actualRowCount = this._getActualRowCount(),\n            dummyRowCount = Math.max(displayRowCount - actualRowCount, 0);\n\n        _.times(dummyRowCount, function() {\n            this.get('lside').add({});\n            this.get('rside').add({});\n        }, this);\n        this.set('dummyRowCount', dummyRowCount);\n    },\n\n    /**\n     * Refreshes the rendering range and the list of view models, and triggers events.\n     * @param {Boolean} isDataModelChanged - The boolean value whether dataModel has changed\n     */\n    refresh: function(isDataModelChanged) {\n        var startIndex, endIndex, i;\n\n        this._setRenderingRange(this.get('scrollTop'));\n        startIndex = this.get('startIndex');\n        endIndex = this.get('endIndex');\n\n        this._resetAllViewModelListWithRange(startIndex, endIndex);\n        if (this.get('showDummyRows')) {\n            this._fillDummyRows();\n        }\n\n        for (i = startIndex; i &lt;= endIndex; i += 1) {\n            this._executeRelation(i);\n        }\n\n        if (this.isColumnModelChanged) {\n            this.trigger('columnModelChanged');\n            this.isColumnModelChanged = false;\n        } else {\n            this.trigger('rowListChanged', isDataModelChanged);\n        }\n        this._refreshState();\n        this.trigger('refresh');\n    },\n\n    /**\n     * Set state value based on the DataModel.length\n     * @private\n     */\n    _refreshState: function() {\n        if (this.dataModel.length) {\n            this.set('state', renderStateMap.DONE);\n        } else {\n            this.set('state', renderStateMap.EMPTY);\n        }\n    },\n\n    /**\n     * columnName 으로 lside 와 rside rendering collection 중 하나를 반환한다.\n     * @param {String} columnName   컬럼명\n     * @returns {Collection} 컬럼명에 해당하는 영역의 콜랙션\n     * @private\n     */\n    _getCollectionByColumnName: function(columnName) {\n        var lside = this.get('lside'),\n            collection;\n\n        if (lside.at(0) &amp;&amp; lside.at(0).get(columnName)) {\n            collection = lside;\n        } else {\n            collection = this.get('rside');\n        }\n        return collection;\n    },\n\n    /**\n     * 셀 데이터를 반환한다.\n     * @param {number} rowKey   데이터의 키값\n     * @param {String} columnName   컬럼명\n     * @returns {object} cellData 셀 데이터\n     * @example\n     =>\n     {\n         rowKey: rowKey,\n         columnName: columnName,\n         value: value,\n         rowSpan: rowSpanData.count,\n         isMainRow: rowSpanData.isMainRow,\n         mainRowKey: rowSpanData.mainRowKey,\n         isEditable: isEditable,\n         isDisabled: isDisabled,\n         optionList: [],\n         className: row.getClassNameList(columnName).join(' '),\n         changed: []    //변경된 프로퍼티 목록들\n     }\n     */\n    getCellData: function(rowKey, columnName) {\n        var collection = this._getCollectionByColumnName(columnName),\n            row = collection.get(rowKey);\n        if (row) {\n            return row.get(columnName);\n        }\n    },\n\n    /**\n     * Executes the relation of the row identified by rowIndex\n     * @param {Number} rowIndex - Row index\n     * @private\n     */\n    _executeRelation: function(rowIndex) {\n        var row = this.dataModel.at(rowIndex),\n            renderIdx = rowIndex - this.get('startIndex'),\n            rowModel, relationResult;\n\n        relationResult = row.getRelationResult();\n\n        _.each(relationResult, function(changes, columnName) {\n            rowModel = this._getCollectionByColumnName(columnName).at(renderIdx);\n            if (rowModel) {\n                rowModel.setCell(columnName, changes);\n            }\n        }, this);\n    },\n\n    /**\n     * Destroys itself\n     * @private\n     */\n    _destroy: function() {\n        clearTimeout(this.timeoutIdForRefresh);\n    }\n});\n\nmodule.exports = Renderer;\n</code></pre>\n        </article>\n    </section>\n\n\n\n</div>\n\n"