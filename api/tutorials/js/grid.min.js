/*!grid v1.0.2a | NHN Ent. FE Development Team*/
!function(){var a={CellFactory:null,Layout:{},Layer:{},Painter:{Row:null,Cell:{}}},b={},c={},d={},e={},f=function(a){_.each(a,function(a,b){this[b]=a},this)};b.Base=Backbone.Model.extend({initialize:function(a){var b=a&&a.grid||this.collection&&this.collection.grid||null;this.setOwnProperties({grid:b})},setOwnProperties:f}),d.Base=Backbone.Collection.extend({initialize:function(a,b){var c=b&&b.grid||this.collection&&this.collection.grid||null;this.setOwnProperties({grid:c})},clear:function(){return this.each(function(a){a.stopListening(),a=null}),this.reset([],{silent:!0}),this},setOwnProperties:f}),a.Base=Backbone.View.extend({initialize:function(a){var b=a&&a.grid||this.collection&&this.collection.grid||null;this.setOwnProperties({grid:b,_viewList:[]})},error:function(a){var b=function(){this.name="Grid Exception",this.message=a||"error"};return b.prototype=new Error,new b},setOwnProperties:f,createView:function(a,b){var c=new a(b);return this.addView(c),c},addView:function(a){return this.hasOwnProperty("_viewList")||this.setOwnProperties({_viewList:[]}),this._viewList.push(a),a},destroy:function(){this.stopListening(),this.destroyChildren(),this.remove()},createEventData:function(a){var b=$.extend({},a);return b.stop=function(){this._isStopped=!0},b.isStopped=function(){return this._isStopped},b._isStopped=b._isStopped||!1,b},destroyChildren:function(){if(this._viewList instanceof Array)for(;0!==this._viewList.length;)this._viewList.pop().destroy()}}),a.Base.Painter=a.Base.extend({eventHandler:{},initialize:function(){a.Base.prototype.initialize.apply(this,arguments),this.initializeEventHandler()},initializeEventHandler:function(){var a={};_.each(this.eventHandler,function(b,c){var d=c.split(" "),e=d[0],f=d[1]||"";a[e]={selector:f,handler:$.proxy(this[b],this)}},this),this.setOwnProperties({_eventHandler:a})},getEventHandlerInfo:function(){return this._eventHandler},getHtml:function(){throw this.error("implement getHtml() method")}});var g={uniqueId:0,getAttributesString:function(a){var b="";return _.each(a,function(a,c){b+=" "+c+'="'+a+'"'},this),b},template:function(a,b){var c,d=[];return ne.util.isArray(b)||(b=[b]),ne.util.forEach(b,function(b){c=a.replace(/<%=([^%]+)%>/g,function(a,c){return b[c]?b[c].toString():""}),d.push(c)}),d},sum:function(a){return _.reduce(a,function(a,b){return a+=b},0)},getHeight:function(a,b){return 0===a?a:a*(b+1)+1},getDisplayRowCount:function(a,b){return Math.ceil((a-1)/(b+1))},getRowHeight:function(a,b){return 0===a?0:Math.floor((b-1)/a)-1},isEqual:function(a,b){var c,d=function(a,b){var c,d=!0;for(c in a)if(a[c]!==b[c]){d=!1;break}return d};return typeof a!=typeof b?!1:ne.util.isArray(a)&&a.length!==b.length?!1:"object"==typeof a?(c=!d(a,b)||!d(b,a),!c):a!==b?!1:!0},isBlank:function(a){return ne.util.isString(a)?!a.length:void 0===a||null===a},stripTags:function(a){var b;return a=a.replace(/[\n\r\t]/g,""),ne.util.hasEncodableString(a)&&(/<img/i.test(a)?(b=a.match(/<img[^>]*\ssrc=[\"']?([^>\"']+)[\"']?[^>]*>/i),a=b?b[1]:""):a=a.replace(/<button.*?<\/button>/gi,""),a=$.trim(ne.util.decodeHTMLEntity(a.replace(/<\/?(?:h[1-5]|[a-z]+(?:\:[a-z]+)?)[^>]*>/gi,"")))),a},getUniqueKey:function(){return++this.uniqueId},toQueryString:function(a){var b=[];return ne.util.forEach(a,function(a,c){"string"!=typeof a&&"number"!=typeof a&&(a=$.toJSON(a)),a=encodeURIComponent(a),b.push(c+"="+a)},this),b.join("&")},toQueryObject:function(a){var b=a.split("&"),c={};return ne.util.forEach(b,function(a){var b,d,e=a.split("=");b=e[0],d=decodeURIComponent(e[1]);try{d=$.parseJSON(d)}catch(f){}c[b]=d},this),c},convertValueType:function(a,b){return"string"===b?a.toString():"number"===b?+a:a},form:{setInput:{_changeToStringInArray:function(a){return ne.util.forEach(a,function(b,c){a[c]=String(b)},this),a},radio:function(a,b){a.checked=a.value===b},checkbox:function(a,b){ne.util.isArray(b)?a.checked=-1!==$.inArray(a.value,this._changeToStringInArray(b)):a.checked=a.value===b},"select-one":function(a,b){var c=ne.util.toArray(a.options),d=-1;ne.util.forEach(c,function(a,c){return a.value===b||a.text===b?(d=c,!1):void 0},this),a.selectedIndex=d},"select-multiple":function(a,b){var c=ne.util.toArray(a.options);ne.util.isArray(b)?(b=this._changeToStringInArray(b),ne.util.forEach(c,function(a){a.selected=-1!==$.inArray(a.value,b)||-1!==$.inArray(a.text,b)},this)):this["select-one"].apply(this,arguments)},defaultAction:function(a,b){a.value=b}},getFormData:function(a){var b={},c=a.serializeArray();return ne.util.forEach(c,function(a){var c=a.value,d=a.name;ne.util.isExisty(b[d])?(b[d].push||(b[d]=[b[d]]),b[d].push(c||"")):b[d]=c||""},this),b},getFormElement:function(a,b){var c;return a&&a.length&&(c=b?a.prop("elements")[b+""]:a.prop("elements")),$(c)},setFormData:function(a,b){ne.util.forEachOwnProperties(b,function(b,c){this.setFormElementValue(a,c,b)},this)},setFormElementValue:function(a,b,c){var d,e=this.getFormElement(a,b);e&&(ne.util.isArray(c)||(c=String(c)),e=ne.util.isHTMLTag(e)?[e]:e,e=ne.util.toArray(e),ne.util.forEach(e,function(a){d=this.setInput[a.type]?a.type:"defaultAction",this.setInput[d](a,c)},this))},setCursorToEnd:function(a){var b,c=a.value.length;if(a.focus(),a.setSelectionRange)try{a.setSelectionRange(c,c)}catch(d){}else if(a.createTextRange){b=a.createTextRange(),b.collapse(!0),b.moveEnd("character",c),b.moveStart("character",c);try{b.select()}catch(d){}}}}};c.ColumnModel=b.Base.extend({defaults:{keyColumnName:null,columnFixIndex:0,columnModelList:[],visibleList:[],hasNumberColumn:!0,selectType:"",columnModelMap:{},relationListMap:{}},initialize:function(){b.Base.prototype.initialize.apply(this,arguments),this.textType={normal:!0,text:!0,"text-password":!0,"text-convertible":!0},this._setColumnModelList(this.get("columnModelList"),this.get("columnFixIndex")),this.on("change",this._onChange,this)},_initializeNumberColumn:function(a){var b=this.get("hasNumberColumn"),c={columnName:"_number",title:"No.",width:60};return b||(c.isHidden=!0),a=this._extendColumn(c,a)},_initializeButtonColumn:function(a){var b=this.get("selectType"),c={columnName:"_button",isHidden:!1,editOption:{type:b,list:[{value:"selected"}]},width:50};return"checkbox"===b?c.title='<input type="checkbox"/>':"radio"===b?c.title="선택":c.isHidden=!0,a=this._extendColumn(c,a)},_extendColumn:function(a,b){var c;return ne.util.isUndefined(a)||ne.util.isUndefined(a.columnName)||(c=this._indexOfColumnName(a.columnName,b),-1===c?b=_.union([a],b):b[c]=$.extend(b[c],a)),b},at:function(a,b){var c=b?this.getVisibleColumnModelList():this.get("columnModelList");return c[a]},indexOfColumnName:function(a,b){b=void 0===b?!0:b;var c=b?this.getVisibleColumnModelList():this.get("columnModelList");return this._indexOfColumnName(a,c)},_indexOfColumnName:function(a,b){for(var c=0,d=b.length;d>c;c++)if(b[c].columnName===a)return c;return-1},isLside:function(a){var b=this.indexOfColumnName(a,!0);return 0>b?!1:this.get("columnFixIndex")>b},getVisibleColumnModelList:function(a){a=a?a.toUpperCase():void 0;var b=[],c=this.get("columnFixIndex");return b="L"===a?this.get("visibleList").slice(0,c):"R"===a?this.get("visibleList").slice(c):this.get("visibleList")},getColumnModel:function(a){return this.get("columnModelMap")[a]},isTextType:function(a){return!!this.textType[this.getEditType(a)]},getEditType:function(a){var b=this.getColumnModel(a),c="normal";return"_button"===a||"_number"===a?c=a:b&&b.editOption&&b.editOption.type&&(c=b.editOption.type),c},_getVisibleList:function(a){return _.filter(a,function(a){return!a.isHidden})},_getRelationListMap:function(a){var b,c={};return ne.util.forEachArray(a,function(a){b=a.columnName,a.relationList&&(c[b]=a.relationList)}),c},getIngoredColumnNameList:function(){var a=this.get("columnModelList"),b=[];return _.each(a,function(a){a.isIgnore&&b.push(a.columnName)}),b},_setColumnModelList:function(a,b){a=$.extend(!0,[],a),a=this._initializeNumberColumn(this._initializeButtonColumn(a));var c=this._getVisibleList(a);this.set({columnModelList:a,columnModelMap:_.indexBy(a,"columnName"),relationListMap:this._getRelationListMap(a),columnFixIndex:b,visibleList:c},{silent:!0}),this.trigger("columnModelChange")},_onChange:function(a){var b=a.changed,c=b.columnModelList||this.get("columnModelList"),d=b.columnFixIndex?b.columnFixIndex:this.get("columnFixIndex");this._setColumnModelList(c,d)}}),c.Row=b.Base.extend({idAttribute:"rowKey",defaults:{_extraData:{rowState:null}},initialize:function(){b.Base.prototype.initialize.apply(this,arguments)},getRowState:function(){var a=this.get("_extraData"),b=a&&a.rowState,c=!1,d=!1,e=!1;return"DISABLED"===b?d=!0:"DISABLED_CHECK"===b?c=!0:"CHECKED"===b&&(e=!0),c=d?d:c,{isDisabled:d,isDisabledCheck:c,isChecked:e}},getClassNameList:function(a){var b,c=[],d=this.grid.columnModel.getColumnModel(a),e=this.get("_extraData"),f=e.className,g=f&&f.row?f.row:[],h=f&&f.column&&f.column[a]?f.column[a]:[],i={},j=[];return d.className&&j.push(d.className),d.isEllipsis&&j.push("ellipsis"),b=[c,g,h,j],ne.util.forEachArray(b,function(a){ne.util.forEachArray(a,function(a){var b=a.slice(" ");ne.util.isArray(b)?ne.util.forEachArray(b,function(a){i[a]=!0}):i[a]=!0})}),ne.util.forEach(i,function(a,b){c.push(b)}),c},getCellState:function(a){var b,c,d=["_number","normal"],e=this.grid.columnModel,f=!1,g=!0,h=e.getEditType(a);return c=this.getRelationResult(["isDisabled","isEditable"])[a],b=this.getRowState(),f="_button"===a?b.isDisabledCheck:b.isDisabled,f=f||!(!c||!c.isDisabled),g=-1!==$.inArray(h,d)?!1:!(c&&c.isEditable===!1),{isEditable:g,isDisabled:f}},isEditable:function(a){var b,c,d=["_number","normal"];return b=this.grid.columnModel.getEditType(a),-1!==$.inArray(b,d)?!1:(c=this.getCellState(a),c.isEditable)},isDisabled:function(a){var b;return b=this.getCellState(a),b.isDisabled},getRowSpanData:function(a){var b=this.get("_extraData");if(this.collection.isRowSpanEnable()){if(!a)return b.rowSpanData;if(b&&b.rowSpanData&&b.rowSpanData[a])return b.rowSpanData[a]}else if(!a)return null;return{count:0,isMainRow:!0,mainRowKey:this.get("rowKey")}},setExtraData:function(a,b){var c=$.extend(!0,{},this.get("_extraData"),a);this.set("_extraData",c,{silent:b})},setRowSpanData:function(a,b){var c,d;if(a)if(ne.util.isFalsy(b)){if(c=this._getExtraDataClone(),!c)return;d=c.rowSpanData,d&&d[a]&&(delete d[a],_.isEmpty(d)&&(c.rowSpanData=null),this.set("_extraData",c))}else d={},d[a]=b,this.setExtraData({rowSpanData:d},!0)},setRowState:function(a,b){this.setExtraData({rowState:a},b)},_getExtraDataClone:function(){return $.extend(!0,{},this.get("_extraData"))},addCellClassName:function(a,b){var c,d,e=this._getExtraDataClone();ne.util.isUndefined(e)||(c=e.className||{},c.column=c.column||{},d=c.column[a]||[],-1===ne.util.inArray(b,d)&&(d.push(b),c.column[a]=d,this.setExtraData({className:c})))},addRowClassName:function(a,b){var c,d,e=this._getExtraDataClone();ne.util.isUndefined(e)||(c=e.className||{},d=c.row||[],-1===ne.util.inArray(b,d)&&(d.push(b),c.row=d,this.setExtraData({className:c})))},removeCellClassName:function(a,b){var c,d=this._getExtraDataClone();ne.util.isExisty(ne.util.pick(d,"className","column",a))&&(c=d.className,c.column[a]=this._removeClassNameFromArray(c.column[a],b),this.set("_extraData",d))},removeRowClassName:function(a,b){var c,d=this._getExtraDataClone();d&&d.className&&d.className.row&&(c=d.className,c.row=this._removeClassNameFromArray(c.row,b),this.set("_extraData",d))},_removeClassNameFromArray:function(a,b){var c=a.join(" ");return a=c.split(" "),_.without(a,b)},getHTMLEncodedString:function(a){var b=this.grid.columnModel.getColumnModel(a),c=this.grid.columnModel.isTextType(a),d=this.get(a),e=b.notUseHtmlEntity;return!e&&c&&ne.util.hasEncodableString(d)&&(d=ne.util.encodeHTMLEntity(d)),d},_getListTypeVisibleText:function(a){var b=this.get(a),c=this.grid.columnModel.getColumnModel(a);if(ne.util.isExisty(ne.util.pick(c,"editOption","list"))){var d,e,f=this.getRelationResult(["optionListChange"])[a],h=f&&f.optionList?f.optionList:c.editOption.list;return d=typeof h[0].value,e=b.toString().split(","),d!==typeof e[0]&&(e=_.map(e,function(a){return g.convertValueType(a,d)})),_.each(e,function(a,b){var c=_.findWhere(h,{value:a});e[b]=c&&c.text||""},this),e.join(",")}},isDuplicatedPublicChanged:function(a){return this._timeoutIdForChanged&&_.isEqual(this._lastPublicChanged,a)?!0:(clearTimeout(this._timeoutIdForChanged),this._timeoutIdForChanged=setTimeout(_.bind(function(){this._timeoutIdForChanged=null},this),10),this._lastPublicChanged=a,!1)},getVisibleText:function(a){var b,c,d=this.grid.columnModel,e=this.get(a),f={select:!0,radio:!0,checkbox:!0};if(d)if(b=d.getEditType(a),c=d.getColumnModel(a),f[b]){if(!ne.util.isExisty(ne.util.pick(c,"editOption","list",0,"value")))throw this.error('Check "'+a+"\"'s editOption.list property out in your ColumnModel.");e=this._getListTypeVisibleText(a)}else _.isFunction(c.formatter)&&(e=g.stripTags(c.formatter(this.getHTMLEncodedString(a),this.toJSON(),c)));return e=ne.util.isUndefined(e)?e:e.toString()},getRelationResult:function(a){a=a&&a.length?a:["optionListChange","isDisabled","isEditable"];var b,c,d,e,f=(this.get("rowKey"),this.attributes),g=this.grid.columnModel.get("relationListMap"),h={},i=this.getRowState();return _.each(g,function(g,j){e=f[j],_.each(g,function(g){d=g.columnList,_.each(a,function(a){i.isDisabled&&"isDisabled"===a||(b=g[a],"function"==typeof b&&(c="","optionListChange"===a?c="optionList":"isDisabled"===a?c="isDisabled":"isEditable"===a&&(c="isEditable"),c&&_.each(d,function(a){h[a]=h[a]||{},h[a][c]=b(e,f)},this)))},this)},this)},this),h}}),c.RowList=d.Base.extend({model:c.Row,initialize:function(a,b){d.Base.prototype.initialize.apply(this,arguments),this.setOwnProperties({lastRowKey:-1,originalRowList:[],originalRowMap:{},startIndex:b.startIndex||1,privateProperties:["_button","_number","_extraData"],sortOptions:{columnName:"rowKey",isAscending:!0,useClient:ne.util.isBoolean(b.useClientSort)?b.useClientSort:!0}}),this.sortOptions.useClient||(this.comparator=null),this.on("change",this._onChange,this)},parse:function(a){return a=a&&a.contents||a,this._formatData(a)},_formatData:function(a){var b=a;return _.each(b,function(a,c){b[c]=this._baseFormat(b[c]),this.isRowSpanEnable()&&this._setExtraRowSpanData(b,c)},this),b},_baseFormat:function(a){var b={rowSpan:null,rowSpanData:null,rowState:null},c=this.grid.columnModel.get("keyColumnName"),d=null===c?this._createRowKey():a[c];return a._extraData=$.extend(b,a._extraData),a._button="CHECKED"===a._extraData.rowState,a.rowKey=d,a},_createRowKey:function(){return this.lastRowKey+=1,this.lastRowKey},_setExtraRowSpanData:function(a,b){function c(a,b){var c=a._extraData;return!(!c.rowSpanData||!c.rowSpanData[b])}function d(a,b,c){var d=a._extraData;return d.rowSpanData=d&&d.rowSpanData||{},d.rowSpanData[b]=c,d}var e,f,g,h=a[b],i=h&&h._extraData&&h._extraData.rowSpan,j=h&&h.rowKey;return i&&_.each(i,function(i,k){if(!c(h,k))for(d(h,k,{count:i,isMainRow:!0,mainRowKey:j}),e=-1,g=b+1;b+i>g;g++)f=a[g],f[k]=h[k],f._extraData=f._extraData||{},d(f,k,{count:e--,isMainRow:!1,mainRowKey:j})}),a},setOriginalRowList:function(a){return this.originalRowList=a?this._formatData(a):this.toJSON(),this.originalRowMap=_.indexBy(this.originalRowList,"rowKey"),this.originalRowList},getOriginalRowList:function(a){return a=void 0===a?!0:a,a?_.clone(this.originalRowList):this.originalRowList},getOriginalRow:function(a){return _.clone(this.originalRowMap[a])},getOriginal:function(a,b){return _.clone(this.originalRowMap[a][b])},getMainRowKey:function(a,b){var c,d=this.get(a);return this.isRowSpanEnable()&&(c=d&&d.getRowSpanData(b),a=c?c.mainRowKey:a),a},indexOfRowKey:function(a){return this.indexOf(this.get(a))},_isPrivateProperty:function(a){return-1!==$.inArray(a,this.privateProperties)},isRowSpanEnable:function(){return!this.isSortedByField()},isSortedByField:function(){return"rowKey"!==this.sortOptions.columnName},setSortOptionValues:function(a,b,c){var d=this.sortOptions,e=!1;ne.util.isUndefined(a)&&(a="rowKey"),ne.util.isUndefined(b)&&(b=!0),(d.columnName!==a||d.isAscending!==b)&&(e=!0),d.columnName=a,d.isAscending=b,e&&this.trigger("sortChanged",{columnName:a,isAscending:b,isRequireFetch:c})},sortByField:function(a,b){var c=this.sortOptions;ne.util.isUndefined(b)&&(b=c.columnName===a?!c.isAscending:!0),this.setSortOptionValues(a,b,!c.useClient),c.useClient&&this.sort()},getRowList:function(a,b){var c,d;return a?(d=this.where({_button:!0}),c=[],_.each(d,function(a){c.push(a.attributes)},this)):c=this.toJSON(),b?c:this._removePrivateProp(c)},_onChange:function(a){var b,c=_.omit(a.changed,this.privateProperties);a.isDuplicatedPublicChanged(c)||_.each(c,function(c,d){b=this.grid.columnModel.getColumnModel(d),b&&this._executeChangeBeforeCallback(a,d)&&(this._syncRowSpannedData(a,d,c),this._executeChangeAfterCallback(a,d),a.getRowState().isDisabledCheck||b.isIgnore||a.set("_button",!0))},this)},_syncRowSpannedData:function(a,b,c){var d,e,f;if(this.isRowSpanEnable())if(e=a.getRowSpanData(b),e.isMainRow)for(d=this.indexOfRowKey(a.get("rowKey")),f=0;f<e.count-1;f+=1)this.at(f+1+d).set(b,c);else this.get(e.mainRowKey).set(b,c)},_createChangeCallbackEvent:function(a,b){return{rowKey:a.get("rowKey"),columnName:b,value:a.get(b),instance:this.grid.publicInstance}},_executeChangeBeforeCallback:function(a,b){var c,d,e=this.grid.columnModel.getColumnModel(b);return e.editOption&&e.editOption.changeBeforeCallback&&(c=this._createChangeCallbackEvent(a,b),e.editOption.changeBeforeCallback(c)===!1)?(d={},d[b]=a.previous(b),a.set(d),a.trigger("restore",{changed:d}),!1):!0},_executeChangeAfterCallback:function(a,b){var c,d=this.grid.columnModel.getColumnModel(b);return d.editOption&&d.editOption.changeAfterCallback?(c=this._createChangeCallbackEvent(a,b),!!d.editOption.changeAfterCallback(c)):!0},comparator:function(a,b){var c=this.sortOptions.columnName,d=this.sortOptions.isAscending,e=a.get(c),f=b.get(c),g=0;return f>e?g=-1:e>f&&(g=1),d||(g=-g),g},_removePrivateProp:function(a){var b,c=[];return _.each(a,function(a){b={},_.each(a,function(a,c){this._isPrivateProperty(c)||(b[c]=a)},this),c.push(b)},this),c},removeRow:function(a,b){var c,d,e,f=this.get(a);f&&(b&&b.keepRowSpanData&&(e=_.clone(f.attributes)),c=_.clone(f.getRowSpanData()),d=this.at(this.indexOf(f)+1),this.remove(f,{silent:!0}),this._syncRowSpanDataForRemove(c,d,e),b&&b.removeOriginalData&&this.setOriginalRowList(),this.trigger("remove"))},_syncRowSpanDataForRemove:function(a,b,c){a&&_.each(a,function(a,d){var e,f,g,h={};a.isMainRow?(e=b,g=a.count-1,f=1,g>1&&(h.mainRowKey=e.get("rowKey"),h.isMainRow=!0),e.set(d,c?c[d]:"",{silent:!0})):(e=this.get(a.mainRowKey),g=e.getRowSpanData(d).count-1,f=-a.count),g>1?(h.count=g,e.setRowSpanData(d,h),this._updateSubRowSpanData(e,d,f,g)):e.setRowSpanData(d,null)},this)},_createDummyRow:function(){var a=this.grid.columnModel.get("columnModelList"),b={};return _.each(a,function(a){b[a.columnName]=""},this),b},append:function(a,b){var c,d=this._createModelList(a);b=_.extend({at:this.length},b),c={at:b.at,add:!0,silent:!0},this.add(d,c),this._syncRowSpanDataForAppend(b.at,d.length,b.extendPrevRowSpan),this.trigger("add",d,c)},prepend:function(a){this.append(a,{at:0})},_createModelList:function(a){var b,d=[];return a=a||this._createDummyRow(),ne.util.isArray(a)||(a=[a]),b=this._formatData(a),_.each(b,function(a){a._button=!0,d.push(new c.Row(a,{collection:this}))},this),d},_syncRowSpanDataForAppend:function(a,b,c){var d=this.at(a-1);d&&_.each(d.getRowSpanData(),function(a,e){var f,g,h,i;0!==a.count&&(a.isMainRow?(f=d,g=a,h=1):(f=this.get(a.mainRowKey),g=f.getRowSpanData()[e],h=-a.count+1),(g.count>h||c)&&(g.count+=b,i=g.count,this._updateSubRowSpanData(f,e,h,i)))},this)},_updateSubRowSpanData:function(a,b,c,d){var e,f,g=this.indexOf(a),h=a.get("rowKey");for(f=c;d>f;f+=1)e=this.at(g+f),e.set(b,"",{silent:!0}),e.setRowSpanData(b,{count:-f,mainRowKey:h,isMainRow:!1})},getModifiedRowList:function(a){var b,c=a&&a.isRaw,d=a&&a.isOnlyChecked,e=a&&a.isOnlyRowKeyList,f=c?this.originalRowList:this._removePrivateProp(this.originalRowList),g=c?this.toJSON():this._removePrivateProp(this.toJSON()),h={createList:[],updateList:[],deleteList:[]},i={},j=_.union(a&&a.filteringColumnList||[],this.grid.columnModel.getIngoredColumnNameList());return _.each(j,function(a){i[a]=!0}),f=_.indexBy(f,"rowKey"),g=_.indexBy(g,"rowKey"),_.each(g,function(a,c){var g,j=f[c];b=e?a.rowKey:a,(!d||d&&this.get(c).get("_button"))&&(j?_.each(a,function(a,c){i[c]||(g="object"==typeof a?$.toJSON(a)!==$.toJSON(j[c]):a!==j[c],g&&h.updateList.push(b))},this):h.createList.push(b))},this),_.each(f,function(a,c){b=e?a.rowKey:a,g[c]||h.deleteList.push(b)},this),h}}),b.Renderer=b.Base.extend({defaults:{top:0,scrollTop:0,scrollLeft:0,maxScrollLeft:0,startIndex:0,endIndex:0,startNumber:1,lside:null,rside:null},initialize:function(){var a,c;b.Base.prototype.initialize.apply(this,arguments),this.setOwnProperties({timeoutIdForRowListChange:0,timeoutIdForRefresh:0,isColumnModelChanged:!1}),a=new b.RowList([],{grid:this.grid}),c=new b.RowList([],{grid:this.grid}),this.set({lside:a,rside:c}),this.listenTo(this.grid.columnModel,"all",this._onColumnModelChange,this).listenTo(this.grid.dataModel,"add remove sort reset",this._onRowListChange,this).listenTo(a,"valueChange",this._onValueChange,this).listenTo(c,"valueChange",this._onValueChange,this)},_onValueChange:function(a){this.executeRelation(a)},initializeVariables:function(){this.set({top:0,scrollTop:0,$scrollTarget:null,scrollLeft:0,startIndex:0,endIndex:0,startNumber:1})},getCollection:function(a){return this.get(ne.util.isString(a)?a.toLowerCase()+"side":"rside")},_onColumnModelChange:function(){this.set({scrollTop:0,top:0,startIndex:0,endIndex:0}),this.isColumnModelChanged=!0,clearTimeout(this.timeoutIdForRefresh),this.timeoutIdForRefresh=setTimeout($.proxy(this.refresh,this),0)},_onRowListChange:function(){clearTimeout(this.timeoutIdForRefresh),this.timeoutIdForRefresh=setTimeout($.proxy(this.refresh,this,!0),0)},_setRenderingRange:function(){this.set({startIndex:0,endIndex:this.grid.dataModel.length-1})},refresh:function(a){this._setRenderingRange(this.get("scrollTop"));var b,c,d,e,f=this.grid.columnModel.get("columnFixIndex"),g=this.grid.columnModel.get("visibleList"),h=_.pluck(g,"columnName"),i=h.slice(0,f),j=h.slice(f),k=[],l=[],m=[],n=[],o=this.get("startIndex"),p=this.get("endIndex"),q=this.get("startNumber")+o;for(c=o;p+1>c;c+=1)d=this.grid.dataModel.at(c),d&&(e=d.get("rowKey"),m={_extraData:d.get("_extraData"),rowKey:e},n={_extraData:d.get("_extraData"),rowKey:e},_.each(i,function(a){"_number"===a?m[a]=q++:m[a]=d.get(a)}),_.each(j,function(a){"_number"===a?n[a]=q++:n[a]=d.get(a)}),k.push(m),l.push(n));for(this.get("lside").clear().reset(k,{parse:!0}),this.get("rside").clear().reset(l,{parse:!0}),b=l.length+o,c=o;b>c;c+=1)this.executeRelation(c);this.isColumnModelChanged?(this.trigger("columnModelChanged",this.get("top")),this.isColumnModelChanged=!1):this.trigger("rowListChanged",a),this.trigger("refresh",this.get("top"))},_getCollectionByColumnName:function(a){var b=this.get("lside"),c=this.get("rside");return b.at(0)&&b.at(0).get(a)?b:c},getCellData:function(a,b){var c=this._getCollectionByColumnName(b),d=c.get(a);return d?d.get(b):void 0},executeRelation:function(a){var b,c,d=this.grid.dataModel.at(a),e=a-this.get("startIndex");c=d.getRelationResult(),_.each(c,function(a,c){b=this._getCollectionByColumnName(c).at(e),b&&b.setCell(c,a)},this)},_destroy:function(){clearTimeout(this.timeoutIdForRefresh)}}),b.Dimension=b.Base.extend({models:null,columnModel:null,defaults:{offsetLeft:0,offsetTop:0,width:0,headerHeight:0,bodyHeight:0,toolbarHeight:0,rowHeight:0,rsideWidth:0,lsideWidth:0,columnWidthList:[],minimumColumnWidth:0,displayRowCount:1,scrollBarSize:17,scrollX:!0,scrollY:!0},initialize:function(){b.Base.prototype.initialize.apply(this,arguments),this.columnModel=this.grid.columnModel,this.listenTo(this.columnModel,"columnModelChange",this._initColumnWidthVariables),this.on("change:width",this._onWidthChange,this),this.on("change:displayRowCount",this._setBodyHeight,this),this._initColumnWidthVariables(),this._setBodyHeight()},_getAvailableTotalWidth:function(a){var b=this.get("width"),c=b-a-1;return this.get("scrollY")&&(c-=this.get("scrollBarSize")),this.columnModel.get("columnFixIndex")>0&&(c-=1),c},_applyMinimumColumnWidth:function(a){var b=this.get("minimumColumnWidth");_.each(a,function(c,d){b>c&&(a[d]=b)})},_getAssignedColumnWidthList:function(a,b){var c,d=a.length,e=Array(d),f=b,g=[];return _.each(a,function(a,b){a>0?(e[b]=a,f-=a):g.push(b)}),c=Math.round(f/g.length),_.each(g,function(a,b){b===g.length-1?e[a]=f:(e[a]=c,f-=c)}),e},_addExtraColumnWidth:function(a,b,c){var d,e=Math.round(b/c),f=this.get("columnWidthFixedFlags"),g=0;_.each(a,function(h,i){f[i]||(d=g===c-1?b:e,a[i]+=d,b-=d,g+=1)})},_calculateColumnWidthList:function(a){var b=a.length,c=this.get("columnWidthFixedFlags"),d=this._getAvailableTotalWidth(b),e=this._getAssignedColumnWidthList(a,d),f=d,g=0;return _.each(e,function(a,b){f-=a,c[b]||(g+=1)}),f>0&&(g?this._addExtraColumnWidth(e,f,g):e[b-1]+=f),this._applyMinimumColumnWidth(e),e},_initColumnWidthVariables:function(){var a,b=this.columnModel.get("visibleList"),c=[],d=[];_.each(b,function(a){c.push(Math.max(a.width,0)),d.push(a.isFixedWidth)}),this.set("columnWidthFixedFlags",d),a=this._calculateColumnWidthList(c),this._setColumnWidthVariables(a,!0)},getFrameWidth:function(a){var b=this.grid.columnModel.get("columnFixIndex"),c=this.getColumnWidthList(a),d=this._getFrameWidth(c);return ne.util.isUndefined(a)&&b>0&&(d+=1),d},_getFrameWidth:function(a){return a.length?g.sum(a)+a.length+1:0},_setColumnWidthVariables:function(a,b){var c,d,e,f,g=this.get("width"),h=this.columnModel.get("columnFixIndex"),i=this._getMaxLeftSideWidth();e=a.slice(0,h),f=a.slice(h),d=this._getFrameWidth(e),d>i&&(e=this._adjustLeftSideWidthList(e,i),d=this._getFrameWidth(e),a=e.concat(f)),c=g-d,this.set({columnWidthList:a,rsideWidth:c,lsideWidth:d}),b&&this.set("originalWidthList",a),this.trigger("columnWidthChanged")},_getMinLeftSideWidth:function(){var a,b=this.get("minimumColumnWidth"),c=this.columnModel.get("columnFixIndex");return a=c?c*(b+1)+1:0},_getMaxLeftSideWidth:function(){var a=Math.ceil(.9*this.get("width"));return a=Math.max(a,this._getMinLeftSideWidth())},getCellPosition:function(a,b){var c,d,e,f,h,i=0,j=0,k=this.grid.dataModel,l=this.get("rowHeight"),m=k.get(a).getRowSpanData(b),n=this.get("columnWidthList"),o=this.grid.columnModel.get("columnFixIndex"),p=this.grid.columnModel.indexOfColumnName(b,!0),q=1;for(m.isMainRow||(a=m.mainRowKey,m=k.get(a).getRowSpanData(b)),h=m.count||1,f=k.indexOfRowKey(a),c=g.getHeight(f,l),e=c+g.getHeight(h,l)-q,p>=o&&(j=o);p>j;j+=1)i+=n[j]+q;return d=i+n[j]+q,{top:c,left:i,right:d,bottom:e}},_adjustLeftSideWidthList:function(a,b){var c,d=a.length-1,e=this.get("minimumColumnWidth"),f=this._getFrameWidth(a),g=f-b;if(g>0)for(;d>=0&&g>0;)c=Math.max(e,a[d]-g),g-=a[d]-c,a[d]=c,d-=1;else 0>g&&(a[d]+=Math.abs(g));return a},_setBodyHeight:function(){var a=g.getHeight(this.get("displayRowCount"),this.get("rowHeight"));this.get("scrollX")&&(a+=this.get("scrollBarSize")),this.set("bodyHeight",a)},getDisplayRowCount:function(){return g.getDisplayRowCount(this.get("bodyHeight")-this.get("toolbarHeight"),this.get("rowHeight"))},getScrollXHeight:function(){return+this.get("scrollX")*this.get("scrollBarSize")},_onWidthChange:function(){var a=this.get("columnWidthList");this._setColumnWidthVariables(this._calculateColumnWidthList(a))},setColumnWidth:function(a,b){var c=this.get("columnWidthList"),d=this.get("columnWidthFixedFlags");!d[a]&&c[a]&&(c[a]=b,this._setColumnWidthVariables(this._calculateColumnWidthList(c)))},restoreColumnWidth:function(a){var b=this.get("columnWidthList");ne.util.isUndefined(b[a])||(b[a]=this.get("originalWidthList")[a],this._setColumnWidthVariables(b))},setColumnWidthList:function(a,b){var c,d="L"===b?"R":"L",e=this.getColumnWidthList(d)||[];c="L"===b?a.concat(e):"R"===b?e.concat(a):a,this._setColumnWidthVariables(c)},getColumnWidthList:function(a){var b=this.columnModel.get("columnFixIndex"),c=[];switch(a=a?a.toUpperCase():void 0){case"L":c=this.get("columnWidthList").slice(0,b);break;case"R":c=this.get("columnWidthList").slice(b);break;default:c=this.get("columnWidthList")}return c}}),b.Focus=b.Base.extend({defaults:{rowKey:null,columnName:"",prevRowKey:null,prevColumnName:"",scrollX:!0,scrollY:!0,scrollBarSize:17},initialize:function(){b.Base.prototype.initialize.apply(this,arguments)},_savePrevious:function(){null!==this.get("rowKey")&&this.set("prevRowKey",this.get("rowKey")),this.get("columnName")&&this.set("prevColumnName",this.get("columnName"))},_clearPrevious:function(){this.set({prevRowKey:null,prevColumnName:""})},select:function(a){return this.unselect().set("rowKey",a),this.trigger("select",a),this},unselect:function(a){return a&&this.blur(),this.trigger("unselect",this.get("rowKey")),this.set({rowKey:null}),this},focus:function(a,b,c){var d,e=this.get("rowKey");return g.isBlank(a)||g.isBlank(b)?this:(this._savePrevious(),this.blur(),a!==e&&this.select(a),this.set("columnName",b),this.trigger("focus",a,b),c&&(d=this._getScrollPosition(),ne.util.isEmpty(d)||this.grid.renderModel.set(d)),this)},_getScrollPosition:function(){var a=this.which(),b=this.grid.dimensionModel,c=this.grid.renderModel,d=c.get("scrollTop"),e=c.get("scrollLeft"),f=b.get("bodyHeight"),g=(b.get("lsideWidth"),b.get("rsideWidth")),h=b.getCellPosition(a.rowKey,a.columnName),i=e,j=e+g,k=+this.get("scrollX")*this.get("scrollBarSize"),l=+this.get("scrollY")*this.get("scrollBarSize"),m={};return h.top<d?m.scrollTop=h.top:h.bottom>f+d-k&&(m.scrollTop=h.bottom-f+k),this.grid.columnModel.isLside(a.columnName)||(h.left<i?m.scrollLeft=h.left:h.right>j&&(m.scrollLeft=h.right-g+l+1)),m},blur:function(){return this.has()&&(this.trigger("blur",this.get("rowKey"),this.get("columnName")),null!==this.get("rowKey")&&this.set("columnName","")),this},which:function(){return{rowKey:this.get("rowKey"),columnName:this.get("columnName")}},indexOf:function(a){var b=this.get(a?"prevRowKey":"rowKey"),c=this.get(a?"prevColumnName":"columnName");return{rowIdx:this.grid.dataModel.indexOfRowKey(b),columnIdx:this.grid.columnModel.indexOfColumnName(c,!0)}},has:function(){var a=!g.isBlank(this.get("rowKey"))&&!g.isBlank(this.get("columnName"));return a},_findRowKey:function(a){var b,c,d=this.grid.dataModel;return this.has()?(b=Math.max(Math.min(d.indexOfRowKey(this.get("rowKey"))+a,this.grid.dataModel.length-1),0),c=d.at(b),c&&c.get("rowKey")):void 0},_findColumnName:function(a){var b,c=this.grid.columnModel,d=c.getVisibleColumnModelList(),e=c.indexOfColumnName(this.get("columnName"),!0);return this.has()?(b=Math.max(Math.min(e+a,d.length-1),0),d[b]&&d[b].columnName):void 0},_getRowSpanData:function(a,b){return this.grid.dataModel.get(a).getRowSpanData(b)},nextRowIndex:function(a){var b=this.nextRowKey(a);return this.grid.dataModel.indexOfRowKey(b)},prevRowIndex:function(a){var b=this.prevRowKey(a);return this.grid.dataModel.indexOfRowKey(b)},nextColumnIndex:function(){var a=this.nextColumnName();return this.grid.columnModel.indexOfColumnName(a,!0)},prevColumnIndex:function(){var a=this.prevColumnName();return this.grid.columnModel.indexOfColumnName(a,!0)},nextRowKey:function(a){var b,c,d=this.which(),e=d.rowKey;return a="number"==typeof a?a:1,a>1?(e=this._findRowKey(a),c=this._getRowSpanData(e,d.columnName),c.isMainRow||(e=this._findRowKey(c.count+a))):(c=this._getRowSpanData(e,d.columnName),c.isMainRow&&c.count>0?e=this._findRowKey(c.count):c.isMainRow?e=this._findRowKey(1):(b=c.count,c=this._getRowSpanData(c.mainRowKey,d.columnName),e=this._findRowKey(c.count+b))),e},prevRowKey:function(a){var b,c=this.which(),d=c.rowKey;return a="number"==typeof a?a:1,a*=-1,-1>a?(d=this._findRowKey(a),b=this._getRowSpanData(d,c.columnName),b.isMainRow||(d=this._findRowKey(b.count+a))):(b=this._getRowSpanData(d,c.columnName),d=this._findRowKey(b.isMainRow?-1:b.count-1)),
d},nextColumnName:function(){return this._findColumnName(1)},prevColumnName:function(){return this._findColumnName(-1)},firstRowKey:function(){return this.grid.dataModel.at(0).get("rowKey")},lastRowKey:function(){return this.grid.dataModel.at(this.grid.dataModel.length-1).get("rowKey")},firstColumnName:function(){var a=this.grid.columnModel.getVisibleColumnModelList();return a[0].columnName},lastColumnName:function(){var a=this.grid.columnModel.getVisibleColumnModelList(),b=a.length-1;return a[b].columnName}}),b.Renderer.Smart=b.Renderer.extend({initialize:function(){b.Renderer.prototype.initialize.apply(this,arguments),this.on("change:scrollTop",this._onChange,this),this.listenTo(this.grid.dimensionModel,"change:bodyHeight",this._onChange,this),this.setOwnProperties({hiddenRowCount:10,criticalPoint:3})},_onChange:function(){this._isRenderable(this.get("scrollTop"))&&this.refresh()},_setRenderingRange:function(a){var b,c=this.grid.dimensionModel,d=this.grid.dataModel,e=c.get("rowHeight"),f=c.getDisplayRowCount(),h=Math.max(0,Math.ceil(a/(e+1))-this.hiddenRowCount),i=Math.min(d.length-1,h+f+2*this.hiddenRowCount);d.isRowSpanEnable()&&(h+=this._getStartRowSpanMinCount(h),i+=this._getEndRowSpanMaxCount(i)),b=0===h?0:g.getHeight(h,e)-1,this.set({top:b,startIndex:h,endIndex:i})},_getStartRowSpanMinCount:function(a){var b,c=this.grid.dataModel.at(a),d=0;return c&&(b=_.pluck(c.getRowSpanData(),"count"),b.push(0),d=_.min(b)),d},_getEndRowSpanMaxCount:function(a){var b,c=this.grid.dataModel.at(a),d=0;return c&&(b=_.pluck(c.getRowSpanData(),"count"),b.push(0),d=_.max(b)),d},_isRenderable:function(a){var b=this.grid,c=b.dimensionModel,d=b.dataModel,e=c.get("rowHeight"),f=c.get("bodyHeight"),g=d.length,h=Math.max(0,Math.ceil(a/(e+1))),i=Math.min(d.length-1,Math.floor((a+f)/(e+1))),j=this.get("startIndex"),k=this.get("endIndex");return 0!==j&&j+this.criticalPoint>h?!0:k!==g-1&&k-this.criticalPoint<i?!0:!1}}),b.Row=b.Base.extend({idAttribute:"rowKey",defaults:{},initialize:function(a,c){b.Base.prototype.initialize.apply(this,arguments);var d=a&&a.rowKey;this.setOwnProperties({dataModel:this.grid.dataModel,columnModel:this.grid.columnModel,renderModel:this.grid.renderModel}),this.dataModel.get(d)&&(this.listenTo(this.dataModel.get(d),"change",this._onDataModelChange,this),this.listenTo(this.dataModel.get(d),"restore",this._onDataModelChange,this))},_onDataModelChange:function(a){_.each(a.changed,function(a,b){"_extraData"===b?this._setRowExtraData():this.setCell(b,{value:a})},this)},_setRowExtraData:function(){if(!ne.util.isUndefined(this.collection)){var a,b=this.dataModel,c=this.columnModel.getVisibleColumnModelList(),d=this.dataModel.get(this.get("rowKey")),e=d.getRowState();_.each(c,function(c){var f,g,h=c.columnName,i=this.get(h),j=this;ne.util.isUndefined(i)||(f=d.isEditable(h),g="_button"===h?e.isDisabledCheck:e.isDisabled,b.isRowSpanEnable()&&!i.isMainRow&&(j=this.collection.get(i.mainRowKey)),j&&(a={isDisabled:g,isEditable:f,className:d.getClassNameList(h).join(" ")},j.setCell(h,a)))},this)}},parse:function(a){return this._formatData(a)},_formatData:function(a){var b=this.grid||this.collection.grid,c=b.dataModel,d=a.rowKey,e=c.get(d),f=e.getRowState(),g=f.isDisabled;return _.each(a,function(b,h){var i,j=e.isEditable(h);"rowKey"!==h&&"_extraData"!==h&&(i=c.isRowSpanEnable()&&a._extraData&&a._extraData.rowSpanData&&a._extraData.rowSpanData[h]?a._extraData.rowSpanData[h]:{mainRowKey:d,count:0,isMainRow:!0},g="_button"===h?f.isDisabledCheck:g,a[h]={rowKey:d,columnName:h,value:b,rowSpan:i.count,isMainRow:i.isMainRow,mainRowKey:i.mainRowKey,isEditable:j,isDisabled:g,optionList:[],className:e.getClassNameList(h).join(" "),changed:[]})},this),a},setCell:function(a,b){if(this.get(a)){var c,d=_.clone(this.get(a)),e=!1,f=[],h=this.get("rowKey");_.each(b,function(a,b){g.isEqual(d[b],a)||(e="value"===b?!0:e,d[b]=a,f.push(b))},this),f.length&&(d.changed=f,this.set(a,d),e&&(c=this.dataModel.indexOfRowKey(h),this.trigger("valueChange",c)))}}}),b.RowList=d.Base.extend({model:b.Row,initialize:function(){d.Base.prototype.initialize.apply(this,arguments)}}),a.Layer.Base=a.Base.extend({template:_.template('<div>    <%=text%>    <div class="loading_img"></div></div>'),initialize:function(){a.Base.prototype.initialize.apply(this,arguments),this.setOwnProperties({text:"기본 텍스트"}),this.listenTo(this.grid.dimensionModel,"change",this._resize,this)},render:function(a){return this.$el.html(this.template({text:a||this.text})).css("display","none"),this},show:function(a){this.render(a).$el.css("display","block").css("zIndex",1),this._resize()},hide:function(){this.$el.css("display","none")},_resize:function(){if("block"===this.$el.css("display")){var a=this.grid.dimensionModel.get("headerHeight"),b=this.grid.dimensionModel.get("bodyHeight");this.$el.css("marginTop",a+"px").css("height",b+"px")}}}),a.Layer.Empty=a.Layer.Base.extend({className:"no_row_layer",initialize:function(){a.Layer.Base.prototype.initialize.apply(this,arguments),this.setOwnProperties({text:"데이터가 존재하지 않습니다."})},template:_.template("<%=text%>")}),a.Layer.Loading=a.Layer.Base.extend({className:"loading_layer",initialize:function(){a.Layer.Base.prototype.initialize.apply(this,arguments),this.text="요청을 처리 중입니다."},template:_.template('<div>    <%=text%>    <div class="loading_img"></div></div>')}),a.Layer.Ready=a.Layer.Base.extend({className:"initializing_layer",initialize:function(){a.Layer.Base.prototype.initialize.apply(this,arguments),this.text="초기화 중 입니다."}}),a.Layout.Frame=a.Base.extend({tagName:"div",className:"lside_area",initialize:function(b){a.Base.prototype.initialize.apply(this,arguments),this.listenTo(this.grid.renderModel,"columnModelChanged",this.render,this).listenTo(this.grid.dimensionModel,"columnWidthChanged",this._onColumnWidthChanged,this),this.setOwnProperties({header:null,body:null,whichSide:b&&b.whichSide||"R"})},render:function(){var b,c;return this.destroyChildren(),this.beforeRender(),b=this.header=this.createView(a.Layout.Header,{grid:this.grid,whichSide:this.whichSide}),c=this.body=this.createView(a.Layout.Body,{grid:this.grid,whichSide:this.whichSide}),this.$el.append(b.render().el).append(c.render().el),this.afterRender(),this},_onColumnWidthChanged:function(){},beforeRender:function(){},afterRender:function(){}}),a.Layout.Body=a.Base.extend({tagName:"div",className:"data",template:_.template('<div class="table_container" style="top: 0px"><%=table%></div>'),templateTable:_.template('<table width="100%" border="0" cellspacing="1" cellpadding="0" bgcolor="#EFEFEF">   <colgroup><%=colGroup%></colgroup>   <tbody><%=tbody%></tbody></table>'),events:{scroll:"_onScroll"},initialize:function(b){a.Base.prototype.initialize.apply(this,arguments),this.setOwnProperties({whichSide:b&&b.whichSide||"R",isScrollSync:!1,extraWidth:0,$tableContainer:null}),this.listenTo(this.grid.dimensionModel,"columnWidthChanged",this._onColumnWidthChanged,this).listenTo(this.grid.dimensionModel,"change:bodyHeight",this._onBodyHeightChange,this).listenTo(this.grid.renderModel,"change:scrollTop",this._onScrollTopChange,this).listenTo(this.grid.renderModel,"change:scrollLeft",this._onScrollLeftChange,this).listenTo(this.grid.renderModel,"refresh",this._setTopPosition,this)},_onBodyHeightChange:function(a,b){this.$el.css("height",b+"px")},_onColumnWidthChanged:function(){var b=this.grid.dimensionModel.getColumnWidthList(this.whichSide),c=this.$el.find("col");_.each(b,function(b,d){c.eq(d).css("width",b-a.Layout.Body.extraWidth+"px")},this)},_onScroll:function(a){var b={},c=this.grid.renderModel;b.scrollTop=a.target.scrollTop,"R"===this.whichSide&&(b.scrollLeft=a.target.scrollLeft),c.set(b)},_onScrollLeftChange:function(a,b){"R"===this.whichSide&&(this.el.scrollLeft=b)},_onScrollTopChange:function(a,b){this.el.scrollTop=b},_setTopPosition:function(a){this.$tableContainer.css("top",a+"px")},render:function(){var b,c,d,e=this.grid,f=this.whichSide,g=e.renderModel.getCollection(f);return this.destroyChildren(),this.grid.option("scrollX")||this.$el.css("overflow-x","hidden"),this.grid.option("scrollY")||"R"!==f||this.$el.css("overflow-y","hidden"),d=this.templateTable({colGroup:this._getColGroupMarkup(),tbody:""}),this.$el.css({height:e.dimensionModel.get("bodyHeight")}).html(this.template({table:d})),this.$tableContainer=this.$el.find("div.table_container"),c=this.createView(a.RowList,{grid:e,collection:g,bodyView:this,el:this.$el.find("tbody"),whichSide:f}),c.render(),b=this.addView(e.selection.createLayer(f)),this.$el.append(b.render().el),this},attachTableEventHandler:function(a,b){_.each(b,function(b,c){this.$tableContainer.on(c,a+" "+b.selector,b.handler)},this)},redrawTable:function(a){return this.$tableContainer[0].innerHTML=this.templateTable({colGroup:this._getColGroupMarkup(),tbody:a}),this.$tableContainer.find("tbody")},_getColGroupMarkup:function(){var b=this.grid,c=this.whichSide,d=b.columnModel,e=b.dimensionModel,f=e.getColumnWidthList(c),g=d.getVisibleColumnModelList(c),h="";return _.each(g,function(b,c){var d=b.columnName,e=f[c]-a.Layout.Body.extraWidth;h+='<col columnname="'+d+'" style="width:'+e+'px">'}),h}},{extraWidth:function(){var a=0;return ne.util.browser.msie&&7===ne.util.browser.version&&(a=20),a}()}),a.Layout.Frame.Lside=a.Layout.Frame.extend({className:"lside_area",initialize:function(){a.Layout.Frame.prototype.initialize.apply(this,arguments),this.setOwnProperties({whichSide:"L"})},_onColumnWidthChanged:function(){var a=this.grid.dimensionModel.get("lsideWidth");this.$el.css({width:a+"px"})},beforeRender:function(){var a=this.grid.dimensionModel.get("lsideWidth");this.$el.css({display:"block",width:a+"px"})}}),a.Layout.Frame.Rside=a.Layout.Frame.extend({className:"rside_area",initialize:function(){a.Layout.Frame.prototype.initialize.apply(this,arguments),this.setOwnProperties({whichSide:"R"})},_onColumnWidthChanged:function(){var a=this.grid.dimensionModel,b=a.get("lsideWidth"),c=a.get("rsideWidth");this.$el.css({width:c+"px",marginLeft:b+"px"})},beforeRender:function(){var a=this.grid.dimensionModel,b=a.get("lsideWidth"),c=a.get("rsideWidth");this.$el.css({display:"block",width:c+"px",marginLeft:b+"px"})},afterRender:function(){if(this.grid.option("scrollY")){var b,c=$("<div></div>"),d=this.grid.dimensionModel.get("headerHeight")-2;c.css({height:d+"px"}).addClass("space"),this.$el.append(c),this.grid.option("notUseSmartRendering")||(b=this.createView(a.Layout.Frame.Rside.VirtualScrollBar,{grid:this.grid}),this.$el.append(b.render().el))}}}),a.Layout.Frame.Rside.VirtualScrollBar=a.Base.extend({tagName:"div",className:"virtual_scrollbar",initialize:function(){a.Base.prototype.initialize.apply(this,arguments),this.setOwnProperties({hasFocus:!1}),this.listenTo(this.grid.dataModel,"sort add remove reset",this._setHeight,this),this.listenTo(this.grid.dimensionModel,"change",this._onDimensionChange,this),this.listenTo(this.grid.renderModel,"change:scrollTop",this._onScrollTopChange,this),this.timeoutForScroll=0},events:{scroll:"_onScroll",mousedown:"_onMouseDown"},_onMouseDown:function(){this.hasFocus=!0,$(document).on("mouseup",$.proxy(this._onMouseUp,this))},_onMouseUp:function(){this.hasFocus=!1,$(document).off("mouseup",$.proxy(this._onMouseUp,this))},_onScroll:function(a){clearTimeout(this.timeoutForScroll),this.hasFocus&&(this.timeoutForScroll=setTimeout($.proxy(function(){this.grid.renderModel.set("scrollTop",a.target.scrollTop)},this),0))},_onDimensionChange:function(a){(a.changed.headerHeight||a.changed.bodyHeight)&&this.render()},_onScrollTopChange:function(a,b){var c;this.el.scrollTop=b,c=this.el.scrollTop,c!==b&&this.grid.renderModel.set("scrollTop",c)},render:function(){var a=this.grid,b=a.dimensionModel.get("bodyHeight"),c=a.dimensionModel.get("headerHeight");return this.grid.option("scrollX")&&(b-=this.grid.scrollBarSize),this.$el.css({height:b+"px",top:c+"px",display:"block"}).html('<div class="content"></div>'),this._setHeight(),this},_setHeight:function(){var a=this.grid,b=a.dimensionModel.get("rowHeight"),c=a.dataModel.length,d=b*a.dataModel.length+(c+1);this.$el.find(".content").height(d)},destroy:function(){this.stopListening(),this._onMouseUp(),this.destroyChildren(),this.remove()}}),a.Layout.Header=a.Base.extend({tagName:"div",className:"header",whichSide:"R",events:{click:"_onClick"},initialize:function(b){a.Base.prototype.initialize.apply(this,arguments),this.whichSide=b.whichSide,this.setOwnProperties({timeoutForAllChecked:0}),this.listenTo(this.grid.renderModel,"change:scrollLeft",this._onScrollLeftChange,this).listenTo(this.grid.dimensionModel,"columnWidthChanged",this._onColumnWidthChanged,this).listenTo(this.grid.dataModel,"change:_button",this._onCheckCountChange,this).listenTo(this.grid.dataModel,"sortChanged",this._updateBtnSortState,this)},template:_.template('    <table width="100%" border="0" cellspacing="1" cellpadding="0" bgcolor="#EFEFEF">        <colgroup><%=colGroup%></colgroup>        <tbody><%=tBody%></tbody>    </table>'),templateHeader:_.template('<th columnname="<%=columnName%>" height="<%=height%>" <%if(colspan > 0) {%>colspan=<%=colspan%> <%}%><%if(rowspan > 0) {%>rowspan=<%=rowspan%> <%}%>><%=title%><%=btnSort%></th>'),templateCol:_.template('<col columnname="<%=columnName%>" style="width:<%=width%>px">'),markupBtnSort:'<a class="btn_sorting"></a>',_getColGroupMarkup:function(){var a=this._getColumnData(),b=a.widthList,c=a.modelList,d=[];return _.each(b,function(a,b){d.push(this.templateCol({columnName:c[b].columnName,width:a}))},this),d.join("")},_onCheckCountChange:function(){"checkbox"===this.grid.option("selectType")&&(clearTimeout(this.timeoutForAllChecked),this.timeoutForAllChecked=setTimeout($.proxy(this._syncCheckState,this),10))},_getHeaderMainCheckbox:function(){return this.$el.find('th[columnname="_button"] input')},_syncCheckState:function(){if("checkbox"===this.grid.option("selectType")){var a,b=this._getHeaderMainCheckbox(),c=0;b.length&&(a=this.grid.dataModel.getRowList(!0).length,this.grid.dataModel.forEach(function(a,b){var d=a.getCellState("_button");!d.isDisabled&&d.isEditable&&c++},this),b.prop("checked",c===a))}},_onColumnWidthChanged:function(){var a=this._getColumnData(),b=a.widthList,c=this.$el.find("col");_.each(b,function(a,b){c.eq(b).css("width",a+"px")})},_onScrollLeftChange:function(a,b){"R"===this.whichSide&&(this.el.scrollLeft=b)},_onClick:function(a){var b=$(a.target),c=b.closest("th").attr("columnname");"_button"===c&&b.is("input")?b.prop("checked")?this.grid.checkAll():this.grid.uncheckAll():b.is("a.btn_sorting")&&this.grid.sort(c)},_updateBtnSortState:function(a){this._$currentSortBtn&&this._$currentSortBtn.removeClass("sorting_down sorting_up"),this._$currentSortBtn=this.$el.find("th[columnname="+a.columnName+"] a.btn_sorting"),this._$currentSortBtn.addClass(a.isAscending?"sorting_up":"sorting_down")},render:function(){this.destroyChildren();var b=this.createView(a.Layout.Header.ResizeHandler,{whichSide:this.whichSide,grid:this.grid});return this.grid.option("scrollX")||this.$el.css("overflow-x","hidden"),this.grid.option("scrollY")||this.$el.css("overflow-y","hidden"),this.$el.css({height:this.grid.dimensionModel.get("headerHeight")}).html(this.template({colGroup:this._getColGroupMarkup(),tBody:this._getTableBodyMarkup()})),this.$el.append(b.render().el),this},_getColumnData:function(){var a=this.grid.columnModel,b=this.grid.dimensionModel,c=b.getColumnWidthList(this.whichSide),d=a.getVisibleColumnModelList(this.whichSide);return{widthList:c,modelList:d}},_getTableBodyMarkup:function(){var a,b,c=this._getColumnHierarchyList(),d=this._getHierarchyMaxRowCount(c),e=this.grid.dimensionModel.get("headerHeight"),f=new Array(d),h=new Array(d),i=[],j=g.getRowHeight(d,e)-1,k=1;return _.each(c,function(b,g){var l=c[g].length,m=0;_.each(b,function(b,c){var g=b.columnName;k=l-1===c&&d-l+1>1?d-l+1:1,a=j*k,c===l-1?a=e-m-2:m+=a+1,h[c]===g?(f[c].pop(),i[c]+=1):i[c]=1,h[c]=g,f[c]=f[c]||[],f[c].push(this.templateHeader({columnName:g,height:a,colspan:i[c],rowspan:k,title:b.title,btnSort:b.isSortable?this.markupBtnSort:""}))},this)},this),b=_.map(f,function(a){return"<tr>"+a.join("")+"</tr>"}),b.join("")},_getHierarchyMaxRowCount:function(a){var b=[0];return _.each(a,function(a){b.push(a.length)},this),Math.max.apply(Math,b)},_getColumnHierarchyList:function(){var a,b=this._getColumnData().modelList;return a=_.map(b,function(a){return this._getColumnHierarchy(a).reverse()},this)},_getColumnHierarchy:function(a,b){var c=this.grid.option("columnMerge");return b=b||[],a&&(b.push(a),c&&_.each(c,function(c,d){-1!==$.inArray(a.columnName,c.columnNameList)&&(b=this._getColumnHierarchy(c,b))},this)),b}}),a.Layout.Header.ResizeHandler=a.Base.extend({tagName:"div",className:"resize_handle_container",events:{"mousedown .resize_handle":"_onMouseDown","click .resize_handle":"_onClick"},initialize:function(b){a.Base.prototype.initialize.apply(this,arguments),this.setOwnProperties({whichSide:b.whichSide||"R",isResizing:!1,$target:null,differenceLeft:0,initialWidth:0,initialOffsetLeft:0,initialLeft:0}),this.listenTo(this.grid.dimensionModel,"columnWidthChanged",this._refreshHandlerPosition,this),this.grid instanceof a.Base&&(this.listenTo(this.grid,"rendered",$.proxy(this._refreshHandlerPosition,this)),this.listenTo(this.grid.dimensionModel,"change:width",$.proxy(this._refreshHandlerPosition,this)))},template:_.template('<div columnindex="<%=columnIndex%>" columnname="<%=columnName%>" class="resize_handle<% if(isLast === true)  print(" resize_handle_last");%>" style="<%=height%>" title="마우스 드래그를 통해 컬럼의 넓이를 변경할 수 있고,더블클릭을 통해 넓이를 초기화할 수 있습니다."></div>'),_getColumnData:function(){var a=this.grid.columnModel,b=this.grid.dimensionModel,c=b.getColumnWidthList(this.whichSide),d=a.getVisibleColumnModelList(this.whichSide);return{widthList:c,modelList:d}},_getResizeHandlerMarkup:function(){var a,b=this._getColumnData(),c=b.modelList,d=this.grid.dimensionModel.get("headerHeight"),e=c.length;return a=_.map(c,function(a,b){return this.template({columnIndex:b,columnName:a.columnName,isLast:b+1===e,height:d})},this),a.join("")},render:function(){var a=this.grid.dimensionModel.get("headerHeight");return this.$el.empty(),this.$el.show().css({marginTop:-a+"px",height:a+"px"}).html(this._getResizeHandlerMarkup()),this._refreshHandlerPosition(),this},_refreshHandlerPosition:function(){var a,b,c,d=this._getColumnData(),e=d.widthList,f=[],g=this.$el.find(".resize_handle"),h=this.$el.parent().find("table:first"),i=!1,j=0,k=1;ne.util.forEachArray(g,function(d,l){a=g.eq(l),b=a.attr("columnname"),c=h.find('th[columnname="'+b+'"]').width(),ne.util.isExisty(c)?i=i||c!==e[l]:c=e[l],j+=c+k,a.css("left",j-3+"px"),f.push(c)})},_isResizing:function(){return!!this.isResizing},_onMouseDown:function(a){this._startResizing(a)},_onClick:function(a){var b=$(a.target),c=parseInt(b.attr("columnindex"),10),d=b.data("isClicked");d?(this.grid.dimensionModel.restoreColumnWidth(this._getHandlerColumnIndex(c)),this._clearClickedFlag(b),this._refreshHandlerPosition()):this._setClickedFlag(b)},_setClickedFlag:function(a){a.data("isClicked",!0),setTimeout($.proxy(this._clearClickedFlag,this,a),500)},_clearClickedFlag:function(a){a.data("isClicked",!1)},_onMouseUp:function(){this._stopResizing()},_onMouseMove:function(a){if(this._isResizing()){a.preventDefault();var b=a.pageX-this.initialOffsetLeft,c=this._calculateWidth(a.pageX),d=parseInt(this.$target.attr("columnindex"),10);this.$target.css("left",b+"px"),this.grid.dimensionModel.setColumnWidth(this._getHandlerColumnIndex(d),c),this._refreshHandlerPosition()}},_calculateWidth:function(a){var b=a-this.initialOffsetLeft-this.initialLeft;return this.initialWidth+b},_getHandlerColumnIndex:function(a){return"R"===this.whichSide?a+this.grid.columnModel.get("columnFixIndex"):a},_startResizing:function(a){var b=this._getColumnData(),c=b.widthList,d=$(a.target);this.isResizing=!0,this.$target=d,this.initialLeft=parseInt(d.css("left").replace("px",""),10),this.initialOffsetLeft=this.$el.offset().left,this.initialWidth=c[d.attr("columnindex")],$("body").css("cursor","col-resize"),$(document).bind("mousemove",$.proxy(this._onMouseMove,this)).bind("mouseup",$.proxy(this._onMouseUp,this)),d[0].setCapture&&d[0].setCapture()},_stopResizing:function(){this.$target&&this.$target[0].releaseCapture&&this.$target[0].releaseCapture(),this.isResizing=!1,this.$target=null,this.initialLeft=0,this.initialOffsetLeft=0,this.initialWidth=0,$("body").css("cursor","default"),$(document).unbind("mousemove",$.proxy(this._onMouseMove,this)).unbind("mouseup",$.proxy(this._onMouseUp,this))},destroy:function(){this.stopListening(),this._stopResizing(),this.destroyChildren(),this.remove()}}),a.Layout.Toolbar=a.Base.extend({tagName:"div",className:"toolbar",initialize:function(){a.Base.prototype.initialize.apply(this,arguments),this.setOwnProperties({controlPanel:null,resizeHandler:null,pagination:null})},render:function(){this.destroyChildren();var b,c,d,e=this.grid.option("toolbar");return this.$el.empty(),e&&e.hasControlPanel&&(c=this.createView(a.Layout.Toolbar.ControlPanel,{grid:this.grid}),this.$el.append(c.render().el).css("display","block")),e&&e.hasResizeHandler&&(b=this.createView(a.Layout.Toolbar.ResizeHandler,{grid:this.grid}),this.$el.append(b.render().el).css("display","block")),e&&e.hasPagination&&(d=this.createView(a.Layout.Toolbar.Pagination,{grid:this.grid}),this.$el.append(d.render().el).css("display","block")),this.setOwnProperties({controlPanel:c,resizeHandler:b,pagination:d}),this}}),a.Layout.Toolbar.ControlPanel=a.Base.extend({tagName:"div",className:"btn_setup",template:_.template('<a href="#" class="excel_download_button btn_text excel_all" style="display: inline-block;"><span><em class="f_bold p_color5">전체엑셀다운로드</em></span></a><a href="#" class="excel_download_button btn_text excel_grid" style="display: inline-block;"><span><em class="excel">엑셀다운로드</em></span></a><a href="#" class="grid_configurator_button btn_text" style="display: none;"><span><em class="grid">그리드설정</em></span></a>'),initialize:function(){a.Base.prototype.initialize.apply(this,arguments)},render:function(){return this.destroyChildren(),this.$el.html(this.template()),this}}),a.Layout.Toolbar.ResizeHandler=a.Base.extend({tagName:"div",className:"height_resize_bar",events:{mousedown:"_onMouseDown"},template:_.template('<a href="#" class="height_resize_handle">높이 조절</a>'),initialize:function(){this.timeoutIdForResize=0,a.Base.prototype.initialize.apply(this,arguments)},_attachMouseEvent:function(){$(document).on("mousemove",$.proxy(this._onMouseMove,this)),$(document).on("mouseup",$.proxy(this._onMouseUp,this)),$(document).on("selectstart",$.proxy(this._onSelectStart,this))},_detachMouseEvent:function(){$(document).off("mousemove",$.proxy(this._onMouseMove,this)),$(document).off("mouseup",$.proxy(this._onMouseUp,this)),$(document).off("selectstart",$.proxy(this._onSelectStart,this))},_onMouseDown:function(a){a.preventDefault(),$(document.body).css("cursor","row-resize"),this.grid.updateLayoutData(),this._attachMouseEvent()},_onMouseMove:function(a){clearTimeout(this.timeoutIdForResize);var b=this.grid.dimensionModel,c=b.get("offsetTop"),d=b.get("headerHeight"),e=b.get("rowHeight"),f=b.get("toolbarHeight"),g=a.pageY-c-d-f;g=Math.max(g,e+b.getScrollXHeight()),this.timeoutIdForResize=setTimeout(function(){b.set({bodyHeight:g})},0)},_onMouseUp:function(){$(document.body).css("cursor","default"),this._detachMouseEvent()},_onSelectStart:function(a){return a.preventDefault(),!1},render:function(){return this.destroyChildren(),this.$el.html(this.template()),this},destroy:function(){this.stopListening(),this._onMouseUp(),this.destroyChildren(),this.remove()}}),a.Layout.Toolbar.Pagination=a.Base.extend({tagName:"div",className:"pagination",template:_.template('<a href="#" class="pre_end">맨앞</a><a href="#" class="pre">이전</a> <a href="#" class="next">다음</a><a href="#" class="next_end">맨뒤</a>'),initialize:function(){a.Base.prototype.initialize.apply(this,arguments),this.setOwnProperties({instance:null})},render:function(){return this.destroyChildren(),this.$el.empty().html(this.template()),this._setPaginationInstance(),this},_setPaginationInstance:function(){var a=ne&&ne.component&&ne.component.Pagination,b=this.instance;!b&&a&&(b=new a({itemCount:1,itemPerPage:1},this.$el)),this.setOwnProperties({instance:b})}}),a.Painter.Row=a.Base.Painter.extend({eventHandler:{mousedown:"_onMouseDown"},baseTemplate:_.template('<tr key="<%=key%>" class="<%=className%>" style="height: <%=height%>px;"><%=contents%></tr>'),initialize:function(b){a.Base.Painter.prototype.initialize.apply(this,arguments),this.setOwnProperties({columnModelList:b.columnModelList})},destroy:function(){this.stopListening(),this.remove()},_onMouseDown:function(a){var b=$(a.target).closest("td"),c=$(a.target).closest("tr"),d=b.attr("columnName"),e=c.attr("key");this.grid.focus(e,d),"radio"===this.grid.option("selectType")&&this.grid.check(e),this.grid.selection.onMouseDown(a)},onModelChange:function(a,b){var c,d;_.each(a.changed,function(a,e){"_extraData"!==e&&(c=this._getEditType(e,a),d=this.grid.cellFactory.getInstance(c),d.onModelChange(a,b))},this)},_getEditType:function(a,b){var c=this.grid.columnModel.getEditType(a);return b.isEditable||"_number"===a||(c="normal"),c},getCellPainters:function(){return this.grid.cellFactory.instances},getHtml:function(a){if(ne.util.isUndefined(a.get("rowKey")))return"";var b,c,d,e,f=this.columnModelList,g=this.grid.cellFactory,h="";return _.each(f,function(f){b=f.columnName,c=a.get(b),c&&c.isMainRow&&(d=this._getEditType(b,c),e=g.getInstance(d),h+=e.getHtml(c))},this),this.baseTemplate({key:a.get("rowKey"),height:this.grid.dimensionModel.get("rowHeight"),contents:h,className:""})}}),a.Base.Painter.Cell=a.Base.Painter.extend({redrawAttributes:["isEditable","optionList","value"],_defaultKeyDownSwitch:{ESC:function(a,b){this.focusOut(b.$target)},ENTER:function(a,b){this.focusOut(b.$target)},TAB:function(a,b){a.shiftKey?this.grid.focusIn(b.rowKey,b.focusModel.prevColumnName(),!0):this.grid.focusIn(b.rowKey,b.focusModel.nextColumnName(),!0)},defaultAction:function(a,b){}},eventHandler:{},initialize:function(){a.Base.Painter.prototype.initialize.apply(this,arguments),this.setOwnProperties({_keyDownSwitch:$.extend({},this._defaultKeyDownSwitch)})},onModelChange:function(a,b){var c,d=b.find('td[columnname="'+a.columnName+'"]'),e=!1;ne.util.forEachArray(this.redrawAttributes,function(b){return-1!==$.inArray(b,a.changed)?(e=!0,!1):void 0},this),d.attr("class",this._getClassNameList(a).join(" "));try{c=!!d.find(":focus").length}catch(f){c=!1}e?(this.redraw(a,d,c),c&&this.focusIn(d)):this.setElementAttribute(a,d,c)},_getParamForKeyDownSwitch:function(a){var b=this.grid,c=a.keyCode||a.which,d=b.focusModel.which(),e=d.rowKey,f=d.columnName;return{keyDownEvent:a,$target:$(a.target),focusModel:b.focusModel,rowKey:e,columnName:f,keyName:b.keyName[c]}},_executeKeyDownSwitch:function(a){var b=a.keyCode||a.which,c=this.grid.keyName[b],d=this._getParamForKeyDownSwitch(a);return(this._keyDownSwitch[c]||this._keyDownSwitch.defaultAction).call(this,a,d),!!this._keyDownSwitch[c]},setKeyDownSwitch:function(a,b){"object"==typeof a?this._keyDownSwitch=$.extend(this._keyDownSwitch,a):this._keyDownSwitch[a]=b},_onKeyDown:function(a){this._executeKeyDownSwitch(a)&&a.preventDefault()},_getClassNameList:function(a){var b=this.grid.focusModel.which(),c=a.columnName,d=this.grid.dataModel.getMainRowKey(b.rowKey,c),e=[],f={},g={_button:!0,_number:!0},h=!!g[c];return d===a.rowKey&&(f.selected=!0,b.columnName===c&&(f.focused=!0)),a.className&&(f[a.className]=!0),a.isEditable&&!h&&(f.editable=!0),a.isDisabled&&(f.disabled=!0),ne.util.forEach(f,function(a,b){e.push(b)}),e},_getContentHtml:function(a){var b,c,d,e=a.columnName,f=this.grid.columnModel.getColumnModel(e),g=f.editOption||{};return ne.util.isExisty(a.value)||(a.value=f.defaultValue),b=this._getExtraContent(g.beforeContent||g.beforeText,a),c=this._getExtraContent(g.afterContent||g.afterText,a),d=b+this.getContentHtml(a)+c},_getExtraContent:function(a,b){var c,d,e=a;return ne.util.isFunction(a)&&(c=this.grid.dataModel.get(b.rowKey),d=c.getHTMLEncodedString(b.columnName),e=a(d,c.attributes)),ne.util.isExisty(e)||(e=""),e},_getSpanWrapContent:function(a,b){return ne.util.isFalsy(a)&&(a=""),'<span class="'+b+'">'+a+"</span>"},getHtml:function(a){var b=g.getAttributesString(this.getAttributes(a)),c=[];return c.push("<td"),c.push(' columnName="'),c.push(a.columnName),c.push('" '),c.push(a.rowSpan?'rowSpan="'+a.rowSpan+'"':""),c.push(' class="'),c.push(this._getClassNameList(a).join(" ")),c.push('" '),c.push(b),c.push(' edit-type="'),c.push(this.getEditType()),c.push('">'),c.push(this._getContentHtml(a)),c.push("</td>"),c.join("")},redraw:function(a,b){var c={"class":this._getClassNameList(a).join(" ")};a.rowSpan&&(c.rowSpan=a.rowSpan),c["edit-type"]=this.getEditType(),c=$.extend(c,this.getAttributes(a)),b.attr(c),b.html(this._getContentHtml(a))},_getCellData:function(a){var b=this._getCellAddress(a);return this.grid.renderModel.getCellData(b.rowKey,b.columnName)},_getCellAddress:function(a){return{rowKey:this.getRowKey(a),columnName:this.getColumnName(a)}},_getConvertedHtml:function(a,b){var c,d=this.getColumnModel(b),e=d.editOption;return e&&ne.util.isFunction(e.converter)&&(c=e.converter(a,this.grid.dataModel.get(b.rowKey).attributes)),ne.util.isFalsy(c)&&(c=null),c},getColumnName:function(a){return a.closest("td").attr("columnName")},getRowKey:function(a){return a.closest("tr").attr("key")},getColumnModel:function(a){return this.grid.columnModel.getColumnModel(a.columnName)},getAttributes:function(a){var b=this.getColumnModel(a);return{align:b.align||"left"}},focusOut:function(a){this.grid.focusClipboard()},getEditType:function(){return"normal"},focusIn:function(a){},getContentHtml:function(a){return""},setElementAttribute:function(a,b,c){}}),a.Base.Painter.Cell.Interface=function(){},a.Base.Painter.Cell.Interface.prototype.getEditType=function(){},a.Base.Painter.Cell.Interface.prototype.focusIn=function(a){},a.Base.Painter.Cell.Interface.prototype.getContentHtml=function(a){},a.Base.Painter.Cell.Interface.prototype.setElementAttribute=function(a,b,c){},a.Painter.Cell.List=a.Base.Painter.Cell.extend({redrawAttributes:["isDisabled","isEditable","optionList"],eventHandler:{},initialize:function(){a.Base.Painter.Cell.prototype.initialize.apply(this,arguments)},getEditType:function(){},focusIn:function(a){},getContentHtml:function(a){throw this.error("Implement getContentHtml(cellData, $target) method. On re-rendering")},setElementAttribute:function(a,b,c){throw this.error("Implement setElementAttribute(cellData, $target) method. ")},getOptionList:function(a){var b=this.grid.columnModel.getColumnModel(a.columnName);return a.optionList&&a.optionList.length?a.optionList:b.editOption.list}}),a.Painter.Cell.List.Select=a.Painter.Cell.List.extend({initialize:function(){a.Painter.Cell.List.prototype.initialize.apply(this,arguments),this.setKeyDownSwitch({ESC:function(a,b){this.focusOut(b.$target)},ENTER:function(a,b){this.focusOut(b.$target)}})},eventHandler:{"change select":"_onChange","keydown select":"_onKeyDown"},getEditType:function(){return"select"},focusIn:function(a){a.find("select").prop("disabled")?this.grid.focusClipboard():a.find("select").eq(0).focus()},getContentHtml:function(a){var b=this.getOptionList(a),c=a.isDisabled,d=[],e=this._getConvertedHtml(a.value,a);return ne.util.isNull(e)&&(d.push('<select name="'+g.getUniqueKey()+'"'),d.push(c?" disabled ":""),d.push(">"),ne.util.forEachArray(b,function(b){d.push("<option "),d.push('value="'+b.value+'"'),a.value==b.value&&d.push(" selected"),d.push(" >"),d.push(b.text),d.push("</option>")}),d.push("</select>"),e=d.join("")),e},_getContentHtml:function(a){var b,c,d=a.columnName,e=this.grid.columnModel.getColumnModel(d),f=e.editOption||{},g="";return ne.util.isExisty(a.value)||(a.value=e.defaultValue),b=this._getExtraContent(f.beforeContent||f.beforeText,a),c=this._getExtraContent(f.afterContent||f.afterText,a),
b&&(g+=this._getSpanWrapContent(b,"before",a)),c&&(g+=this._getSpanWrapContent(c,"after",a)),g+=this._getSpanWrapContent(this.getContentHtml(a),"input")},setElementAttribute:function(a,b,c){var d=b.find("select");c&&d.blur(),d.val(a.value),c&&d.focus()},_onChange:function(a){var b=$(a.target),c=this._getCellAddress(b),d=this.grid;d.setValue(c.rowKey,c.columnName,b.val())}}),a.Painter.Cell.List.Button=a.Painter.Cell.List.extend({initialize:function(){a.Painter.Cell.List.prototype.initialize.apply(this,arguments),this.setKeyDownSwitch({UP_ARROW:function(){},DOWN_ARROW:function(){},PAGE_UP:function(){},PAGE_DOWN:function(){},ENTER:function(a,b){b.$target.trigger("click")},LEFT_ARROW:function(a,b){this._focusPrevInput(b.$target)},RIGHT_ARROW:function(a,b){this._focusNextInput(b.$target)},ESC:function(a,b){this.focusOut(b.$target)},TAB:function(a,b){a.shiftKey?this._focusPrevInput(b.$target)||this.grid.focusIn(b.rowKey,b.focusModel.prevColumnName(),!0):this._focusNextInput(b.$target)||this.grid.focusIn(b.rowKey,b.focusModel.nextColumnName(),!0)}})},eventHandler:{"change input":"_onChange","keydown input":"_onKeyDown"},getEditType:function(){return"button"},focusIn:function(a){a.find("input").eq(0).prop("disabled")?this.grid.focusClipboard():a.find("input").eq(0).focus()},getContentHtml:function(a){var b,c=this.getOptionList(a),d=this.grid.columnModel.getColumnModel(a.columnName),e=a.value,f=(""+e).split(","),h={},i=this._getConvertedHtml(e,a),j=[],k=g.getUniqueKey(),l=a.isDisabled;return ne.util.isNull(i)&&(ne.util.forEachArray(f,function(a){h[a]=!0}),ne.util.forEachArray(c,function(a){b=k+"_"+a.value,j.push('<input type="'),j.push(d.editOption.type),j.push('" name="'),j.push(k),j.push('" id="'),j.push(b),j.push('" value="'),j.push(a.value),j.push('" '),j.push(h[a.value]?"checked":""),j.push(l?"disabled":""),j.push("/>"),a.text&&(j.push('<label for="'),j.push(b),j.push('" style="margin-right:10px">'),j.push(a.text),j.push("</label>"))},this),i=j.join("")),i},setElementAttribute:function(a,b){var c=a.value,d=(""+c).split(",");b.find("input:checked").prop("checked",!1),ne.util.forEachArray(d,function(a){b.find('input[value="'+a+'"]').prop("checked",!0)})},_focusNextInput:function(a){return this._focusTargetInput(a,"next")},_focusPrevInput:function(a){return this._focusTargetInput(a,"prev")},_focusTargetInput:function(a,b){var c,d=a;"next"===b?c=function(a){return a.next()}:"prev"===b&&(c=function(a){return a.prev()});do d=c(d);while(d.length&&!d.is("input"));return d.length?(d.focus(),!0):!1},_getCheckedValueList:function(a){var b=a.closest("td").find("input:checked"),c=[];return ne.util.forEachArray(b,function(a,d){c.push(b.eq(d).val())}),c},_onChange:function(a){var b=$(a.target),c=this._getCellAddress(b);this.grid.setValue(c.rowKey,c.columnName,this._getCheckedValueList(b).join(","))}}),a.Painter.Cell.Normal=a.Base.Painter.Cell.extend({initialize:function(){a.Base.Painter.Cell.prototype.initialize.apply(this,arguments)},getEditType:function(){return"normal"},getContentHtml:function(a){var b=a.columnName,c=this.grid.columnModel.getColumnModel(b),d=this.grid.dataModel.get(a.rowKey).getHTMLEncodedString(b),e=a.rowKey;return ne.util.isFunction(c.formatter)&&(d=c.formatter(d,this.grid.dataModel.get(e).attributes,c)),d},focusIn:function(a){this.grid.focusClipboard()},setElementAttribute:function(a,b,c){}}),a.Painter.Cell.Normal.Number=a.Painter.Cell.Normal.extend({redrawAttributes:[],initialize:function(){a.Painter.Cell.Normal.prototype.initialize.apply(this,arguments)},getEditType:function(){return"_number"},getContentHtml:function(a){return a.value}}),a.Painter.Cell.MainButton=a.Base.Painter.Cell.extend({redrawAttributes:["isDisabled","isEditable","optionList"],eventHandler:{mousedown:"_onMouseDown","change input":"_onChange","keydown input":"_onKeyDown"},initialize:function(){a.Base.Painter.Cell.prototype.initialize.apply(this,arguments),this.setKeyDownSwitch({UP_ARROW:function(){},DOWN_ARROW:function(){},ENTER:function(a,b){this.focusOut(b.$target)},LEFT_ARROW:function(a,b){},RIGHT_ARROW:function(a,b){},ESC:function(a,b){}})},getEditType:function(){return"_button"},getContentHtml:function(a){var b=a.isDisabled,c=[];return c.push('<input type="'),c.push(this.grid.option("selectType")),c.push('" name="'),c.push(this.grid.id),c.push('" '),c.push(a.value?"checked":""),c.push(b?"disabled":""),c.push("/>"),c.join("")},focusIn:function(a){},setElementAttribute:function(a,b,c){var d=b.find("input"),e=d.prop("checked");e!==!!a.value&&d.prop("checked",a.value)},toggle:function(a){var b=a.find("input");"checkbox"===this.grid.option("selectType")&&b.prop("checked",!b.prop("checked"))},getAttributes:function(a){return{align:"center"}},_onChange:function(a){var b=$(a.target),c=this.getRowKey(b);this.grid.setValue(c,"_button",b.prop("checked"))},_onMouseDown:function(a){var b=$(a.target);b.is("input")||b.find("input").trigger("click")}}),a.Painter.Cell.Text=a.Base.Painter.Cell.extend({redrawAttributes:["isEditable"],eventHandler:{"blur input":"_onBlur","keydown input":"_onKeyDown","focus input":"_onFocus","selectstart input":"_onSelectStart"},initialize:function(b,c){a.Base.Painter.Cell.prototype.initialize.apply(this,arguments),this.setOwnProperties({originalText:""}),this.setKeyDownSwitch({UP_ARROW:function(){},DOWN_ARROW:function(){},PAGE_UP:function(){},PAGE_DOWN:function(){},ENTER:function(a,b){this.focusOut(b.$target.closest("td"))},ESC:function(a,b){this._restore(b.$target),this.focusOut(b.$target.closest("td"))}})},template:_.template('<input type="<%=type%>" value="<%=value%>" name="<%=name%>" align="center" <%=disabled%> maxLength="<%=maxLength%>"/>'),_getInputType:function(){return"text"},getEditType:function(){return"text"},focusIn:function(a){var b=a.find("input");b.prop("disabled")?this.grid.focusClipboard():(g.form.setCursorToEnd(b.get(0)),b.focus().select())},focusOut:function(){this.grid.focusClipboard()},getContentHtml:function(a){var b,c=this.getColumnModel(a),d=c.editOption,e=this.grid.dataModel.get(a.rowKey).getHTMLEncodedString(a.columnName);return ne.util.isUndefined(e)&&(e=""),b=this._getConvertedHtml(e,a),ne.util.isNull(b)&&(b=this.template({type:this._getInputType(),value:e,name:g.getUniqueKey(),disabled:a.isDisabled?"disabled":"",maxLength:d.maxLength||""})),b},setElementAttribute:function(a,b){var c=-1!==$.inArray("value",a.changed),d=b.find("input");c&&d.val(a.value),d.prop("disabled",a.isDisabled)},_isEdited:function(a){return a.val()!==this.originalText},_restore:function(a){a.val(this.originalText)},_getContentHtml:function(a){var b,c,d=a.columnName,e=this.grid.columnModel.getColumnModel(d),f=e.editOption||{},g="";return ne.util.isExisty(a.value)||(a.value=e.defaultValue),b=this._getExtraContent(f.beforeContent||f.beforeText,a),c=this._getExtraContent(f.afterContent||f.afterText,a),b&&(g+=this._getSpanWrapContent(b,"before",a)),c&&(g+=this._getSpanWrapContent(c,"after",a)),g+=this._getSpanWrapContent(this.getContentHtml(a),"input")},_onBlur:function(a){var b=$(a.target),c=this.getRowKey(b),d=this.getColumnName(b);this._isEdited(b)&&this.grid.setValue(c,d,b.val()),this.grid.selection.enable()},_onFocus:function(a){var b=$(a.target);this.originalText=b.val(),this.grid.selection.disable()},_onSelectStart:function(a){a.stopPropagation()}}),a.Painter.Cell.Text.Password=a.Painter.Cell.Text.extend({initialize:function(b,c){a.Painter.Cell.Text.prototype.initialize.apply(this,arguments)},_getInputType:function(){return"password"},getEditType:function(){return"text-password"}}),a.Painter.Cell.Text.Convertible=a.Painter.Cell.Text.extend({doubleClickDuration:800,redrawAttributes:["isDisabled","isEditable","value"],eventHandler:{click:"_onClick",mousedown:"_onMouseDown","blur input":"_onBlurConvertible","keydown input":"_onKeyDown","focus input":"_onFocus","selectstart input":"_onSelectStart"},initialize:function(){a.Painter.Cell.Text.prototype.initialize.apply(this,arguments),this.setOwnProperties({timeoutIdForClick:0,editingCell:{rowKey:null,columnName:""},clicked:{rowKey:null,columnName:null}}),this.off("resize")},getEditType:function(){return"text-convertible"},focusIn:function(a){this._startEdit(a)},focusOut:function(a){this.grid.focusClipboard()},getContentHtml:function(a){var b=this.getColumnModel(a),c=this.grid.dataModel.get(a.rowKey).getHTMLEncodedString(a.columnName),d=[];return ne.util.isUndefined(c)&&(c=""),this._isEditingCell(a)?(d.push('<span class="input">'),d.push('<input type="'),d.push(this._getInputType()),d.push('" value="'),d.push(c),d.push('" name="'),d.push(g.getUniqueKey()),d.push('" align="center" '),d.push(a.isDisabled?"disabled":""),d.push(' maxLength="'),d.push(b.editOption.maxLength),d.push('"/>'),d.push("</span>"),d.join("")):(ne.util.isFunction(b.formatter)&&(c=b.formatter(c,this.grid.dataModel.get(a.rowKey).attributes,b)),c)},_getContentHtml:function(b){var c;return c=this._isEditingCell(b)?a.Painter.Cell.Text.prototype:a.Base.Painter.Cell.prototype,c._getContentHtml.call(this,b)},_isEditingCell:function(a){var b=this.editingCell;return!(b.rowKey!==a.rowKey.toString()||b.columnName!==a.columnName.toString())},setElementAttribute:function(a,b,c){},_onBlurConvertible:function(a){var b=$(a.target),c=b.closest("td");this._onBlur(a),this._endEdit(c)},_startEdit:function(a){var b,c=this.getRowKey(a),d=this.getColumnName(a),e=this.grid.dataModel.get(c).getCellState(d);this.editingCell={rowKey:c,columnName:d},e.isEditable&&!e.isDisabled&&(this.redraw(this._getCellData(a),a),b=a.find("input"),this.originalText=b.val(),g.form.setCursorToEnd(b.get(0)),b.focus().select())},_endEdit:function(a){var b=this._getCellData(a);this.editingCell={rowKey:null,columnName:""},this.clicked={rowKey:null,columnName:null},b&&this.redraw(this._getCellData(a),a)},_onClick:function(a){var b=this,c=$(a.target),d=c.closest("td"),e=this._getCellAddress(d);this._isEditingCell(e)||(this._isClickedCell(d)?this._startEdit(d):(clearTimeout(this.timeoutIdForClick),this.clicked=e,this.timeoutIdForClick=setTimeout(function(){b.clicked={rowKey:null,columnName:null}},this.doubleClickDuration)))},_onMouseDown:function(a){$(a.target).is("input")&&a.stopPropagation()},_isClickedCell:function(a){var b=this._getCellAddress(a);return!(this.clicked.rowKey!==b.rowKey||this.clicked.columnName!==b.columnName)}}),a.CellFactory=a.Base.extend({initialize:function(){a.Base.prototype.initialize.apply(this,arguments),this._initializeInstances()},_initializeInstances:function(){var b={},c={grid:this.grid},d=[new a.Painter.Cell.MainButton(c),new a.Painter.Cell.Normal.Number(c),new a.Painter.Cell.Normal(c),new a.Painter.Cell.List.Button(c),new a.Painter.Cell.List.Select(c),new a.Painter.Cell.Text(c),new a.Painter.Cell.Text.Password(c),new a.Painter.Cell.Text.Convertible(c)];_.each(d,function(a,c){b[a.getEditType()]=a},this),this.setOwnProperties({instances:b})},getInstance:function(a){var b=this.instances[a];return b||(b="radio"===a||"checkbox"===a?this.instances.button:this.instances.normal),b}}),a.Clipboard=a.Base.extend({tagName:"textarea",className:"clipboard",events:{keydown:"_onKeyDown",focusin:"_onFocus"},_onFocus:function(a){var b,c=this.grid.focusModel,d=c.which();g.isBlank(d.columnName)&&(b=g.isBlank(d.rowKey)?0:this.grid.getIndexOfRow(d.rowKey),this.grid.focusAt(b,0))},initialize:function(){a.Base.prototype.initialize.apply(this,arguments),this.setOwnProperties({timeoutIdForKeyIn:0,isLocked:!1})},render:function(){return this},_lock:function(){clearTimeout(this.timeoutIdForKeyIn),this.isLocked=!0,this.timeoutIdForKeyIn=setTimeout($.proxy(this._unlock,this),10)},_unlock:function(){this.isLocked=!1},_onKeyDown:function(a){return this.isLocked?(a.preventDefault(),!1):(a.shiftKey&&(a.ctrlKey||a.metaKey)?this._keyInWithShiftAndCtrl(a):a.shiftKey?this._keyInWithShift(a):a.ctrlKey||a.metaKey?this._keyInWithCtrl(a):this._keyIn(a),void this._lock())},_keyIn:function(a){var b=this.grid,c=b.keyMap,d=b.focusModel,e=b.selection,f=d.which(),h=f.rowKey,i=f.columnName,j=b.dimensionModel.getDisplayRowCount(),k=!0,l=a.keyCode||a.which;if(!g.isBlank(f.rowKey)){switch(l){case c.UP_ARROW:b.focus(d.prevRowKey(),i,!0);break;case c.DOWN_ARROW:b.focus(d.nextRowKey(),i,!0);break;case c.LEFT_ARROW:b.focus(h,d.prevColumnName(),!0);break;case c.RIGHT_ARROW:b.focus(h,d.nextColumnName(),!0);break;case c.PAGE_UP:b.focus(d.prevRowKey(j-1),i,!0);break;case c.PAGE_DOWN:b.focus(d.nextRowKey(j-1),i,!0);break;case c.HOME:b.focus(h,d.firstColumnName(),!0);break;case c.END:b.focus(h,d.lastColumnName(),!0);break;case c.SPACE:case c.ENTER:this._onEnterSpace(h,i);break;case c.DEL:this._del(h,i);break;case c.TAB:b.focusIn(h,d.nextColumnName(),!0);break;case c.CHAR_V:break;default:k=!1}return k&&a.preventDefault(),e.endSelection(),k}},_onEnterSpace:function(a,b){var c,d=this.grid,e=this.grid.columnModel.getEditType(b);"_button"===e?(c=this.grid.cellFactory.getInstance(e),c.toggle(d.getElement(a,b))):d.focusIn(a,b)},_keyInWithShift:function(a){var b=this.grid,c=b.keyMap,d=b.focusModel,e=b.columnModel.getVisibleColumnModelList(),f=b.focusModel.indexOf(),g=d.which(),h=!0,i=b.dimensionModel.getDisplayRowCount(),j=a.keyCode||a.which;switch(j){case c.UP_ARROW:this._updateSelectionByKeyIn(d.prevRowIndex(),f.columnIdx);break;case c.DOWN_ARROW:this._updateSelectionByKeyIn(d.nextRowIndex(),f.columnIdx);break;case c.LEFT_ARROW:this._updateSelectionByKeyIn(f.rowIdx,d.prevColumnIndex());break;case c.RIGHT_ARROW:this._updateSelectionByKeyIn(f.rowIdx,d.nextColumnIndex());break;case c.PAGE_UP:this._updateSelectionByKeyIn(d.prevRowIndex(i-1),f.columnIdx);break;case c.PAGE_DOWN:this._updateSelectionByKeyIn(d.nextRowIndex(i-1),f.columnIdx);break;case c.HOME:this._updateSelectionByKeyIn(f.rowIdx,0);break;case c.END:this._updateSelectionByKeyIn(f.rowIdx,e.length-1);break;case c.ENTER:break;case c.TAB:b.focusIn(g.rowKey,d.prevColumnName(),!0);break;case c.CHAR_V:break;default:h=!1}return h&&a.preventDefault(),h},_keyInWithCtrl:function(a){var b=this.grid,c=b.keyMap,d=b.focusModel,e=!0,f=a.keyCode||a.which;switch(f){case c.CHAR_A:this.grid.selection.selectAll();break;case c.CHAR_C:this._copyToClipboard();break;case c.HOME:b.focus(d.firstRowKey(),d.firstColumnName(),!0);break;case c.END:b.focus(d.lastRowKey(),d.lastColumnName(),!0);break;case c.CHAR_V:this._paste();break;default:e=!1}return e},_paste:function(){this._clearClipBoard(),this.pasting||(this.pasting=!0,this._onKeyupCharV())},_onKeyupCharV:function(){this.$el.on("keyup",$.proxy(this.onKeyupCharV,this))},onKeyupCharV:function(){this._pasteToGrid(),this.pasting=!1},_clearClipBoard:function(){this.$el.val("")},_pasteToGrid:function(){var a=this._getProcessClipBoardData();this.$el.off("keyup"),this.grid.paste(a)},_getProcessClipBoardData:function(){for(var a=this.$el.val(),b=a.split("\n"),c=0,d=b.length;d>c;c+=1)b[c]=b[c].split("	");return b},_keyInWithShiftAndCtrl:function(a){var b=this.grid,c=b.keyMap,d=!0,e=b.columnModel.getVisibleColumnModelList(),f=a.keyCode||a.which;switch(f){case c.HOME:this._updateSelectionByKeyIn(0,0);break;case c.END:this._updateSelectionByKeyIn(b.dataModel.length-1,e.length-1);break;default:d=!1}return d&&a.preventDefault(),d},_del:function(){var a,b,c,d=this.grid,e=d.selection,f=d.dataModel,g=d.focusModel.which(),h=d.columnModel.getVisibleColumnModelList(),i=g.rowKey,j=g.columnName;if(e.hasSelection()){for(a=e.getRange(),b=a.row[0];b<a.row[1]+1;b++)for(i=f.at(b).get("rowKey"),c=a.column[0];c<a.column[1]+1;c++)j=h[c].columnName,d.del(i,j,!0);d.renderModel.refresh()}else d.del(i,j)},_updateSelectionByKeyIn:function(a,b){var c=this.grid.selection,d=this.grid.focusModel.indexOf();c.hasSelection()||c.startSelection(d.rowIdx,d.columnIdx),c.updateSelection(a,b),this.grid.focusAt(a,b,!0)},_getClipboardString:function(){var a,b=this.grid.selection,c=this.grid.focusModel.which();return a=b.isShown()?this.grid.selection.getSelectionToString():this.grid.dataModel.get(c.rowKey).getVisibleText(c.columnName)},_copyToClipboard:function(){var a=this._getClipboardString();window.clipboardData?window.clipboardData.setData("Text",a):this.$el.val(a).select()}}),a.RowList=a.Base.extend({initialize:function(b){var c,d;a.Base.prototype.initialize.apply(this,arguments),d=b&&b.whichSide||"R",this.setOwnProperties({whichSide:d,bodyView:b.bodyView,columnModelList:this.grid.columnModel.getVisibleColumnModelList(d),sortOptions:null,renderedRowKeys:null,rowPainter:null}),this._createRowPainter(),this._delegateTableEventsFromBody(),this._focusClipboardDebounced=_.debounce(this._focusClipboard,10),c=this.grid.focusModel,this.listenTo(this.collection,"change",this._onModelChange).listenTo(c,"select",this._onSelect,this).listenTo(c,"unselect",this._onUnselect,this).listenTo(c,"focus",this._onFocus,this).listenTo(c,"blur",this._onBlur,this).listenTo(this.grid.renderModel,"rowListChanged",this.render,this)},_createRowPainter:function(){this.rowPainter=new a.Painter.Row({grid:this.grid,columnModelList:this.columnModelList})},_removeOldRows:function(a){var b=_.indexOf(this.renderedRowKeys,a[0]),c=_.indexOf(this.renderedRowKeys,_.last(a)),d=this.$el.children("tr");d.slice(0,b).remove(),d.slice(c+1).remove()},_appendNewRows:function(a,b){var c=this.collection.slice(0,_.indexOf(a,b[0])),d=this.collection.slice(_.indexOf(a,_.last(b))+1);this.$el.prepend(this._getRowsHtml(c)),this.$el.append(this._getRowsHtml(d))},_resetRows:function(){var b,c=this._getRowsHtml(this.collection.models);a.RowList.isInnerHtmlOfTbodyReadOnly?(b=this.bodyView.redrawTable(c),this.setElement(b,!1),ne.util.browser.msie&&ne.util.browser.version<=7&&b.width(b.width())):this.$el[0].innerHTML=c},_getRowsHtml:function(a){return _.map(a,this.rowPainter.getHtml,this.rowPainter).join("")},_focusClipboard:function(){try{this.grid.focusClipboard()}catch(a){}},_getRowElement:function(a){return this.$el.find('tr[key="'+a+'"]')},_onSelect:function(a){this._setCssSelect(a,!0)},_onUnselect:function(a){this._setCssSelect(a,!1)},_setCssSelect:function(a,b){var c,d,e,f,g=this.grid,h=this.columnModelList,i={};_.each(h,function(h){c=h.columnName,f=g.dataModel.getMainRowKey(a,c),i[f]=i[f]||this._getRowElement(f),d=i[f],e=d.find('td[columnname="'+c+'"]'),e.length&&e.toggleClass("selected",b)},this)},_onBlur:function(a,b){var c=this.grid.getElement(a,b);c.length&&c.removeClass("focused")},_onFocus:function(a,b){var c=this.grid.getElement(a,b);c.length&&c.addClass("focused")},render:function(a){var b,c=this.collection.pluck("rowKey");return a?this._resetRows():(b=_.intersection(c,this.renderedRowKeys),_.isEmpty(c)||_.isEmpty(b)||b.length/c.length<.7?this._resetRows():(this._removeOldRows(b),this._appendNewRows(c,b))),this.renderedRowKeys=c,this._focusClipboardDebounced(),this._showLayer(),this},_delegateTableEventsFromBody:function(){this.bodyView.attachTableEventHandler("tr",this.rowPainter.getEventHandlerInfo()),_.each(this.rowPainter.getCellPainters(),function(a,b){var c="td[edit-type="+b+"]",d=a.getEventHandlerInfo();this.bodyView.attachTableEventHandler(c,d)},this)},_onModelChange:function(a){var b=this._getRowElement(a.get("rowKey"));this.rowPainter.onModelChange(a,b)},_showLayer:function(){this.grid.dataModel.length?this.grid.hideGridLayer():this.grid.showGridLayer("empty")}},{isInnerHtmlOfTbodyReadOnly:ne.util.browser.msie&&ne.util.browser.version<=9}),a.Selection=a.Base.extend({events:{},initialize:function(){a.Base.prototype.initialize.apply(this,arguments),this.setOwnProperties({range:{column:[-1,-1],row:[-1,-1]},spannedRange:{column:[-1,-1],row:[-1,-1]},lside:null,rside:null,pageX:0,pageY:0,intervalIdForAutoScroll:0,scrollPixelScale:40,isEnable:!0,_isShown:!1}),this.listenTo(this.grid.dimensionModel,"columnWidthChanged",this._onColumnWidthChanged,this).listenTo(this.grid.dataModel,"add remove sort reset",this.endSelection,this)},enable:function(){this.grid.option("useDataCopy")&&(this.isEnable=!0)},disable:function(){this.endSelection(),this.isEnable=!1},attachMouseEvent:function(a,b){this.isEnable&&(this.setOwnProperties({pageX:a,pageY:b}),this.grid.updateLayoutData(),$(document).on("mousemove",$.proxy(this._onMouseMove,this)),$(document).on("mouseup",$.proxy(this._onMouseUp,this)),$(document).on("selectstart",$.proxy(this._onSelectStart,this)))},detachMouseEvent:function(){clearInterval(this.intervalIdForAutoScroll),$(document).off("mousemove",$.proxy(this._onMouseMove,this)),$(document).off("mouseup",$.proxy(this._onMouseUp,this)),$(document).off("selectstart",$.proxy(this._onSelectStart,this))},onMouseDown:function(a){var b,c,d=this.grid,e=this;a.shiftKey?(b=d.focusModel.indexOf(!0),e.hasSelection()||e.startSelection(b.rowIdx,b.columnIdx),e.attachMouseEvent(a.pageX,a.pageY),c=e.getIndexFromMousePosition(a.pageX,a.pageY),e.updateSelection(c.row,c.column),d.focusAt(c.row,c.column)):(e.endSelection(),e.attachMouseEvent(a.pageX,a.pageY))},_onMouseMove:function(a){var b;clearInterval(this.intervalIdForAutoScroll),this.hasSelection()?(b=this.getIndexFromMousePosition(a.pageX,a.pageY),this.updateSelection(b.row,b.column),this.grid.focusAt(b.row,b.column),this._isAutoScrollable(b.overflowX,b.overflowY)&&(this.intervalIdForAutoScroll=setInterval($.proxy(this._adjustScroll,this,b.overflowX,b.overflowY)))):this._getDistance(a)>10&&(b=this.getIndexFromMousePosition(this.pageX,this.pageY),this.startSelection(b.row,b.column))},_isAutoScrollable:function(a,b){return!(0===a&&0===b)},_adjustScroll:function(a,b){var c=this.grid.renderModel,d=c.get("scrollLeft"),e=c.get("maxScrollLeft"),f=c.get("scrollTop");0>a?c.set("scrollLeft",Math.min(Math.max(0,d-this.scrollPixelScale),e)):a>0&&c.set("scrollLeft",Math.min(Math.max(0,d+this.scrollPixelScale),e)),0>b?c.set("scrollTop",Math.max(0,f-this.scrollPixelScale)):b>0&&c.set("scrollTop",Math.max(0,f+this.scrollPixelScale))},_getDistance:function(a){var b=a.pageX,c=a.pageY,d=Math.abs(this.pageX-b),e=Math.abs(this.pageY-c);return Math.round(Math.sqrt(Math.pow(d,2)+Math.pow(e,2)))},_onMouseUp:function(){this.detachMouseEvent()},getIndexFromMousePosition:function(a,b){var c,d,e=this._getContainerPosition(a,b),f=this.grid.dimensionModel,g=this.grid.renderModel,h=f.getColumnWidthList(),i=g.get("scrollTop"),j=g.get("scrollLeft"),k=f.getFrameWidth(),l=e.pageY+i,m=e.pageX,n=0,o=0,p=f.get("lsideWidth")>e.pageX,q=h.length,r=0,s=this.grid.option("scrollX")?f.get("bodyHeight")-this.grid.scrollBarSize:f.get("bodyHeight"),t=this.grid.option("scrollY")?f.get("width")-this.grid.scrollBarSize:f.get("width");return p||(m+=j),c=Math.max(0,Math.min(Math.floor(l/(f.get("rowHeight")+1)),this.grid.dataModel.length-1)),e.pageY<0?o=-1:e.pageY>s&&(o=1),e.pageX<0?n=-1:e.pageX>t&&(n=1),0>m?d=0:m>k?d=q-1:ne.util.forEachArray(h,function(a,b){return r+=a+1,r>=m?(d=b,!1):void 0}),{row:c,column:d,overflowX:n,overflowY:o}},getRange:function(){return $.extend(!0,{},this.spannedRange)},getSelectionToString:function(){var a,b,c=this.grid.columnModel.getVisibleColumnModelList().slice(this.spannedRange.column[0],this.spannedRange.column[1]+1),d={_button:!0},e=[],f=[],g=[],h=this.grid.renderModel.get("startNumber")+this.spannedRange.row[0];return _.each(c,function(a){e.push(a.columnName)}),a=this.grid.dataModel.slice(this.spannedRange.row[0],this.spannedRange.row[1]+1),_.each(a,function(a,b){f=[],_.each(e,function(c,g){d[c]||f.push("_number"===e[g]?h+b:a.getVisibleText(c))}),g.push(f.join("	"))}),b=g.join("\n")},createLayer:function(b){var c="R"===b?a.Selection.Layer.Rside:a.Selection.Layer.Lside,d=this._getLayer(b);return d&&ne.util.isFunction(d.destroy())&&d.destroy(),d=this.createView(c,{grid:this.grid,columnWidthList:this.grid.dimensionModel.getColumnWidthList(b)}),"R"===b?this.rside=d:this.lside=d,d},selectAll:function(){this.isEnable&&(this.startSelection(0,0),this.updateSelection(this.grid.dataModel.length-1,this.grid.columnModel.getVisibleColumnModelList().length-1))},startSelection:function(a,b){this.isEnable&&(this.range.row[0]=this.range.row[1]=a,this.range.column[0]=this.range.column[1]=b,this.show())},updateSelection:function(a,b){this.isEnable&&(this.range.row[1]=a,this.range.column[1]=b,this.show())},endSelection:function(){this.range.row[0]=this.range.row[1]=this.range.column[0]=this.range.column[1]=-1,this.spannedRange.row[0]=this.spannedRange.row[1]=this.spannedRange.column[0]=this.spannedRange.column[1]=-1,this.hide(),this.detachMouseEvent()},_onColumnWidthChanged:function(){this.show()},show:function(){if(this.isEnable&&this.hasSelection()){this._isShown=!0;var a,b=this.grid.dataModel,c=this.grid.columnModel.get("columnFixIndex"),d=(this.grid.dimensionModel.get("rowHeight"),Math.min.apply(Math,this.range.row)),e=Math.max.apply(Math,this.range.row),f=Math.min.apply(Math,this.range.column),g=Math.max.apply(Math,this.range.column),h={row:[d,e],column:[f,g]};if(b.isRowSpanEnable()){a=$.extend([],h.row);do a=$.extend([],h.row),h=this._getRowSpannedIndex(h);while(h.row[0]!==a[0]||h.row[1]!==a[1])}this.spannedRange=h,this.lside.show(h),this.rside.show({row:h.row,column:[Math.max(-1,h.column[0]-c),Math.max(-1,h.column[1]-c)]}),this.grid.focusClipboard()}},hide:function(){this._isShown=!1,this.lside&&this.lside.hide(),this.rside&&this.rside.hide()},isShown:function(){return this._isShown},getStartIndex:function(){return{rowIdx:this.range.row[0],columnIdx:this.range.column[0]}},getEndIndex:function(){return{rowIdx:this.range.row[1],columnIdx:this.range.column[1]}},_getLayer:function(a){return"R"===a?this.rside:this.lside},_getContainerPosition:function(a,b){var c=this.grid.dimensionModel,d=a-c.get("offsetLeft"),e=b-(c.get("offsetTop")+c.get("headerHeight")+2);return{pageX:d,pageY:e}},_onSelectStart:function(a){return a.preventDefault(),!1},hasSelection:function(){return!(-1===this.range.row[0])},_getRowSpannedIndex:function(a){function b(a){var b,c=a.startIndex,d=a.endIndex,e=a.startRowSpanDataMap&&a.startRowSpanDataMap[k],f=a.startIndexList,g=a.endIndexList;e&&(e.isMainRow?(b=c+e.count-1,b>d&&g.push(b)):(b=c+e.count,f.push(b)))}function c(a){var b,c,d=a.endIndex,e=a.columnName,f=a.endRowSpanDataMap&&a.endRowSpanDataMap[e],g=a.endIndexList,h=a.dataModel;f&&(f.isMainRow?(b=d+f.count-1,g.push(b)):(b=d+f.count,c=h.at(b).getRowSpanData(e),b+=c.count-1,b>d&&g.push(b)))}var d=this.grid.columnModel.get("columnModelList").slice(a.column[0],a.column[1]+1),e=this.grid.dataModel,f=[a.row[0]],g=[a.row[1]],h=e.at(a.row[0]),i=e.at(a.row[1]),j=$.extend({},a);if(h&&i){var k,l,m=e.at(a.row[0]).getRowSpanData(),n=e.at(a.row[1]).getRowSpanData();_.each(d,function(d){k=d.columnName,l={columnName:k,startIndex:a.row[0],endIndex:a.row[1],endRowSpanDataMap:n,startRowSpanDataMap:m,startIndexList:f,endIndexList:g,dataModel:e},b(l),c(l)},this),j.row=[Math.min.apply(Math,f),Math.max.apply(Math,g)]}return j},destroy:function(){this.stopListening(),this.detachMouseEvent(),this.destroyChildren(),this.remove()}}),a.Selection.Layer=a.Base.extend({tagName:"div",className:"selection_layer",events:{mousedown:"_onMouseDown"},initialize:function(b){a.Base.prototype.initialize.apply(this,arguments),this.listenTo(this.grid.dimensionModel,"columnWidthChanged",this._updateColumnWidthList,this),this.setOwnProperties({columnWidthList:b.columnWidthList,spannedRange:{row:[-1,-1],column:[-1,-1]},whichSide:"R"})},_onMouseDown:function(a){this.grid.selection.onMouseDown(a)},_updateColumnWidthList:function(){this.columnWidthList=this.grid.dimensionModel.getColumnWidthList(this.whichSide)},_getGeometryStyles:function(a){a=a||this.indexObj;var b,c,d=1,e=this.columnWidthList,f=a.row,h=a.column,i=this.grid.dimensionModel.get("rowHeight"),j=g.getHeight(f[0],i)+1,k=g.getHeight(f[1]-f[0]+1,i)-3,l=e.length,m="block",n=0,o=0;for(c=0;c<h[1]+1&&l>c;c++)c<h[0]?n+=e[c]+d:o+=e[c]+d;return o-=d,(0>=o||0>=k)&&(m="none"),b={display:m,width:o+"px",height:k+"px",top:j+"px",left:n+"px"}},show:function(a){this.indexObj=a,this.$el.css(this._getGeometryStyles(a))},hide:function(){this.$el.css({display:"none",width:"0px",height:"0px",top:0,left:0})},render:function(){return this}}),a.Selection.Layer.Lside=a.Selection.Layer.extend({initialize:function(){a.Selection.Layer.prototype.initialize.apply(this,arguments),this.setOwnProperties({whichSide:"L"})}}),a.Selection.Layer.Rside=a.Selection.Layer.extend({initialize:function(){a.Selection.Layer.prototype.initialize.apply(this,arguments),this.setOwnProperties({whichSide:"R"})}}),e.Net=a.Base.extend({events:{submit:"_onSubmit"},initialize:function(b){a.Base.prototype.initialize.apply(this,arguments);var c={initialRequest:!0,api:{readData:"",createData:"",updateData:"",deleteData:"",modifyData:"",downloadData:"",downloadAllData:""},perPage:500,enableAjaxHistory:!0},d=$.extend(!0,c,b),e=this.grid.getPaginationInstance();this.setOwnProperties({curPage:1,perPage:d.perPage,options:d,router:null,pagination:e,requestedFormData:null,isLocked:!1,lastRequestedReadData:null}),this._initializeDataModelNetwork(),this._initializeRouter(),this._initializePagination(),this.listenTo(this.grid.dataModel,"sortChanged",this._onSortChanged,this),d.initialRequest&&this._readDataAt(1,!1)},_initializePagination:function(){var a=this.pagination;a&&(a.setOption("itemPerPage",this.perPage),a.setOption("itemCount",1),a.on("beforeMove",$.proxy(this._onPageBeforeMove,this)))},_initializeDataModelNetwork:function(){this.grid.dataModel.url=this.options.api.readData,this.grid.dataModel.sync=$.proxy(this._sync,this)},_initializeRouter:function(){this.options.enableAjaxHistory&&(this.router=new e.Net.Router({grid:this.grid,net:this}),Backbone.History.started||Backbone.history.start())},_onPageBeforeMove:function(a){var b=a.page;this.curPage!==b&&this._readDataAt(b,!0)},_onSubmit:function(a){a.preventDefault(),this._readDataAt(1,!1)},setFormData:function(a){g.form.setFormData(this.$el,a)},_sync:function(a,b,c){var d;"read"===a?(c=c||{},d=$.extend({},c),c.url||(d.url=_.result(b,"url")),this._ajax(d)):Backbone.sync.call(Backbone,a,b,c)},_lock:function(){this.grid.showGridLayer("loading"),this.isLocked=!0},_unlock:function(){this.isLocked=!1},_getFormData:function(){return g.form.getFormData(this.$el)},_onReadSuccess:function(a,b,c){a.setOriginalRowList();var d,e,f=this.pagination;f&&b.pagination&&(d=b.pagination.page,e=b.pagination.totalCount,f.setOption("itemPerPage",this.perPage),f.setOption("itemCount",e),f.movePageTo(d),this.curPage=d)},_onReadError:function(a,b,c){},reloadData:function(){this.readData(this.lastRequestedReadData)},readData:function(a){var b=1,c=this.grid;this.isLocked||(c.renderModel.initializeVariables(),this._lock(),this.requestedFormData=_.clone(a),this.curPage=a.page||this.curPage,b=(this.curPage-1)*this.perPage+1,c.renderModel.set({startNumber:b}),this.lastRequestedReadData=_.clone(a),c.dataModel.fetch({requestType:"readData",data:a,type:"POST",success:$.proxy(this._onReadSuccess,this),error:$.proxy(this._onReadError,this),reset:!0}),c.dataModel.setSortOptionValues(a.sortColumn,a.sortAscending))},_onSortChanged:function(a){a.isRequireFetch&&this._readDataAt(1,!0,a)},_changeSortOptions:function(a,b){b&&("rowKey"===b.columnName?(delete a.sortColumn,delete a.sortAscending):(a.sortColumn=b.columnName,a.sortAscending=b.isAscending))},_readDataAt:function(a,b,c){b=void 0===b?!0:b;var d=b?this.requestedFormData:this._getFormData();d.page=a,d.perPage=this.perPage,this._changeSortOptions(d,c),this.router&&this.router.navigate("read/"+g.toQueryString(d),{trigger:!1}),this.readData(d)},request:function(a,b){var c={url:this.options.api[a],type:null,hasDataParam:!0,isOnlyChecked:!0,isOnlyModified:!0,isSkipConfirm:!1},d=$.extend(c,b),e=this._getRequestParam(a,d);e&&this._ajax(e)},_getDataParam:function(a,b){var c={hasDataParam:!0,isOnlyModified:!0,isOnlyChecked:!0};b=$.extend(c,b);var d,e=b.hasDataParam,f=b.isOnlyModified,g=b.isOnlyChecked,h=this.grid.dataModel,i={createData:["createList"],updateData:["updateList"],deleteData:["deleteList"],modifyData:["createList","updateList","deleteList"]},j=i[a],k=$.extend({},this.requestedFormData),l=0;return e&&(f?(d=h.getModifiedRowList({isOnlyChecked:g}),_.each(d,function(a,b){-1!==$.inArray(b,j)&&(l+=a.length),d[b]=$.toJSON(a)},this)):(d={rowList:h.getRowList(g)},l=d.rowList.length)),
k=$.extend(k,d),{data:k,count:l}},_getRequestParam:function(a,b){var c,d={url:this.options.api[a],type:null,hasDataParam:!0,isOnlyModified:!0,isOnlyChecked:!0},e=$.extend(d,b),f=this._getDataParam(a,e);return e.isSkipConfirm||this._isConfirmed(a,f.count)?c={requestType:a,url:e.url,data:f.data,type:e.type}:void 0},_isConfirmed:function(a,b){return b>0?confirm(this._getConfirmMessage(a,b)):(alert(this._getConfirmMessage(a,b)),!1)},_getConfirmMessage:function(a,b){var c={createData:"입력",updateData:"수정",deleteData:"삭제",modifyData:"반영"},d=c[a];return b>0?b+"건의 데이터를 "+d+"하시겠습니까?":d+"할 데이터가 없습니다."},_ajax:function(a){var b=this.createEventData(a.data);if(this.grid.trigger("beforeRequest",b),!b.isStopped()){a=$.extend({requestType:""},a);var c={url:a.url,data:a.data||{},type:a.type||"POST",dataType:a.dataType||"json",complete:$.proxy(this._onComplete,this,a.complete,a),success:$.proxy(this._onSuccess,this,a.success,a),error:$.proxy(this._onError,this,a.error,a)};a.url&&$.ajax(c)}},_onComplete:function(a,b,c){this._unlock()},_onSuccess:function(a,b,c,d,e){var f=c&&c.message,g=this.createEventData({httpStatus:d,requestType:b.requestType,requestParameter:b.data,responseData:c});if(this.grid.trigger("response",g),!g.isStopped())if(c&&c.result){if(this.grid.trigger("successResponse",g),g.isStopped())return;_.isFunction(a)&&a(c.data||{},d,e)}else{if(this.grid.trigger("failResponse",g),g.isStopped())return;f?alert(f):null}},_onError:function(a,b,c,d,e){var f=this.createEventData({httpStatus:d,requestType:b.requestType,requestParameter:b.data,responseData:null});this.grid.hideGridLayer(),this.grid.trigger("response",f),f.isStopped()||(this.grid.trigger("errorResponse",f),f.isStopped()||c.readyState>1&&alert("데이터 요청 중에 에러가 발생하였습니다.\n\n다시 시도하여 주시기 바랍니다."))}}),e.Net.Router=Backbone.Router.extend({routes:{"read/:queryStr":"read"},initialize:function(a){this.setOwnProperties({grid:a&&a.grid||null,net:a&&a.net||null})},read:function(a){var b=g.toQueryObject(a);this.net.setFormData(b),this.net.readData(b)},setOwnProperties:f});var h=a.Base.extend({scrollBarSize:17,lside:null,rside:null,toolbar:null,cellFactory:null,events:{click:"_onClick",dblclick:"_onDblclick",mousedown:"_onMouseDown",selectstart:"_preventDrag",dragstart:"_preventDrag",mouseover:"_onMouseOver",mouseout:"_onMouseOut"},keyMap:{TAB:9,ENTER:13,CTRL:17,ESC:27,LEFT_ARROW:37,UP_ARROW:38,RIGHT_ARROW:39,DOWN_ARROW:40,CHAR_A:65,CHAR_C:67,CHAR_F:70,CHAR_R:82,CHAR_V:86,LEFT_WINDOW_KEY:91,F5:116,BACKSPACE:8,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,HOME:36,END:35,DEL:46,UNDEFINED:229},keyName:{9:"TAB",13:"ENTER",17:"CTRL",27:"ESC",37:"LEFT_ARROW",38:"UP_ARROW",39:"RIGHT_ARROW",40:"DOWN_ARROW",65:"CHAR_A",67:"CHAR_C",70:"CHAR_F",82:"CHAR_R",86:"CHAR_V",91:"LEFT_WINDOW_KEY",116:"F5",8:"BACKSPACE",32:"SPACE",33:"PAGE_UP",34:"PAGE_DOWN",36:"HOME",35:"END",46:"DEL",229:"UNDEFINED"},initialize:function(b){a.Base.prototype.initialize.apply(this,arguments),this.publicInstance=b.publicInstance;var c=g.getUniqueKey();this.__instance[c]=this,this.id=c,this._initializeOptions(b),this._initializeProperties(),this._initializeModel(),this._initializeListener(),this._initializeView(),this._initializeScrollBar(),this._attachExtraEvent(),this.render(),this.updateLayoutData()},_initializeOptions:function(a){var b={columnFixIndex:0,columnModelList:[],keyColumnName:null,selectType:"",autoNumbering:!0,headerHeight:35,rowHeight:27,displayRowCount:10,minimumColumnWidth:50,notUseSmartRendering:!1,columnMerge:[],scrollX:!0,scrollY:!0,useDataCopy:!0,useClientSort:!0,toolbar:{hasResizeHandler:!0,hasControlPanel:!0,hasPagination:!0}};this.options=$.extend(!0,b,a)},_initializeProperties:function(){this.setOwnProperties({cellFactory:null,selection:null,columnModel:null,dataModel:null,renderModel:null,layoutModel:null,focusModel:null,addOn:{},view:{lside:null,rside:null,toolbar:null,clipboard:null,layer:{ready:null,loading:null,empty:null}},timeoutIdForBlur:0,timeoutIdForResize:0,timeoutIdForSetRowList:0,__$el:this.$el.clone()})},_initializeModel:function(){var a=this.$el.offset();this.columnModel=new c.ColumnModel({grid:this,hasNumberColumn:this.option("autoNumbering"),keyColumnName:this.option("keyColumnName"),columnFixIndex:this.option("columnFixIndex"),selectType:this.option("selectType")}),this.setColumnModelList(this.option("columnModelList")),this.dimensionModel=new b.Dimension({grid:this,offsetTop:a.top,offsetLeft:a.left,width:this.$el.width(),height:this.$el.height(),headerHeight:this.option("headerHeight"),rowHeight:this.option("rowHeight"),scrollX:!!this.option("scrollX"),scrollY:!!this.option("scrollY"),scrollBarSize:this.scrollBarSize,minimumColumnWidth:this.option("minimumColumnWidth"),displayRowCount:this.option("displayRowCount")}),this.focusModel=new b.Focus({grid:this,scrollX:!!this.option("scrollX"),scrollY:!!this.option("scrollY"),scrollBarSize:this.scrollBarSize}),this.dataModel=new c.RowList([],{grid:this,useClientSort:this.option("useClientSort")}),this.dataModel.reset([]),this.option("notUseSmartRendering")?this.renderModel=new b.Renderer({grid:this}):this.renderModel=new b.Renderer.Smart({grid:this})},_initializeView:function(){this.cellFactory=this.createView(a.CellFactory,{grid:this}),this.selection=this.createView(a.Selection,{grid:this}),this.view.lside=this.createView(a.Layout.Frame.Lside,{grid:this}),this.view.rside=this.createView(a.Layout.Frame.Rside,{grid:this}),this.view.toolbar=this.createView(a.Layout.Toolbar,{grid:this}),this.view.layer.ready=this.createView(a.Layer.Ready,{grid:this}),this.view.layer.empty=this.createView(a.Layer.Empty,{grid:this}),this.view.layer.loading=this.createView(a.Layer.Loading,{grid:this}),this.view.clipboard=this.createView(a.Clipboard,{grid:this}),this.options&&!this.options.useDataCopy&&this.selection.disable()},_initializeListener:function(){this.listenTo(this.dimensionModel,"change:width",this._onWidthChange).listenTo(this.dimensionModel,"change:bodyHeight",this._setHeight).listenTo(this.focusModel,"select",this._onRowSelectChanged)},_initializeScrollBar:function(){},_attachExtraEvent:function(){$(window).on("resize",$.proxy(this._onWindowResize,this)),$(document).on("focusin",$.proxy(this._onBlur,this))},_onBlur:function(){clearTimeout(this.timeoutIdForBlur),this.timeoutIdForBlur=setTimeout($.proxy(this._doBlur,this),0)},_doBlur:function(){var a,b;this.$el&&(a=this.$el.find(":focus"),b=!!a.length,b?(a.is("td")||a.is("a"))&&this.focusClipboard():this.focusModel.blur())},_preventDrag:function(){return!1},_onWindowResize:function(){var a=this.option("minimumWidth")||0,b=this.$el.width();a>b?this.$el.css("width",a+"px"):this.$el.css("width","auto"),this.dimensionModel.set("width",Math.max(b,a))},_onClick:function(a){var b=this.createEventData(a),c=$(a.target);this.trigger("click",b),b.isStopped()||this._isCellElement(c,!0)&&this._triggerCellMouseEvent("clickCell",b,c.closest("td"))},_onDblclick:function(a){var b=this.createEventData(a),c=$(a.target);this.trigger("dblclick",b),b.isStopped()||this._isCellElement(c,!0)&&this._triggerCellMouseEvent("dblclickCell",b,c.closest("td"))},_onMouseOver:function(a){var b,c=$(a.target);this._isCellElement(c)&&(b=this.createEventData(a),this._triggerCellMouseEvent("mouseoverCell",b,c))},_onMouseOut:function(a){var b,c=$(a.target);this._isCellElement(c)&&(b=this.createEventData(a),this._triggerCellMouseEvent("mouseoutCell",b,c))},_triggerCellMouseEvent:function(a,b,c){_.extend(b,this._getCellInfoFromElement(c)),this.trigger(a,b)},_isCellElement:function(a,b){var c=b?a.closest("td"):a;return c.is("td")?!(!c.parent().attr("key")||!c.attr("columnname")):!1},_getCellInfoFromElement:function(a){var b=a.parent().attr("key"),c=a.attr("columnname");return{rowKey:b,columnName:c,rowData:this.getRow(b)}},_onMouseDown:function(a){var b=$(a.target),c=this.createEventData(a);this.trigger("mousedown",c),c.isStopped()||b.is("input, a, button, select")||(a.preventDefault(),this.selection.show(),this.focusClipboard())},_onRowSelectChanged:function(a){"radio"===this.columnModel.get("selectType")&&(this.uncheckAll(),this.check(a)),this.trigger("selectRow",{rowKey:a,rowData:this.getRow(a)})},_onWidthChange:function(){this.updateLayoutData()},updateLayoutData:function(){var a=this.$el.offset(),b=this.dimensionModel.getFrameWidth("R"),c=b-this.dimensionModel.get("rsideWidth");this.renderModel.set({maxScrollLeft:c}),this.dimensionModel.set({offsetTop:a.top,offsetLeft:a.left,width:this.$el.width(),height:this.$el.height(),toolbarHeight:this.view.toolbar.$el.height()})},option:function(a,b){return ne.util.isUndefined(b)?(this.options=this.options||{},this.options[a]):(this.options[a]=b,this)},readyForKeyControl:function(){this.focusClipboard()},focusClipboard:function(){ne.util.isExisty(ne.util.pick(this,"view","clipboard"))&&this.view.clipboard.$el.focus()},render:function(){var a=$("<div>").addClass("left_line"),b=$("<div>").addClass("right_line");this.$el.addClass("grid_wrapper").addClass("uio_grid").attr("instanceId",this.id).append(this.view.layer.empty.render().el).append(this.view.layer.loading.render().el).append(this.view.layer.ready.render().el),this.view.layer.loading.show("초기화 중입니다."),this.$el.append(this.view.lside.render().el).append(this.view.rside.render().el).append(this.view.toolbar.render().el).append(a).append(b).append(this.view.clipboard.render().el),this._setHeight(),this.trigger("rendered")},_setHeight:function(){var a=this.dimensionModel.get("bodyHeight"),b=this.dimensionModel.get("headerHeight"),c=this.view.toolbar.$el.height(),d=c+b+a;this.$el.css("height",d+"px"),this.dimensionModel.set({toolbarHeight:c})},getValue:function(a,b,c){var d;return d=c?this.dataModel.getOriginal(a,b):this.dataModel.get(a).get(b)},getColumnValues:function(a,b){var c=this.dataModel.pluck(a);return b?$.toJSON(c):c},getRow:function(a,b){var c=this.dataModel.get(a);return c=c&&c.toJSON(),b?$.toJSON(c):c},getRowAt:function(a,b){var c=this.dataModel.at(a).toJSON();return c=b?$.toJSON(c):c},getRowCount:function(){return this.dataModel.length},getElement:function(a,b){var c=this.columnModel.isLside(b)?this.view.lside.$el:this.view.rside.$el;return a=this.dataModel.getMainRowKey(a,b),c.find('tr[key="'+a+'"]').find('td[columnname="'+b+'"]')},select:function(a){this.focusModel.select(a)},unselect:function(){this.focusModel.unselect(!0)},getSelectedRowKey:function(){return this.focusModel.which().rowKey},setValue:function(a,b,c,d){c=_.isString(c)?$.trim(c):c;var e=this.dataModel.get(a),f={};return e?(f[b]=c,e.set(f,{silent:d}),!0):!1},setColumnValues:function(a,b,c,d){c=void 0===c?!0:c;var e={},f={isDisabled:!1,isEditable:!0};e[a]=b,this.dataModel.forEach(function(b){c&&(f=this.getCellState(b.get("rowKey"),a)),!f.isDisabled&&f.isEditable&&b.set(e,{silent:d})},this)},replaceRowList:function(a,b){var c=ne.util.bind(function(){this.dataModel.set(a,{parse:b})},this);this.showGridLayer("loading"),b=void 0===b?!0:b,a&&a.length>500?(clearTimeout(this.timeoutIdForSetRowList),this.timeoutIdForSetRowList=setTimeout($.proxy(function(){c()},this),0)):c()},setRowList:function(a,b){var c=ne.util.bind(function(){this.dataModel.reset(a,{parse:b}),this.dataModel.setOriginalRowList()},this);this.showGridLayer("loading"),b=void 0===b?!0:b,a&&a.length>500?(clearTimeout(this.timeoutIdForSetRowList),this.timeoutIdForSetRowList=setTimeout($.proxy(function(){c()},this),0)):c()},focus:function(a,b,c){this.focusModel.focus(a,b,c)},focusIn:function(a,b,c){var d;this.focus(a,b,c),a=this.dataModel.getMainRowKey(a,b),this.isEditable(a,b)?(d=this.cellFactory.getInstance(this.columnModel.getEditType(b)),d.focusIn(this.getElement(a,b))):this.focusClipboard()},focusAt:function(a,b,c){var d=this.dataModel.at(a),e=this.columnModel.at(b,!0);d&&e&&this.focus(d.get("rowKey"),e.columnName,c)},focusInAt:function(a,b,c){var d=this.dataModel.at(a),e=this.columnModel.at(b,!0);d&&e&&this.focusIn(d.get("rowKey"),e.columnName,c)},blur:function(){this.focusModel.blur()},checkAll:function(){this.setColumnValues("_button",!0)},check:function(a){this.setValue(a,"_button",!0)},uncheckAll:function(){this.setColumnValues("_button",!1)},uncheck:function(a){this.setValue(a,"_button",!1)},clear:function(){this.setRowList([])},removeRow:function(a,b){this.dataModel.removeRow(a,b)},removeCheckedRows:function(a){var b=this.getCheckedRowKeyList(),c=b.length+"건의 데이터를 삭제하시겠습니까?";return b.length>0&&(!a||confirm(c))?(_.each(b,function(a){this.removeRow(a)},this),!0):!1},enableRow:function(a){this.dataModel.get(a).setRowState("")},disableRow:function(a){this.dataModel.get(a).setRowState("DISABLED")},enableCheck:function(a){this.dataModel.get(a).setRowState("")},disableCheck:function(a){this.dataModel.get(a).setRowState("DISABLED_CHECK")},getCheckedRowKeyList:function(a){var b=[];return _.each(this.dataModel.where({_button:!0}),function(a){b.push(a.get("rowKey"))},this),a?$.toJSON(b):b},getCheckedRowList:function(a){var b=this.dataModel.getRowList(!0);return a?$.toJSON(b):b},getColumnModelList:function(){return this.columnModel.get("columnModelList")},getModifiedRowList:function(a){return this.dataModel.getModifiedRowList(a)},appendRow:function(a,b){this.dataModel.append(a,b)},prependRow:function(a){this.dataModel.prepend(a)},setColumnFixIndex:function(a){this.option({columnFixIndex:a}),this.columnModel.set({columnFixIndex:a})},isChanged:function(){var a=this.getModifiedRowList(),b=!1;return ne.util.forEach(a,function(a){return a.length?(b=!0,!1):void 0}),b},restore:function(){var a=this.dataModel.getOriginalRowList();this.replaceRowList(a,!1)},hideGridLayer:function(){_.each(this.view.layer,function(a){a.hide()},this)},showGridLayer:function(a){this.hideGridLayer(),this.view.layer[a]?this.view.layer[a].show():null},getPaginationInstance:function(){var a=this.view.toolbar.pagination;return a?a.instance:void 0},use:function(a,b){return b=$.extend({grid:this},b),e[a]&&(this.addOn[a]=new e[a](b)),this},isSorted:function(){return this.dataModel.isSortedByField()},isEditable:function(a,b){var c,d,e=this.focusModel.which(),f=this.dataModel;return a=void 0!==a?a:e.rowKey,b=void 0!==b?b:e.columnName,c=f.get(a),d=c?c.isEditable(b):!0},isDisabled:function(a,b){var c,d,e=this.focusModel.which(),f=this.dataModel;return a=void 0!==a?a:e.rowKey,b=void 0!==b?b:e.columnName,c=f.get(a),d=c?c.isDisabled(b):!1},getCellState:function(a,b){var c=this.focusModel.which(),d=this.dataModel;return a=void 0!==a?a:c.rowKey,b=void 0!==b?b:c.columnName,d.get(a).getCellState(b)},setColumnModelList:function(a){this.columnModel.set("columnModelList",a)},sort:function(a,b){this.dataModel.sortByField(a,b)},getRowList:function(){return this.dataModel.getRowList()},del:function(a,b,c){a=this.dataModel.getMainRowKey(a,b);var d=this.columnModel.getEditType(b),e=this.dataModel.get(a).getRowState().isDisabledCheck,f=["text","text-convertible","text-password"],g=-1!==$.inArray(d,f),h=this.option("selectType"),i=this.getCellState(a,b),j=!(!g||!i.isEditable||i.isDisabled);j&&(this.setValue(a,b,"",c),c&&"checkbox"===h&&!e&&this.setValue(a,"_button",!0,c))},paste:function(a){var b,c,d,e=this.columnModel.getVisibleColumnModelList(),f=this._getStartIndexToPaste(),g=this._getEndIndexToPaste(f,a,e);for(b=f.rowIdx;b<=g.rowIdx;b+=1)for(c=f.columnIdx;c<=g.columnIdx;c+=1)d=a[b-f.rowIdx][c-f.columnIdx],this._setValueForPaste(b,c,e[c],d);this.selection.startSelection(f.rowIdx,f.columnIdx),this.selection.updateSelection(g.rowIdx,g.columnIdx)},_getStartIndexToPaste:function(){var a;return a=this.selection.hasSelection()?this.selection.getStartIndex():this.focusModel.indexOf()},_getEndIndexToPaste:function(a,b,c){var d={rowIdx:Math.min(b.length+a.rowIdx,this.dataModel.length)-1,columnIdx:Math.min(b[0].length+a.columnIdx,c.length)-1};return d},_setValueForPaste:function(a,b,c,d){var e=this.dataModel.at(a),f=c.columnName,g=e.getCellState(f),h=e.getRowSpanData(f),i={};g.isEditable&&!g.isDisabled&&(!h||h.count>=0)&&(i[f]=d,e.set(i))},addCellClassName:function(a,b,c){this.dataModel.get(a).addCellClassName(b,c)},addRowClassName:function(a,b){this.dataModel.get(a).addRowClassName(b)},removeCellClassName:function(a,b,c){this.dataModel.get(a).removeCellClassName(b,c)},removeRowClassName:function(a,b){this.dataModel.get(a).removeRowClassName(b)},getRowSpanData:function(a,b){var c=this.dataModel.get(a);return c?c.getRowSpanData(b):void 0},getIndexOfRow:function(a){return this.dataModel.indexOfRowKey(a)},setDisplayRowCount:function(a){this.dimensionModel.set("displayRowCount",a)},filterData:function(a,b){},enable:function(){},disable:function(a){},refreshLayout:function(){this.dimensionModel.set("width",this.$el.width())},setGridSize:function(a){},setScrollHandlerPosition:function(){},destroy:function(){this.stopListening(),this.destroyChildren(),_.each(this,function(b,c){"publicInstance"!==c&&(b instanceof a.Base&&b&&ne.util.isFunction(b.destroy)&&b.destroy(),"view"===c&&_.each(b,function(a,b){a&&ne.util.isFunction(a.destroy)&&a.destroy()},this)),b&&ne.util.isFunction(b._destroy)&&b._destroy(),b&&ne.util.isFunction(b.stopListening)&&b.stopListening(),"$el"!==c&&"__$el"!==c&&(this[c]=null)},this),this.$el.replaceWith(this.__$el),this.$el=this.__$el=null}});h.prototype.__instance=h.prototype.__instance||{},ne=window.ne=ne||{},ne.Grid=a.Base.extend({initialize:function(a){a.publicInstance=this,this.core=new h(a),this.listenTo(this.core,"all",this._relayEvent,this)},_relayEvent:function(){this.trigger.apply(this,arguments)},disableRow:function(a){this.core.disableRow(a)},enableRow:function(a){this.core.enableRow(a)},getValue:function(a,b,c){return this.core.getValue(a,b,c)},getColumnValues:function(a,b){return this.core.getColumnValues(a,b)},getRow:function(a,b){return this.core.getRow(a,b)},getRowAt:function(a,b){return this.core.getRowAt(a,b)},getRowCount:function(){return this.core.getRowCount()},getSelectedRowKey:function(){return this.core.focusModel.which().rowKey},getElement:function(a,b){return this.core.getElement(a,b)},setValue:function(a,b,c){this.core.setValue(a,b,c)},setColumnValues:function(a,b,c){this.core.setColumnValues(a,b,c)},replaceRowList:function(a){this.core.replaceRowList(a)},setRowList:function(a){this.core.setRowList(a)},focus:function(a,b,c){this.core.focusClipboard(),this.core.focus(a,b,c)},focusAt:function(a,b,c){this.core.focusAt(a,b,c)},focusIn:function(a,b,c){this.core.focusIn(a,b,c)},focusInAt:function(a,b,c){this.core.focusInAt(a,b,c)},readyForKeyControl:function(){this.core.readyForKeyControl()},blur:function(){this.core.blur()},checkAll:function(){this.core.checkAll()},check:function(a){this.core.check(a)},uncheckAll:function(){this.core.uncheckAll()},uncheck:function(a){this.core.uncheck(a)},clear:function(){this.core.clear()},removeRow:function(a,b){ne.util.isBoolean(b)&&b&&(b={removeOriginalData:!0}),this.core.removeRow(a,b)},removeCheckedRows:function(a){return this.core.removeCheckedRows(a)},enableCheck:function(a){this.core.enableCheck(a)},disableCheck:function(a){this.core.disableCheck(a)},getCheckedRowKeyList:function(a){var b=this.core.getCheckedRowKeyList();return a?$.toJSON(b):b},getCheckedRowList:function(a){var b=this.core.getCheckedRowList();return a?$.toJSON(b):b},getColumnModelList:function(){return this.core.getColumnModelList()},getModifiedRowList:function(a){return this.core.getModifiedRowList(a)},appendRow:function(a,b){this.core.appendRow(a,b)},prependRow:function(a){this.core.prependRow(a)},isChanged:function(){return this.core.isChanged()},getAddOn:function(a){return a?this.core.addOn[a]:this.core.addOn},restore:function(){this.core.restore()},select:function(a){this.core.select(a)},unselect:function(){this.core.unselect()},setColumnFixIndex:function(a){this.core.setColumnFixIndex(a)},setColumnModelList:function(a){this.core.setColumnModelList(a)},use:function(a,b){return this.core.use(a,b),this},getRowList:function(){return this.core.getRowList()},sort:function(a){this.core.sort(a)},unSort:function(){this.core.sort("rowKey")},addCellClassName:function(a,b,c){this.core.addCellClassName(a,b,c)},addRowClassName:function(a,b){this.core.addRowClassName(a,b)},removeCellClassName:function(a,b,c){this.core.removeCellClassName(a,c)},removeRowClassName:function(a,b){this.core.removeRowClassName(a,b)},getRowSpanData:function(a,b){this.core.getRowSpanData(a,b)},getIndexOfRow:function(a){return this.core.getIndexOfRow(a)},setDisplayRowCount:function(a){this.core.setDisplayRowCount(a)},refreshLayout:function(){this.core.refreshLayout()},destroy:function(){this.core.destroy(),this.core=null}}),ne.Grid.getInstanceById=function(a){return h.prototype.__instance[a]}}();
//# sourceMappingURL=grid.min.map