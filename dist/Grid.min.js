!function(){"undefined"!=typeof window.console&&window.console&&window.console.log||(window.console={log:function(){},error:function(){}});var a={CellFactory:null,Layout:{},Renderer:{Row:null,Cell:{}},Extra:{}},b={},c={},d={};b.Base=Backbone.Model.extend({initialize:function(a){var b=a&&a.grid||this.collection&&this.collection.grid||null;this.setOwnProperties({grid:b})},setOwnProperties:function(a){_.each(a,function(a,b){this[b]=a},this)}}),d.Base=Backbone.Collection.extend({initialize:function(a){var b=a&&a.grid||this.collection&&this.collection.grid||null;this.setOwnProperties({grid:b})},clear:function(){return this.each(function(a){a.stopListening(),a=null}),this},setOwnProperties:function(a){_.each(a,function(a,b){this[b]=a},this)}}),a.Base=Backbone.View.extend({initialize:function(a){var b=a&&a.grid||this.collection&&this.collection.grid||null;this.setOwnProperties({grid:b,__viewList:[]})},error:function(a){var b=function(){this.name="PugException",this.message=a||"error"};return b.prototype=new Error,new b},setOwnProperties:function(a){_.each(a,function(a,b){this[b]=a},this)},createView:function(a,b){var c=new a(b);return this.hasOwnProperty("__viewList")||this.setOwnProperties({__viewList:[]}),this.__viewList.push(c),c},addView:function(a){return this.hasOwnProperty("__viewList")||this.setOwnProperties({__viewList:[]}),this.__viewList.push(a),a},destroy:function(){this.destroyChildren(),this.remove()},destroyChildren:function(){if(this.__viewList instanceof Array)for(;0!==this.__viewList.length;)this.__viewList.pop().destroy()}}),a.Base.Renderer=a.Base.extend({eventHandler:{},initialize:function(){a.Base.prototype.initialize.apply(this,arguments),this._initializeEventHandler()},_initializeEventHandler:function(){var a={};_.each(this.eventHandler,function(b,c){var d=c.split(" "),e=d[0],f=d[1]||"";a[e]={selector:f,handler:$.proxy(this[b],this)}},this),this.setOwnProperties({_eventHandler:a})},_attachHandler:function(a){_.each(this._eventHandler,function(b,c){var d=b.handler,e=b.selector,f=a;e&&(f=a.find(e)),f.length>0&&f.on(c,d)},this)},_detachHandler:function(a){_.each(this._eventHandler,function(b,c){var d=b.handler,e=b.selector,f=a;e&&(f=a.find(e)),f.length>0&&f.off(c,d)},this)},getHtml:function(){throw this.error("implement getHtml() method")}}),a.Base.Renderer.Cell=a.Base.Renderer.extend({cellType:"normal",eventHandler:{},rerenderAttributes:["isEditable","optionList","value"],initialize:function(){a.Base.Renderer.prototype.initialize.apply(this,arguments),this._initializeEventHandler()},baseTemplate:_.template('<td  columnName="<%=columnName%>" <%=rowSpan%> class="<%=className%>" <%=attributes%> data-cell-type="<%=cellType%>"><%=content%></td>'),onModelChange:function(a,b){{var c,d=this._getCellElement(a.columnName,b),e=!1;-1!==$.inArray("value",a.changed)}this._setFocusedClass(a,d);for(var f=0;f<this.rerenderAttributes.length;f++)if(-1!==$.inArray(this.rerenderAttributes[f],a.changed)){e=!0;break}d.attr("class",this._getClassNameList(a).join(" ")),c=!!d.find(":focus").length,e===!0?(this.render(a,d,c),c&&this.focusIn(d)):this.setElementAttribute(a,d,c)},attachHandler:function(a){this._attachHandler(a)},detachHandler:function(a){this._detachHandler(a)},_setFocusedClass:function(a,b){a.selected===!0?b.addClass("selected"):b.removeClass("selected"),a.focused===!0?b.addClass("focused"):b.removeClass("focused")},setElementAttribute:function(){},render:function(a,b,c){this._detachHandler(b),b.data("cell-type",this.cellType).html(this.getContentHtml(a,b,c)),this._attachHandler(b)},_getClassNameList:function(a){var b,c,d=[],e={},f=a.columnName,g=["_button","_number"],h=-1!==$.inArray(f,g);for(a.className&&d.push(a.className),a.selected===!0&&d.push("selected"),a.focused===!0&&d.push("focused"),a.isEditable!==!0||h||d.push("editable"),a.isDisabled!==!0||h||d.push("disabled"),c=d.length,b=0;c>b;b++)e[d[b]]=!0;return d=[],_.each(e,function(a,b){d.push(b)},this),d},getHtml:function(a){return this.baseTemplate({columnName:a.columnName,rowSpan:a.rowSpan?'rowSpan="'+a.rowSpan+'"':"",className:this._getClassNameList(a).join(" "),attributes:this.getAttributes(a),cellType:this.cellType,content:this.getContentHtml(a)})},getAttributesString:function(a){var b="";return _.each(a,function(a,c){b+=" "+c+'="'+a+'"'},this),b},getEventHandler:function(){return this._eventHandler},getContentHtml:function(a){return a.value},getAttributes:function(){return""},_getColumnName:function(a){return a.closest("td").attr("columnName")},_getRowKey:function(a){return a.closest("tr").attr("key")},_getCellElement:function(a,b){return b.find('td[columnName="'+a+'"]')},_getCellData:function(a){return this.grid.renderModel.getCellData(this._getRowKey(a),this._getColumnName(a))},_getCellAddress:function(a){return{rowKey:this._getRowKey(a),columnName:this._getColumnName(a)}}}),a.Base.PluginInterface=a.Base.extend({$super:a.Base.PluginInterface,initialize:function(){a.Base.prototype.initialize.apply(this,arguments),this.$super.__plugin=this},activate:function(){},render:function(){return this},appendTo:function(){}});var e={getTBodyHeight:function(a,b){return 0===a?a:a*(b+1)+1},getDisplayRowCount:function(a,b){return Math.ceil((a-1)/(b+1))},getRowHeight:function(a,b){return Math.floor((b-1)/a)},setCursorToEnd:function(a){a.focus();var b=a.value.length;if(a.setSelectionRange)a.setSelectionRange(b,b);else if(a.createTextRange){var c=a.createTextRange();c.collapse(!0),c.moveEnd("character",b),c.moveStart("character",b),c.select()}},isEqual:function(a,b){var c,d,e;if(typeof a!=typeof b)return!1;if(a instanceof Array){if(d=a.length,d!==b.length)return!1;for(c=0;d>c;c++)if(a[c]!==b[c])return!1}else if("object"==typeof a){for(e in a)if(a[e]!==b[e])return!1}else if(a!==b)return!1;return!0},hasTagString:function(a){return/[<>&"']/.test(a)},stripTags:function(a){if(a=a.replace(/[\n\r\t]/g,""),this.hasTagString(a)){if(/<img/.test(a)){var b=a.match(/<img[^>]*\ssrc=[\"']?([^>\"']+)[\"']?[^>]*>/);a=b?b[1]:""}else a=a.replace(/<button.*?<\/button>/g,"");a=this.decodeHTMLEntity(a.replace(/<\/?(?:h[1-5]|[a-z]+(?:\:[a-z]+)?)[^>]*>/gi,""))}return a},getUniqueKey:function(){var a=String(parseInt(1e10*Math.random(),10));return(new Date).getTime()+a},decodeHTMLEntity:function(a){var b={"&quot;":'"',"&amp;":"&","&lt;":"<","&gt;":">","&#39;":"'","&nbsp;":" "};return a.replace(/&amp;|&lt;|&gt;|&quot;|&#39;|&nbsp;/g,function(a){return b[a]?b[a]:a})},encodeHTMLEntity:function(a){var b={'"':"quot","&":"amp","<":"lt",">":"gt","'":"#39"};return a.replace(/[<>&"']/g,function(a){return b[a]?"&"+b[a]+";":a})}};c.ColumnModel=b.Base.extend({defaults:{keyColumnName:null,columnFixIndex:0,columnModelList:[],visibleList:[],columnModelMap:{},relationListMap:{}},initialize:function(){b.Base.prototype.initialize.apply(this,arguments),this.on("change",this._onChange,this)},_appendDefaultColumn:function(a){var b=$.extend(!0,[],a),c=[],d=this.grid.option("selectType"),e=!1,f=!1,g={_number:{columnName:"_number",title:"No.",width:60},_button:{columnName:"_button",editOption:{type:d,list:[{value:"selected"}]},width:50}};return"checkbox"===d?g._button.title='<input type="checkbox"/>':"radio"===d?g._button.title="선택":g._button.isHidden=!0,_.each(b,function(a,c){var d=a.columnName;"_number"===d?(b[c]=$.extend(a,g._number),e=!0):"_button"===d&&(b[c]=$.extend(a,g._button),f=!0)},this),e||c.push(g._number),f||c.push(g._button),b=_.union(c,b)},indexOfColumnName:function(a,b){b=void 0===b;for(var c=b?this.getVisibleColumnModelList():this.get("columnModelList"),d=0,e=c.length;e>d;d++)if(c[d].columnName===a)return d;return-1},at:function(a,b){var c=b?this.getVisibleColumnModelList():this.get("columnModelList");return c[a]},isLside:function(a){return this.get("columnFixIndex")>this.indexOfColumnName(a)},getVisibleColumnModelList:function(a){a=a?a.toUpperCase():void 0;var b=[],c=this.get("columnFixIndex");switch(a){case"L":b=this.get("visibleList").slice(0,c);break;case"R":b=this.get("visibleList").slice(c);break;default:b=this.get("visibleList")}return b},getColumnModel:function(a){return this.get("columnModelMap")[a]},getEditType:function(a){var b=this.getColumnModel(a);return"_button"===a?"main":b&&b.editOption&&b.editOption.type},_getVisibleList:function(){return _.filter(this.get("columnModelList"),function(a){return!a.isHidden})},_getRelationMart:function(){var a,b,c,d=this.get("columnModelList"),e={},f=d.length;for(c=0;f>c;c++)a=d[c].columnName,d[c].relationList&&(b=d[c].relationList,e[a]=b);return e},_onChange:function(a){a.changed.columnModelList&&this.set({columnModelList:this._appendDefaultColumn(a.changed.columnModelList)},{silent:!0});var b=this._getVisibleList();this.set({visibleList:b,lsideList:b.slice(0,this.get("columnFixIndex")),rsideList:b.slice(this.get("columnFixIndex")),columnModelMap:_.indexBy(this.get("columnModelList"),"columnName"),relationListMap:this._getRelationMart()},{silent:!0})}}),c.Row=b.Base.extend({idAttribute:"rowKey",defaults:{_extraData:{rowState:null,selected:!1,focused:""}},initialize:function(){b.Base.prototype.initialize.apply(this,arguments)},getRowState:function(){var a=this.get("_extraData"),b=a&&a.rowState,c=!1,d=!1,e=!1,f=[];if(b)switch(b){case"DISABLED":d=!0;break;case"DISABLED_CHECK":c=!0;break;case"CHECKED":e=!0}return c=d?d:c,d&&f.push("disabled"),{isDisabled:d,isDisabledCheck:c,isChecked:e,classNameList:f}},getRowSpanData:function(a){var b,c=this.get("_extraData");return a?(c=this.get("_extraData"),b={count:0,isMainRow:!0,mainRowKey:this.get("rowKey")},c&&c.rowSpanData&&c.rowSpanData[a]||b):c.rowSpanData},getTagFiltered:function(a){var b=this.grid.columnModel.getColumnModel(a),c=this.grid.columnModel.getEditType(a),d=this.get(a),f=b.notUseHtmlEntity;return f||c&&"text"!==c||!e.hasTagString(d)||(d=e.encodeHTMLEntity(d)),d},_convertValueType:function(a,b){return"string"===b?a.toString():"number"===b?parseInt(a,10):a},_getListTypeVisibleText:function(a,b){var c,d,e=b.columnName,f=this.getRelationResult(["optionListChange"])[e],g=f&&f.optionList?f.optionList:b.editOption.list;return c=typeof g[0].value,d=a.toString().split(","),c!==typeof d[0]&&_.each(d,function(a,b){d[b]=this._convertValueType(a,c)},this),_.each(d,function(a,b){d[b]=_.findWhere(g,{value:a}).text},this),d.join(",")},getRelationResult:function(a){a=a||["optionListChange","isDisable","isEditable"];var b,c,d,e,f=(this.get("rowKey"),this.toJSON()),g=this.grid.columnModel.get("relationListMap"),h={};return _.each(g,function(g,i){e=f[i],_.each(g,function(g){d=g.columnList,_.each(a,function(a){if(b=g[a],"function"==typeof b){switch(c="",a){case"optionListChange":c="optionList";break;case"isDisable":c="isDisabled";break;case"isEditable":c="isEditable"}c&&_.each(d,function(a){h[a]=h[a]||{},h[a][c]=b(e,f)},this)}},this)},this)},this),h},getVisibleText:function(a){var b,c,d=this.grid.columnModel,f=this.get(a),g={select:!0,radio:!0,checkbox:!0};if(d)if(b=d.getEditType(a),c=d.getColumnModel(a),g[b]){if(!(c.editOption&&c.editOption.list&&c.editOption.list[0].value))throw this.error('Check "'+a+"\"'s editOption.list property out in your ColumnModel.");f=this._getListTypeVisibleText(f,c)}else"function"==typeof c.formatter&&(f=e.stripTags(c.formatter(this.getTagFiltered(a),this.toJSON(),c)));return f}}),c.RowList=d.Base.extend({model:c.Row,initialize:function(a){d.Base.prototype.initialize.apply(this,arguments),this.setOwnProperties({_sortKey:"rowKey",_originalRowList:[],_startIndex:a.startIndex||1,_privateProperties:["_button","_number","_extraData"]}),this.listenTo(this.grid.focusModel,"change",this._onFocusChange,this),this.on("change",this._onChange,this),this.on("change:_button",this._onCheckChange,this),this.on("sort",this._onSort,this),this.on("all",this.test1,this)},test1:function(){},indexOfRowKey:function(a){return this.indexOf(this.get(a))},_onSort:function(){console.log("sort"),this._refreshNumber()},_refreshNumber:function(){for(var a=0;a<this.length;a++)this.at(a).set("_number",this._startIndex+a,{silent:!0})},_isPrivateProperty:function(a){return-1!==$.inArray(a,this._privateProperties)},_onChange:function(a){var b=function(a,b){return{rowKey:a.get("rowKey"),columnName:b,columnData:a.get(b)}};_.each(a.changed,function(c,d){if(!this._isPrivateProperty(d)){var e=this.grid.columnModel.getColumnModel(d);if(!e)return;var f,g=a.getRowSpanData(d),h=b(a,d);if(e.editOption&&e.editOption.changeBeforeCallback&&e.editOption.changeBeforeCallback(h)===!1)return f={},f[d]=a.previous(d),a.set(f),void a.trigger("restore",{changed:f});if(!this.isSortedByField())if(g.isMainRow)for(var i=this.indexOfRowKey(a.get("rowKey")),j=0;j<g.count-1;j++)this.at(j+1+i).set(d,c);else this.get(g.mainRowKey).set(d,c);h=b(a,d),e.editOption&&e.editOption.changeAfterCallback&&e.editOption.changeAfterCallback(h),a.getRowState().isDisabledCheck||a.set("_button",!0)}},this)},_onCheckChange:function(a){var b,c=(this.grid.columnModel.getColumnModel("_button"),this.grid.option("selectType")),d=a.get("rowKey");"radio"===c&&(b=this.where({_button:!0}),_.each(b,function(a){d!=a.get("rowKey")&&a.set({_button:!1},{silent:!0})}))},isSortedByField:function(){return"rowKey"!==this._sortKey},sortByField:function(a){this._sortKey=a,this.sort()},comparator:function(a){return this.isSortedByField()?1*a.get(this._sortKey):void 0},setValue:function(a,b,c,d){var e=this.get(a),f={};return e?(f[b]=c,e.set(f,{silent:d}),!0):!1},setColumnValue:function(a,b,c){var d={};d[a]=b,this.forEach(function(a){a.set(d,{silent:c})},this)},setExtraData:function(a,b,c){var d,e=this.get(a),f={};return e?(d=_.clone(e.get("_extraData")),d=$.extend(d,b),f._extraData=d,e.set(f,{silent:c}),!0):!1},_onFocusChange:function(a){console.log("onFocusChange",a.changed);var b=!0,c=a.get("rowKey");_.each(a.changed,function(d,e){"rowKey"===e?(null===d&&(d=a.previous("rowKey"),b=!1),this.setExtraData(d,{selected:b})):"columnName"===e&&this.setExtraData(c,{focused:d})},this)},parse:function(a){return this._originalRowList=this._parse(a),this._originalRowList},_filterRowList:function(a){for(var b,c=[],d=0,e=a.length;e>d;d++)b={},_.each(a[d],function(a,c){this._isPrivateProperty(c)||(b[c]=a)},this),c.push(b);return c},getModifiedRowList:function(){var a=_.indexBy(this._filterRowList(this._originalRowList),"rowKey"),b=_.indexBy(this._filterRowList(this.toJSON()),"rowKey"),c={inserted:[],edited:[],deleted:[]};return _.each(b,function(b,d){a[d]?JSON.stringify(b)!==JSON.stringify(a[d])&&c.edited.push(b):c.inserted.push(b)},this),_.each(a,function(a,d){b[d]||c.deleted.push(a)},this),c},_parse:function(a){function b(a,b,c){a.rowSpanData=a&&a.rowSpanData||{},a.rowSpanData[b]=c}function c(a,b){return!(!a.rowSpanData||!a.rowSpanData[b])}for(var d,e,f,g=a,h=this.grid.columnModel.get("keyColumnName"),i=0;i<g.length;i++)if(e=null===h?i:g[i][h],g[i]._extraData=g[i]._extraData||{},f=g[i]._extraData&&g[i]._extraData.rowState,g[i].rowKey=e,g[i]._button="CHECKED"===f,this.isSortedByField())g[i]._extraData&&(g[i]._extraData.rowSpan=null);else if(g[i]._extraData&&g[i]._extraData.rowSpan)for(var j in g[i]._extraData.rowSpan)if(!c(g[i]._extraData,j)){d=g[i]._extraData.rowSpan[j],b(g[i]._extraData,j,{count:d,isMainRow:!0,mainRowKey:g[i].rowKey});for(var k=-1,l=i+1;i+d>l;l++)g[l][j]=g[i][j],g[l]._extraData=g[l]._extraData||{},b(g[l]._extraData,j,{count:k--,isMainRow:!1,mainRowKey:g[i].rowKey})}return g},_getEmptyRow:function(){for(var a=this.grid.columnModel.get("columnModelList"),b={},c=0;c<a.length;c++)b[a[c].columnName]="";return b},append:function(a,b){b=void 0!==b?b:this.length;var d,e=[],f=this.grid.columnModel.get("key"),g=this.length,a=a||this._getEmptyRow();a instanceof Array||(a=[a]),d=this._parse(a),_.each(d,function(a,b){a.rowKey=f?a[f]:g+b,e.push(new c.Row(a))},this),this.add(e,{at:b,merge:!0}),this._refreshNumber()},prepend:function(a){this.append(a,0)}}),b.Renderer=b.Base.extend({defaults:{top:0,scrollTop:0,scrollLeft:0,maxScrollLeft:0,startIdx:0,endIdx:0,lside:null,rside:null},initialize:function(){b.Base.prototype.initialize.apply(this,arguments),this.setOwnProperties({timeoutIdForRefresh:0,isColumnModelChanged:!1}),this.listenTo(this.grid.columnModel,"all",this._onColumnModelChange,this),this.listenTo(this.grid.dataModel,"add remove sort reset",this._onRowListChange,this),this.on("change",this.test,this);var a=new b.RowList({grid:this.grid}),c=new b.RowList({grid:this.grid});this.set({lside:a,rside:c})},test:function(a){console.log("change",a.changed)},getCollection:function(a){a=a?a.toUpperCase():void 0;var b;switch(a){case"L":b=this.get("lside");break;case"R":b=this.get("rside");break;default:b=this.get("rside")}return b},_onColumnModelChange:function(){this.set({scrollTop:0,top:0,startIdx:0,endIdx:0}),this.isColumnModelChanged=!0,clearTimeout(this.timeoutIdForRefresh),this.timeoutIdForRefresh=setTimeout($.proxy(this.refresh,this),0)},_onRowListChange:function(){clearTimeout(this.timeoutIdForRefresh),this.timeoutIdForRefresh=setTimeout($.proxy(this.refresh,this),0)},_setRenderingRange:function(){this.set({startIdx:0,endIdx:this.grid.dataModel.length-1})},refresh:function(){this.trigger("beforeRefresh"),this._setRenderingRange();{var a,b,c=this.grid.columnModel.get("columnFixIndex"),d=this.grid.columnModel.get("visibleList"),e=_.pluck(d,"columnName"),f=e.slice(0,c),g=e.slice(c),h=[],i=[],j=[],k=[],l=this.get("startIdx"),m=this.get("endIdx");new Date}for(b=l;m+1>b;b++){var n=this.grid.dataModel.at(b),o=n.get("rowKey");j={_extraData:n.get("_extraData"),rowKey:o},k={_extraData:n.get("_extraData"),rowKey:o},_.each(f,function(a){j[a]=n.get(a)},this),_.each(g,function(a){k[a]=n.get(a)},this),h.push(j),i.push(k)}for(this.get("lside").clear().reset(h,{parse:!0}),this.get("rside").clear().reset(i,{parse:!0}),b=l,a=i.length+l;a>b;b++)this.executeRelation(b);new Date;this.isColumnModelChanged===!0?(this.trigger("columnModelChanged"),this.isColumnModelChanged=!1):this.trigger("rowListChanged"),this.trigger("afterRefresh")},_getRowListDivision:function(a){var b=this.get("lside"),c=this.get("rside");return b.at(0)&&b.at(0).get(a)?b:c},getCellData:function(a,b){var c=this._getRowListDivision(b),d=c.get(a);return d?d.get(b):void 0},executeRelation:function(a){var b,c=this.grid.dataModel.at(a).getRelationResult(),d=a-this.get("startIdx");_.each(c,function(a,c){b=this._getRowListDivision(c).at(d),b&&this._getRowListDivision(c).at(d).setCell(c,a)},this)}}),b.Cell=b.Base.extend({defaults:{rowKey:"",columnName:"",value:"",rowSpan:0,isMainRow:!0,mainRowKey:"",isEditable:!1,optionList:[],isDisabled:!1,className:"",selected:!1,focused:!1},initialize:function(a){b.Base.prototype.initialize.apply(this,arguments),this.setOwnProperties({_model:a._model||null,attrProperties:["isDisabled","className","selected","focused"]});var c=a.columnName;this.listenTo(this._model,"change:"+c,this._onModelChange,this),this.on("change",this._onChange,this)},_onModelChange:function(a,b){var c=this.grid.columnModel.getColumnModel(this.get("columnName"));c.affectOption,this.set("value",b)},_onChange:function(a){var b=!1;_.each(a.changed,function(a,c){-1===$.inArray(c,this.attrProperties)&&(b=!0)},this),b===!0?this.trigger("render",a):this.trigger("changeAttr",a)},setValue:function(a){this._model.set(this.get("columnName"),a)}}),b.Dimension=b.Base.extend({models:null,columnModel:null,defaults:{offsetLeft:0,offsetTop:0,width:0,headerHeight:0,bodyHeight:0,toolbarHeight:0,rowHeight:0,rsideWidth:0,lsideWidth:0,columnWidthList:[],maxScrollLeft:0},initialize:function(){b.Base.prototype.initialize.apply(this,arguments),this.columnModel=this.grid.columnModel,this.listenTo(this.columnModel,"change",this._onWidthChange),this.on("change:width",this._onWidthChange,this),this._setColumnWidth(),this._setBodyHeight()},getCellPosition:function(a,b){var c,d,f,g,h,i=0,j=0,k=this.grid.dataModel,l=(this.get("offsetLeft"),this.get("offsetTop"),this.get("rowHeight")),m=k.get(a).getRowSpanData(b),n=this.get("columnWidthList"),o=this.grid.columnModel.get("columnFixIndex"),p=this.grid.columnModel.indexOfColumnName(b);for(m.isMainRow||(a=m.mainRowKey,m=k.get(a).getRowSpanData(b)),h=m.count||1,g=k.indexOfRowKey(a),c=e.getTBodyHeight(g,l),f=c+e.getTBodyHeight(h,l)-1,p>=o&&(j=o);p>j;j++)i+=n[j]+1;return d=n[j]+1,{top:c,left:i,right:d,bottom:f}},getDisplayRowCount:function(){return e.getDisplayRowCount(this.get("bodyHeight")-this.get("toolbarHeight"),this.get("rowHeight"))},_onWidthChange:function(){var a=this.get("columnWidthList");this._setColumnWidth(this._calculateColumnWidthList(a))},getScrollXSize:function(){return!!this.grid.option("scrollX")*this.grid.scrollBarSize},_setBodyHeight:function(){var a=e.getTBodyHeight(this.grid.option("displayRowCount"),this.get("rowHeight"));a+=this.grid.scrollBarSize,this.set("bodyHeight",a)},_setColumnWidth:function(a){var b,c=0,d=this.get("width"),e=this.columnModel.get("columnFixIndex");a=a||this._getOriginalWidthList();for(var f=0,g=a.length;g>f;f++)e>f&&(c+=a[f]+1);c+=1,b=d-c,this.set({rsideWidth:b,lsideWidth:c,columnWidthList:a}),this.trigger("columnWidthChanged")},getTotalWidth:function(a){var b,c=this.getColumnWidthList(a),d=c.length,e=0;for(b=0;d>b;b++)e+=c[b]+1;return e},setColumnWidth:function(a,b){b=Math.max(b,this.grid.option("minimumColumnWidth"));var c,d=this.get("columnWidthList");d[a]=b,c=this._calculateColumnWidthList(d),this._setColumnWidth(c)},getColumnWidthList:function(a){a=a?a.toUpperCase():void 0;var b=this.columnModel.get("columnFixIndex"),c=[];switch(a){case"L":c=this.get("columnWidthList").slice(0,b);break;case"R":c=this.get("columnWidthList").slice(b);break;default:c=this.get("columnWidthList")}return c},_getOriginalWidthList:function(){for(var a=this.columnModel.get("visibleList"),b=[],c=0,d=a.length;d>c;c++)b.push(a[c].width?a[c].width:-1);return this._calculateColumnWidthList(b)},_calculateColumnWidthList:function(a){for(var b,c,d=[],e=this.get("width"),f=0,g=0,h=0,i=0,j=a.length;j>i;i++)a[i]>0?(f=Math.max(this.grid.option("minimumColumnWidth"),a[i]),d.push(f),g+=f):(d.push(-1),h++);b=e-g,e>g&&0===h&&(d[d.length-1]+=b),e>g?(b=e-g,c=Math.max(this.grid.option("minimumColumnWidth"),Math.floor(b/h))):c=this.grid.option("minimumColumnWidth");for(var i=0,j=d.length;j>i;i++)-1===d[i]&&(d[i]=c);return d}}),b.Focus=b.Base.extend({defaults:{rowKey:null,columnName:"",prevRowKey:null,prevColumnName:""},initialize:function(){b.Base.prototype.initialize.apply(this,arguments)},_savePrevious:function(){null!==this.get("rowKey")&&this.set("prevRowKey",this.get("rowKey")),this.get("columnName")&&this.set("prevColumnName",this.get("columnName"))},_clearPrevious:function(){this.set({prevRowKey:null,prevColumnName:""})},select:function(a){return this.unselect().set("rowKey",a),this},unselect:function(){return this.set({rowKey:null}),this},focus:function(a,b,c){return console.log("#####focus",a,b),a=void 0===a?this.get("rowKey"):a,b=void 0===b?this.get("columnName"):b,this._savePrevious(),a!==this.get("rowKey")&&this.blur().select(a),b&&b!==this.get("columnName")&&this.set("columnName",b),c&&this._adjustScroll(),this},_adjustScroll:function(){var a=this.which(),b=this.grid.dimensionModel,c=this.grid.renderModel,d=c.get("scrollTop"),e=(c.get("scrollLeft"),b.get("bodyHeight")),f=b.getCellPosition(a.rowKey,a.columnName);f.top<d?c.set({scrollTop:f.top}):f.bottom>e+d-this.grid.option("scrollX")*this.grid.scrollBarSize&&c.set({scrollTop:f.bottom-e+this.grid.option("scrollX")*this.grid.scrollBarSize}),!this.grid.columnModel.isLside(a.columnName)},blur:function(){return null!==this.get("rowKey")&&this.set("columnName",""),this},which:function(){return{rowKey:this.get("rowKey"),columnName:this.get("columnName")}},indexOf:function(a){var b=this.get(a?"prevRowKey":"rowKey"),c=this.get(a?"prevColumnName":"columnName");return{rowIdx:this.grid.dataModel.indexOfRowKey(b),columnIdx:this.grid.columnModel.indexOfColumnName(c)}},has:function(){return!(void 0===this.get("rowKey")||!this.get("columnName"))},findRowKey:function(a){var b,c,d=this.grid.dataModel;return this.has()?(b=Math.max(Math.min(d.indexOfRowKey(this.get("rowKey"))+a,this.grid.dataModel.length-1),0),c=d.at(b),c&&c.get("rowKey")):void 0},findColumnName:function(a){var b,c=this.grid.columnModel,d=c.getVisibleColumnModelList();return this.has()?(b=Math.max(Math.min(c.indexOfColumnName(this.get("columnName"))+a,d.length-1),0),d[b]&&d[b].columnName):void 0},_getRowSpanData:function(a,b){return this.grid.dataModel.get(a).getRowSpanData(b)},nextRowIndex:function(a){var b=this.nextRowKey(a);return this.grid.dataModel.indexOfRowKey(b)},prevRowIndex:function(a){var b=this.prevRowKey(a);return this.grid.dataModel.indexOfRowKey(b)},nextColumnIndex:function(){var a=this.nextColumnName();return this.grid.columnModel.indexOfColumnName(a)},prevColumnIndex:function(){var a=this.prevColumnName();return this.grid.columnModel.indexOfColumnName(a)},nextRowKey:function(a){var b,c,d=this.which(),e=d.rowKey;return a="number"==typeof a?a:1,a>1?(e=this.findRowKey(a),c=this._getRowSpanData(e,d.columnName),c.isMainRow||(e=this.findRowKey(c.count+a))):(c=this._getRowSpanData(e,d.columnName),c.isMainRow&&c.count>0?e=this.findRowKey(c.count):c.isMainRow?e=this.findRowKey(1):(b=c.count,c=this._getRowSpanData(c.mainRowKey,d.columnName),e=this.findRowKey(c.count+b))),e},prevRowKey:function(a){var b,c=this.which(),d=c.rowKey;return a="number"==typeof a?a:1,a*=-1,-1>a?(d=this.findRowKey(a),b=this._getRowSpanData(d,c.columnName),b.isMainRow||(d=this.findRowKey(b.count+a))):(b=this._getRowSpanData(d,c.columnName),d=this.findRowKey(b.isMainRow?-1:b.count-1)),d},nextColumnName:function(){return this.findColumnName(1)},prevColumnName:function(){return this.findColumnName(-1)}}),b.Renderer.Smart=b.Renderer.extend({initialize:function(){b.Renderer.prototype.initialize.apply(this,arguments),this.on("change:scrollTop",this._onChange,this),this.listenTo(this.grid.dimensionModel,"change:bodyHeight",this._onChange,this),this.setOwnProperties({hiddenRowCount:10,criticalPoint:3})},_onChange:function(){this._isRenderable()===!0&&this.refresh()},_setRenderingRange:function(){var a,b=this.get("scrollTop"),c=this.grid.dimensionModel.get("rowHeight"),d=(this.grid.dimensionModel.get("bodyHeight"),this.grid.dimensionModel.getDisplayRowCount()),f=Math.max(0,Math.ceil(b/(c+1))-this.hiddenRowCount),g=Math.min(this.grid.dataModel.length-1,Math.floor(f+this.hiddenRowCount+d+this.hiddenRowCount));if(!this.grid.isSorted()){var h=[],i=[];_.each(this.grid.dataModel.at(f).get("_extraData").rowSpanData,function(a){a.isMainRow||h.push(a.count)},this),_.each(this.grid.dataModel.at(g).get("_extraData").rowSpanData,function(a){a.count>0&&i.push(a.count)},this),h.length>0&&(f+=Math.min.apply(Math,h)),i.length>0&&(g+=Math.max.apply(Math,i))}a=0===f?0:e.getTBodyHeight(f,c)-1,this.set({top:a,startIdx:f,endIdx:g})},_isRenderable:function(){var a=this.get("scrollTop"),b=this.grid.dimensionModel.get("rowHeight"),c=this.grid.dimensionModel.get("bodyHeight"),d=this.grid.dimensionModel.getDisplayRowCount(),e=this.grid.dataModel.length,f=Math.max(0,Math.ceil(a/(b+1))),g=Math.min(this.grid.dataModel.length-1,Math.floor((a+c)/(b+1))),h=this.get("startIdx"),i=this.get("endIdx");return console.log("#########GAP",i-h,d),0!==h&&h+this.criticalPoint>f||i!==e-1&&e>i&&i-this.criticalPoint<g?(console.log(h+this.criticalPoint,f),console.log(i-this.criticalPoint,g),!0):!1}}),b.Row=b.Base.extend({idAttribute:"rowKey",defaults:{},initialize:function(a){b.Base.prototype.initialize.apply(this,arguments);var c=a&&a.rowKey;this.grid.dataModel.get(c)&&(this.listenTo(this.grid.dataModel.get(c),"change",this._onDataModelChange,this),this.listenTo(this.grid.dataModel.get(c),"restore",this._onDataModelChange,this))},_onDataModelChange:function(a){_.each(a.changed,function(a,b){"_extraData"===b?this.updateRowSpanned():this.setCell(b,{value:a})},this)},updateRowSpanned:function(a){if(this.collection){var b,c=this.grid.columnModel.getVisibleColumnModelList(),d=this.grid.dataModel.get(this.get("rowKey")),e=d.get("_extraData"),f=e.selected||!1,g=e.focused,h=d.getRowState();_.each(c,function(c){var d=c.columnName,e=this.get(d),i=this,j=d===g,k="_button"===d?h.isDisabledCheck:h.isDisabled;e&&(this.grid.isSorted()||e.isMainRow||(i=this.collection.get(e.mainRowKey)),(i&&!a||a&&!e.isMainRow)&&(b={focused:j,selected:f,className:h.classNameList.join(" ")},k&&(b.isDisabled=!0),i.setCell(d,b)))},this)}},parse:function(a){var b=this.collection.grid,c=b.dataModel,d=a.rowKey;return _.each(a,function(e,f){var g,h=a._extraData.focused===f,i=!!a._extraData.selected,j=c.get(d).getRowState(),k=j.isDisabled,l=b.isEditable(d,f),m={mainRowKey:d,count:0,isMainRow:!0};"rowKey"!==f&&"_extraData"!==f&&(g=b.isSorted()?m:a._extraData&&a._extraData.rowSpanData&&a._extraData.rowSpanData[f]||m,k="_button"===f?j.isDisabledCheck:k,a[f]={rowKey:d,columnName:f,value:e,rowSpan:g.count,isMainRow:g.isMainRow,mainRowKey:g.mainRowKey,isEditable:l,isDisabled:k,optionList:[],className:j.classNameList.join(" "),focused:h,selected:i,changed:[]})},this),a},setCell:function(a,b){if(this.get(a)){var c,d=_.clone(this.get(a)),f=!1,g=[],h=this.get(a).rowKey;for(var i in b)e.isEqual(d[i],b[i])||(f="value"===i?!0:f,d[i]=b[i],g.push(i));g.length&&(d.changed=g,this.set(a,d),f&&(c=this.grid.dataModel.indexOfRowKey(h),this.grid.renderModel.executeRelation(c)))}}}),b.RowList=d.Base.extend({model:b.Row,initialize:function(){d.Base.prototype.initialize.apply(this,arguments),this.on("reset",this._onReset,this)},_onReset:function(){var a=this.grid.focusModel.which(),b=this.get(a.rowKey);b&&b.updateRowSpanned()}}),a.Layout.Frame=a.Base.extend({tagName:"div",className:"lside_area",initialize:function(){a.Base.prototype.initialize.apply(this,arguments),this.listenTo(this.grid.renderModel,"columnModelChanged",this.render,this),this.listenTo(this.grid.dimensionModel,"columnWidthChanged",this._onColumnWidthChanged,this),this.setOwnProperties({header:null,body:null})},render:function(){this.destroyChildren(),this.trigger("beforeRender"),this.beforeRender();var b=this.header=this.createView(a.Layout.Header,{grid:this.grid,whichSide:this.whichSide}),c=this.body=this.createView(a.Layout.Body,{grid:this.grid,whichSide:this.whichSide});return this.$el.append(b.render().el).append(c.render().el),this.afterRender(),this.trigger("afterRender"),this},beforeRender:function(){},afterRender:function(){}}),a.Layout.Body=a.Base.extend({tagName:"div",className:"data",template:_.template('<div class="table_container" style="top: 0px">    <table width="100%" border="0" cellspacing="1" cellpadding="0" bgcolor="#EFEFEF">        <colgroup><%=colGroup%></colgroup>        <tbody></tbody>    </table></div>'),events:{scroll:"_onScroll",mousedown:"_onMouseDown"},initialize:function(b){a.Base.prototype.initialize.apply(this,arguments),this.setOwnProperties({whichSide:b&&b.whichSide||"R"}),this.listenTo(this.grid.dimensionModel,"columnWidthChanged",this._onColumnWidthChanged,this).listenTo(this.grid.dimensionModel,"change:bodyHeight",this._onBodyHeightChange,this).listenTo(this.grid.renderModel,"change:top",this._onTopChange,this).listenTo(this.grid.renderModel,"change:scrollTop",this._onScrollTopChange,this).listenTo(this.grid.renderModel,"change:scrollLeft",this._onScrollLeftChange,this).listenTo(this.grid.renderModel,"beforeRefresh",this._onBeforeRefresh,this)},_onBodyHeightChange:function(a,b){this.$el.css("height",b+"px")},_onColumnWidthChanged:function(){for(var a=this.grid.dimensionModel.getColumnWidthList(this.whichSide),b=this.$el.find("col"),c=0;c<b.length;c++)b.eq(c).css("width",a[c]+"px")},_onMouseDown:function(a){var b,c,d=this.grid.selection;a.shiftKey?(b=this.grid.focusModel.indexOf(!0),d.hasSelection()||d.startSelection(b.rowIdx,b.columnIdx),d.attachMouseEvent(a.pageX,a.pageY),c=d.getIndexFromMousePosition(a.pageX,a.pageY),d.updateSelection(c.row,c.column),this.grid.focusAt(c.row,c.column)):(d.endSelection(),this.grid.selection.attachMouseEvent(a.pageX,a.pageY))},_onScroll:function(a){var b={};b.scrollTop=a.target.scrollTop,"R"===this.whichSide&&(b.scrollLeft=a.target.scrollLeft),this.grid.renderModel.set(b)},_onScrollLeftChange:function(a,b){"R"===this.whichSide&&(this.el.scrollLeft=b)
},_onScrollTopChange:function(a,b){this.el.scrollTop=b},_onTopChange:function(a,b){this.$el.children(".table_container").css("top",b+"px")},_onBeforeRefresh:function(){this.el.scrollTop=this.grid.renderModel.previous("scrollTop")},_getViewCollection:function(){return this.grid.renderModel.getCollection(this.whichSide)},render:function(){var b,c;return this.destroyChildren(),this.$el.css({height:this.grid.dimensionModel.get("bodyHeight")}).html(this.template({colGroup:this._getColGroupMarkup()})),c=this.createView(a.RowList,{grid:this.grid,collection:this._getViewCollection(),el:this.$el.find("tbody"),whichSide:this.whichSide}),c.render(),b=this.addView(this.grid.selection.createLayer(this.whichSide)),this.$el.append(b.render().el),this},_getColGroupMarkup:function(){for(var a=this.grid.columnModel,b=this.grid.dimensionModel,c=b.getColumnWidthList(this.whichSide),d=a.getVisibleColumnModelList(this.whichSide),e="",f=0,g=c.length;g>f;f++)e+='<col columnname="'+d[f].columnName+'" style="width:'+c[f]+'px">';return e}}),a.Layout.Frame.Lside=a.Layout.Frame.extend({className:"lside_area",initialize:function(){a.Layout.Frame.prototype.initialize.apply(this,arguments),this.setOwnProperties({whichSide:"L"})},_onColumnWidthChanged:function(){var a=this.grid.dimensionModel.get("lsideWidth");this.$el.css({width:a+"px"})},beforeRender:function(){var a=this.grid.dimensionModel.get("lsideWidth");this.$el.css({display:"block",width:a+"px"})}}),a.Layout.Frame.Rside=a.Layout.Frame.extend({className:"rside_area",initialize:function(){a.Layout.Frame.prototype.initialize.apply(this,arguments),this.setOwnProperties({whichSide:"R"})},_onColumnWidthChanged:function(){var a=this.grid.dimensionModel,b=a.get("lsideWidth"),c=a.get("rsideWidth");this.$el.css({width:c+"px",marginLeft:b+"px"})},beforeRender:function(){var a=this.grid.dimensionModel,b=a.get("lsideWidth"),c=a.get("rsideWidth");this.$el.css({display:"block",width:c+"px",marginLeft:b+"px"})},afterRender:function(){var b,c=$("<div></div>");c.css({height:this.grid.dimensionModel.get("headerHeight")-2}).addClass("space"),this.$el.append(c),this.grid.option("notUseSmartRendering")===!1&&(b=this.createView(a.Layout.Frame.Rside.VirtualScrollBar,{grid:this.grid}),this.$el.append(b.render().el))}}),a.Layout.Frame.Rside.VirtualScrollBar=a.Base.extend({tagName:"div",className:"virtual_scrollbar",initialize:function(){a.Base.prototype.initialize.apply(this,arguments),this.listenTo(this.grid.dataModel,"sort add remove reset",this._setHeight,this),this.listenTo(this.grid.dimensionModel,"change",this._onDimensionChange,this),this.listenTo(this.grid.renderModel,"change:scrollTop",this._onScrollTopChange,this)},template:_.template('<div class="content"></div>'),events:{scroll:"_onScroll"},_onScroll:function(a){this.grid.renderModel.set("scrollTop",a.target.scrollTop)},_onDimensionChange:function(a){(a.changed.headerHeight||a.changed.bodyHeight)&&this.render()},_onScrollTopChange:function(a,b){var c;this.el.scrollTop=b,c=this.el.scrollTop,c!==b&&this.grid.renderModel.set("scrollTop",c)},render:function(){return this.$el.css({height:this.grid.dimensionModel.get("bodyHeight")-this.grid.scrollBarSize,top:this.grid.dimensionModel.get("headerHeight"),display:"block"}).html(this.template()),this._setHeight(),this},_setHeight:function(){var a=this.grid.dimensionModel.get("rowHeight"),b=this.grid.dataModel.length,c=a*this.grid.dataModel.length+(b+1);this.$el.find(".content").height(c)}}),a.Layout.Header=a.Base.extend({tagName:"div",className:"header",viewList:[],whichSide:"R",events:{click:"_onClick"},initialize:function(b){a.Base.prototype.initialize.apply(this,arguments),this.whichSide=b.whichSide,this.viewList=[],this.listenTo(this.grid.renderModel,"change:scrollLeft",this._onScrollLeftChange,this),this.listenTo(this.grid.dimensionModel,"columnWidthChanged",this._onColumnWidthChanged,this)},_onColumnWidthChanged:function(){for(var a=this._getColumnData(),b=a.widthList,c=this.$el.find("col"),d=0;d<c.length;d++)c.eq(d).css("width",b[d]+"px")},_onScrollLeftChange:function(a,b){"R"===this.whichSide&&(this.el.scrollLeft=b)},_onClick:function(a){var b=$(a.target);"_button"===b.closest("th").attr("columnname")},template:_.template('    <table width="100%" border="0" cellspacing="1" cellpadding="0" bgcolor="#EFEFEF">        <colgroup><%=colGroup%></colgroup>        <tbody><%=tBody%></tbody>    </table>'),render:function(){this.destroyChildren();var b=this.createView(a.Layout.Header.ResizeHandler,{whichSide:this.whichSide,grid:this.grid});return this.$el.css({height:this.grid.dimensionModel.get("headerHeight")}).html(this.template({colGroup:this._getColGroupMarkup(),tBody:this._getTableBodyMarkup()})),this.$el.append(b.render().el),this},_getColumnData:function(){var a=this.grid.columnModel,b=this.grid.dimensionModel,c=b.getColumnWidthList(this.whichSide),d=a.getVisibleColumnModelList(this.whichSide);return{widthList:c,modelList:d}},_getColGroupMarkup:function(){for(var a=this._getColumnData(),b=a.widthList,c=a.modelList,d="",e=0,f=b.length;f>e;e++)d+='<col columnname="'+c[e].columnName+'" style="width:'+b[e]+'px">';return d},_getHeaderHeight:function(){return this.grid.dimensionModel.get("headerHeight")},_getTableBodyMarkup:function(){for(var a,b,c,d,f,g=this._getColumnHierarchyList(),h=this._getHierarchyMaxRowCount(g),i=(this._getColumnData(),this._getHeaderHeight()),j=new Array(h),k=[],l="",m="",n="",o="",p="",q=new Array(h),r=[],s=1,t=e.getRowHeight(h,i)-1,u=0;u<g.length;u++){d=g[u].length,b=0;for(var v=0;d>v;v++)s=d-1==v&&h-d+1>1?h-d+1:1,c=g[u][v],a=t*s,v===d-1?a=i-b-2:b+=a+1,q[v]==c.columnName?(j[v].pop(),r[v]+=1):r[v]=1,q[v]=c.columnName,l=" columnName='"+c.columnName+"'",n=" height='"+a+"'",p=s>1?" rowSpan='"+s+"'":"",o=r[v]>1?" colSpan='"+r[v]+"'":"",j[v]=j[v]||[],f=c.title,j[v].push("<th"+l+m+n+p+o+">"+f+"</th>")}for(var u=0;u<j.length;u++)k.push("<tr>"+j[u].join("")+"</tr>");return k.join("")},_getHierarchyMaxRowCount:function(a){var b=[];return _.each(a,function(a){b.push(a.length)},this),Math.max.apply(Math,b)},_getColumnHierarchyList:function(){var a=this._getColumnData().modelList,b=[];return _.each(a,function(a){b.push(this._getColumnHierarchy(a).reverse())},this),b},_getColumnHierarchy:function(a,b){var c=this.grid.option("columnMerge"),b=b||[];if(a&&(b.push(a),c))for(var d=0;d<c.length;d++)-1!==$.inArray(a.columnName,c[d].columnNameList)&&(b=this._getColumnHierarchy(c[d],b));return b}}),a.Layout.Header.ResizeHandler=a.Base.extend({tagName:"div",className:"resize_handle_container",viewList:[],whichSide:"R",events:{"mousedown .resize_handle":"_onMouseDown"},initialize:function(b){a.Base.prototype.initialize.apply(this,arguments),this.setOwnProperties({whichSide:b.whichSide,isResizing:!1,$target:null,differenceLeft:0,initialWidth:0,initialOffsetLeft:0,initialLeft:0}),this.listenTo(this.grid.dimensionModel,"columnWidthChanged",this._refreshHandlerPosition,this)},_getColumnData:function(){var a=this.grid.columnModel,b=this.grid.dimensionModel,c=b.getColumnWidthList(this.whichSide),d=a.getVisibleColumnModelList(this.whichSide);return{widthList:c,modelList:d}},_getResizeHandler:function(){for(var a=this._getColumnData(),b=a.modelList,c=[],d=this.grid.dimensionModel.get("headerHeight"),e=0;e<b.length;e++)c.push("<div columnIndex='"+e+"' columnName='"+b[e].columnName+"' class='resize_handle"+(e+1==b.length?" resize_handle_last":"")+"' style='height:"+d+"px;' title='마우스 드래그를 통해 컬럼의 넓이를 변경할 수 있고,\n더블클릭을 통해 넓이를 초기화할 수 있습니다.'></div>");return c.join("")},render:function(){var a=this.grid.dimensionModel.get("headerHeight");return this.$el.empty(),this.$el.show().css({marginTop:-a+"px",height:a+"px"}).html(this._getResizeHandler()),this._refreshHandlerPosition(),this},_refreshHandlerPosition:function(){for(var a=this._getColumnData(),b=a.widthList,c=this.$el.find(".resize_handle"),d=0,e=0,f=c.length;f>e;e++)d+=b[e]+1,c.eq(e).css("left",d-3+"px")},_isResizing:function(){return!!this.isResizing},_onMouseDown:function(a){this._startResizing(a)},_onMouseUp:function(){this._stopResizing(),this.isResizing=!1},_onMouseMove:function(a){if(this._isResizing()){a.preventDefault();var b=a.pageX-this.initialOffsetLeft;this.$target.css("left",b+"px");var c=this._calculateWidth(a.pageX),d=parseInt(this.$target.attr("columnindex"),10);this.grid.dimensionModel.setColumnWidth(this._getColumnIndex(d),c)}},_calculateWidth:function(a){var b=a-this.initialOffsetLeft-this.initialLeft;return this.initialWidth+b},_getColumnIndex:function(a){return"R"===this.whichSide?a+this.grid.columnModel.get("columnFixIndex"):a},_startResizing:function(a){var b=this._getColumnData(),c=b.widthList,d=$(a.target);this.isResizing=!0,this.$target=d,this.initialLeft=parseInt(d.css("left").replace("px",""),10),this.initialOffsetLeft=this.$el.offset().left,this.initialWidth=c[d.attr("columnindex")],this.grid.$el.bind("mousemove",$.proxy(this._onMouseMove,this)).bind("mouseup",$.proxy(this._onMouseUp,this)).css("cursor","col-resize")},_stopResizing:function(){this.isResizing=!1,this.$target=null,this.initialLeft=0,this.initialOffsetLeft=0,this.initialWidth=0,this.grid.$el.unbind("mousemove",$.proxy(this._onMouseMove,this)).unbind("mouseup",$.proxy(this._onMouseUp,this)).css("cursor","default")}}),a.Layout.Toolbar=a.Base.extend({tagName:"div",className:"toolbar",initialize:function(){a.Base.prototype.initialize.apply(this,arguments)},render:function(){this.destroyChildren();var b,c,d=this.grid.option("toolbar");return this.$el.empty(),d&&d.hasControlPannel&&(c=this.createView(a.Layout.Toolbar.ControlPannel,{grid:this.grid}),this.$el.append(c.render().el).css("display","block")),d&&d.hasResizeHandler&&(b=this.createView(a.Layout.Toolbar.ResizeHandler,{grid:this.grid}),this.$el.append(b.render().el).css("display","block")),this}}),a.Layout.Toolbar.ResizeHandler=a.Base.extend({tagName:"div",className:"height_resize_bar",events:{mousedown:"_onMouseDown"},template:_.template('<a href="#" class="height_resize_handle">높이 조절</a>'),initialize:function(){a.Base.prototype.initialize.apply(this,arguments)},_attachMouseEvent:function(){$(document).on("mousemove",$.proxy(this._onMouseMove,this)),$(document).on("mouseup",$.proxy(this._onMouseUp,this)),$(document).on("selectstart",$.proxy(this._onSelectStart,this))},_detachMouseEvent:function(){$(document).off("mousemove",$.proxy(this._onMouseMove,this)),$(document).off("mouseup",$.proxy(this._onMouseUp,this)),$(document).off("selectstart",$.proxy(this._onSelectStart,this))},_onMouseDown:function(a){a.preventDefault(),$(document.body).css("cursor","row-resize"),this.grid.updateLayoutData(),this._attachMouseEvent()},_onMouseMove:function(a){var b=this.grid.dimensionModel,c=b.get("offsetTop"),d=b.get("headerHeight"),e=b.get("rowHeight"),f=b.get("toolbarHeight"),g=a.pageY-c-d-f;g=Math.max(g,e+b.getScrollXSize()),b.set({bodyHeight:g})},_onMouseUp:function(){$(document.body).css("cursor","default"),this._detachMouseEvent()},_onSelectStart:function(a){return a.preventDefault(),!1},render:function(){return this.destroyChildren(),this.$el.html(this.template()),this}}),a.Layout.Toolbar.ControlPannel=a.Base.extend({tagName:"div",className:"btn_setup",template:_.template('<a href="#" class="excel_download_button btn_text excel_all" style="display: inline-block;"><span><em class="f_bold p_color5">전체엑셀다운로드</em></span></a><a href="#" class="excel_download_button btn_text excel_grid" style="display: inline-block;"><span><em class="excel">엑셀다운로드</em></span></a><a href="#" class="grid_configurator_button btn_text" style="display: none;"><span><em class="grid">그리드설정</em></span></a>'),initialize:function(){a.Base.prototype.initialize.apply(this,arguments)},render:function(){return this.destroyChildren(),this.$el.html(this.template()),this}}),a.Renderer.Row=a.Base.Renderer.extend({eventHandler:{click:"_onClick",mousedown:"_onMouseDown"},baseTemplate:_.template('<tr key="<%=key%>" style="height: <%=height%>px;"><%=contents%>class="<%=className%>" </tr>'),initialize:function(b){a.Base.Renderer.prototype.initialize.apply(this,arguments);var c=b&&b.whichSide||"R";this.setOwnProperties({$parent:b.$parent,collection:b.collection,whichSide:c,columnModelList:this.grid.columnModel.getVisibleColumnModelList(c),cellHandlerList:[],_isEventAttached:!1}),this.collection.forEach(function(a){this.listenTo(a,"change",this._onModelChange,this)},this)},destroy:function(){this.detachHandler(),this.destroyChildren(),this.remove()},attachHandler:function(){this._attachHandler(this.$parent),this.grid.cellFactory.attachHandler(this.$parent),this._isEventAttached=!0},detachHandler:function(){this._isEventAttached&&(this._detachHandler(this.$parent),this.grid.cellFactory.detachHandler(this.$parent))},_onClick:function(a){console.log("click",a)},_onMouseDown:function(a){var b=$(a.target).closest("td"),c=$(a.target).closest("tr"),d=b.attr("columnName"),e=c.attr("key");this.grid.focus(e,d),"radio"===this.grid.option("selectType")&&this.grid.checkRow(e)},_onModelChange:function(a){{var b,c,d;this.grid.columnModel}_.each(a.changed,function(a,e){"_extraData"!==e?(b=this._getEditType(e,a),c=this.grid.cellFactory.getInstance(b),c.onModelChange(a,this._getTrElement(a.rowKey))):(d=a.rowState,d&&this._setRowState(d,this._getTrElement(a.rowKey)))},this)},_setRowState:function(){},_getTrElement:function(a){return this.$parent.find('tr[key="'+a+'"]')},_getEditType:function(a,b){return b.isEditable?this.grid.columnModel.getEditType(a):"normal"},getHtml:function(a){var b,c,d,e,f=this.columnModelList,g=(this.grid.columnModel,this.grid.cellFactory),h="";this.cellHandlerList=[];for(var i=0,j=f.length;j>i;i++)b=f[i].columnName,c=a.get(b),c&&c.isMainRow&&(d=this._getEditType(b,c),e=g.getInstance(d),h+=e.getHtml(c),this.cellHandlerList.push({selector:'td[columnName="'+b+'"]',cellInstance:e}));return this.baseTemplate({key:a.get("rowKey"),height:this.grid.dimensionModel.get("rowHeight"),contents:h,className:""})}}),a.Base.Renderer.Cell.Interface=a.Base.Renderer.Cell.extend({cellType:"normal",rerenderAttributes:["isEditable","optionList","value"],eventHandler:{},initialize:function(){a.Base.Renderer.Cell.prototype.initialize.apply(this,arguments)},focusIn:function(){},focusOut:function(){this.grid.focusClipboard()},getContentHtml:function(){throw this.error("Implement getContentHtml(cellData, $target) method. On re-rendering")},setElementAttribute:function(){throw this.error("Implement setElementAttribute(cellData, $target) method. ")}}),a.Base.Renderer.Cell.Abstract=a.Base.Renderer.Cell.extend({cellType:"normal",rerenderAttributes:["isEditable","optionList","value"],eventHandler:{},initialize:function(){a.Base.Renderer.Cell.prototype.initialize.apply(this,arguments)},focusIn:function(){},focusOut:function(){this.grid.focusClipboard()},_onKeyDown:function(a){var b=$(a.target),c=this.grid,d=c.keyMap,e=!0,f=a.keyCode||a.which;switch(f){case d.ESC:this.focusOut(b);break;case d.ENTER:this.focusOut(b);break;case d.TAB:a.shiftKey;break;default:e=!1}e&&a.preventDefault()},getContentHtml:function(){throw this.error("Implement getContentHtml(cellData, $target) method. On re-rendering")},setElementAttribute:function(){throw this.error("Implement setElementAttribute(cellData, $target) method. ")}}),a.Renderer.Cell.List=a.Base.Renderer.Cell.Abstract.extend({rerenderAttributes:["isEditable","optionList"],eventHandler:{},initialize:function(){a.Base.Renderer.Cell.Abstract.prototype.initialize.apply(this,arguments)},getContentHtml:function(){throw this.error("Implement getContentHtml(cellData, $target) method. On re-rendering")},setElementAttribute:function(){throw this.error("Implement setElementAttribute(cellData, $target) method. ")},_getOptionList:function(a){var b=this.grid.columnModel.getColumnModel(a.columnName);return a.optionList&&a.optionList.length?a.optionList:b.editOption.list},_onBlur:function(a){var b=$(a.target);b.closest("td").data("isFocused",!1)},_onFocus:function(a){var b=$(a.target);b.closest("td").data("isFocused",!0)}}),a.Renderer.Cell.List.Select=a.Renderer.Cell.List.extend({cellType:"select",initialize:function(){a.Renderer.Cell.List.prototype.initialize.apply(this,arguments)},eventHandler:{"change select":"_onChange","keydown select":"_onKeyDown","blur select":"_onBlur","focus select":"_onFocus"},focusIn:function(a){a.find("select").focus()},getContentHtml:function(a){console.log("!!!!getContentHtml",a.optionList);var b=this._getOptionList(a),c="",d=a.isDisabled,f=b.length;c+='<select name="'+e.getUniqueKey()+'"',c+=d?" disabled ":"",c+=">";for(var g=0;f>g;g++)c+="<option ",c+='value="'+b[g].value+'"',a.value==b[g].value&&(c+=" selected"),c+=" >",c+=b[g].text,c+="</option>";return c+="</select>"},setElementAttribute:function(a,b,c){console.log("!!!!setElementAttribute",a.optionList);var d=b.find("select");c?d.blur():null,d.val(a.value),c?d.focus():null},_onChange:function(a){var b=$(a.target),c=this._getCellAddress(b),d=this.grid;d.setValue(c.rowKey,c.columnName,b.val())}}),a.Renderer.Cell.List.Button=a.Renderer.Cell.List.extend({cellType:"button",initialize:function(){a.Renderer.Cell.List.prototype.initialize.apply(this,arguments)},eventHandler:{"change input":"_onChange","keydown input":"_onKeyDown"},template:{input:_.template('<input type="<%=type%>" name="<%=name%>" id="<%=id%>" value="<%=value%>" <%=checked%> <%=disabled%> />'),label:_.template('<label for="<%=id%>" style="margin-right:10px"><%=text%></label>')},focusIn:function(a){a.find("input").eq(0).focus()},_getNextInput:function(a){var b=a;do b=b.next();while(b.length&&!b.is("input"));return b},_getPrevInput:function(a){var b=a;do b=b.prev();while(b.length&&!b.is("input"));return b},_onKeyDown:function(a){var b,c,d=$(a.target),e=this.grid,f=e.keyMap,g=!0,h=a.keyCode||a.which;switch(h){case f.UP_ARROW:break;case f.DOWN_ARROW:break;case f.LEFT_ARROW:c=this._getPrevInput(d),c.length?c.focus():null;break;case f.RIGHT_ARROW:b=this._getNextInput(d),b.length?b.focus():null;break;case f.ESC:this.focusOut(d);break;case f.ENTER:d.trigger("click");break;case f.TAB:a.shiftKey;break;default:g=!1}g&&a.preventDefault()},getContentHtml:function(a){for(var b,c=this._getOptionList(a),d=c.length,f=this.grid.columnModel.getColumnModel(a.columnName),g=a.value,h=(""+g).split(","),i="",j=e.getUniqueKey(),k=a.isDisabled,l=0;d>l;l++)b=j+"_"+c[l].value,i+=this.template.input({type:f.editOption.type,name:j,id:b,value:c[l].value,checked:-1===$.inArray(""+c[l].value,h)?"":"checked",disabled:k?"disabled":""}),c[l].text&&(i+=this.template.label({id:b,text:c[l].text}));return i},setElementAttribute:function(a,b){var c,d=a.value,e=(""+d).split(","),f=e.length;for(b.find("input:checked").prop("checked",!1),c=0;f>c;c++)b.find('input[value="'+e[c]+'"]').prop("checked",!0)},_getEditType:function(a){var b=this._getColumnName(a),c=this.grid.columnModel.getColumnModel(b),d=c.editOption.type;return d},_getCheckedList:function(a){for(var b=a.closest("td").find("input[type="+this._getEditType(a)+"]:checked"),c=[],d=0;d<b.length;d++)c.push(b.eq(d).val());return c},_onChange:function(a){var b=$(a.target),c=this._getCellAddress(b);console.log("button _onChange",this._getCheckedList(b).join(",")),this.grid.setValue(c.rowKey,c.columnName,this._getCheckedList(b).join(","))}}),a.Renderer.Cell.Normal=a.Base.Renderer.Cell.Abstract.extend({initialize:function(){a.Base.Renderer.Cell.Abstract.prototype.initialize.apply(this,arguments)},getContentHtml:function(a){var b=a.columnName,c=this.grid.columnModel.getColumnModel(b),d=this.grid.dataModel.get(a.rowKey).getTagFiltered(b),e=a.rowKey;return"function"==typeof c.formatter&&(d=c.formatter(d,this.grid.dataModel.get(e).toJSON(),c)),d},setElementAttribute:function(){}}),a.Renderer.Cell.MainButton=a.Base.Renderer.Cell.Abstract.extend({cellType:"main",rerenderAttributes:["isEditable","optionList"],eventHandler:{mousedown:"_onMouseDown","change input":"_onChange"},initialize:function(){a.Base.Renderer.Cell.Abstract.prototype.initialize.apply(this,arguments)},template:_.template('<input type="<%=type%>" name="<%=name%>" <%=checked%> <%=disabled%>/>'),getContentHtml:function(a){var b=a.isDisabled;return this.template({type:this.grid.option("selectType"),name:this.grid.id,checked:a.value?"checked":"",disabled:b?"disabled":""})},setElementAttribute:function(a,b){b.find("input").prop("checked",!!a.value)},getAttributes:function(){return this.getAttributesString({align:"center"})},_onChange:function(a){var b=$(a.target),c=this._getRowKey(b),d=this._getColumnName(b);this.grid.setValue(c,d,b.prop("checked"))},_onMouseDown:function(a){var b=$(a.target);b.is("input")||b.find("input").trigger("click")}}),a.Renderer.Cell.Text=a.Base.Renderer.Cell.Abstract.extend({cellType:"text",rerenderAttributes:["isEditable"],eventHandler:{"blur input":"_onBlur","keydown input":"_onKeyDown"},initialize:function(){a.Base.Renderer.Cell.Abstract.prototype.initialize.apply(this,arguments),this.setOwnProperties({originalText:""})},template:_.template('<input type="text" value="<%=value%>" name="<%=name%>" <%=disabled%>/>'),focusIn:function(a){var b=a.find("input");this.originalText=b.val(),b.focus(),e.setCursorToEnd(b.get(0))},focusOut:function(){this.grid.focusClipboard()},getContentHtml:function(a){var b=this.grid.dataModel.get(a.rowKey).getTagFiltered(a.columnName);return this.template({value:b,disabled:a.isDisabled?"disabled":"",name:e.getUniqueKey()})},setElementAttribute:function(a,b){b.find("input").prop("disabled",a.isDisabled)},_isEdited:function(a){return a.val()!==this.originalText},_restore:function(a){a.val(this.originalText)},_onKeyDown:function(a){var b=$(a.target),c=this.grid,d=c.keyMap,e=!0,f=a.keyCode||a.which;switch(f){case d.ESC:this._restore(b),this.focusOut(b);break;case d.ENTER:this.focusOut(b);break;case d.TAB:a.shiftKey;break;default:e=!1}e&&a.preventDefault()},_onBlur:function(a){var b=$(a.target),c=this._getRowKey(b),d=this._getColumnName(b);this._isEdited(b)&&this.grid.setValue(c,d,b.val())}}),a.Renderer.Cell.Text.Convertible=a.Renderer.Cell.Text.extend({cellType:"text-convertible",rerenderAttributes:["isEditable","optionList","value"],eventHandler:{click:"_onClick","blur input":"_onBlurConvertible","keydown input":"_onKeyDown"},initialize:function(){a.Renderer.Cell.Text.prototype.initialize.apply(this,arguments),this.setOwnProperties({timeoutIdForClick:0})},focusIn:function(a){this._startEdit(a)},focusOut:function(a){this._endEdit(a),this.grid.focusClipboard()},getContentHtml:function(a){var b=this.grid.dataModel.get(a.rowKey).getTagFiltered(a.columnName),c=this.grid.getCellElement(a.rowKey,a.columnName),d=!(!c.length||!c.data("isEdit"));return d?this.template({value:b,disabled:a.isDisabled?"disabled":"",name:e.getUniqueKey()}):b},_onBlurConvertible:function(a){var b=$(a.target),c=b.closest("td");this._onBlur(a),this._endEdit(c)},_startEdit:function(a){var b,c=a.data("isEdit");!c&&this.grid.isEditable(this._getRowKey(a),this._getColumnName(a))&&(a.data("isEdit",!0),this.render(this._getCellData(a),a),b=a.find("input"),this.originalText=b.val(),b.focus(),e.setCursorToEnd(b.get(0)))},_endEdit:function(a){var b=a.data("isEdit");b&&(a.data("isEdit",!1),this.render(this._getCellData(a),a))},_onClick:function(a){var b=$(a.target),c=b.closest("td"),d=c.data("clicked");d?this._startEdit(c):(c.data("clicked",!0),clearTimeout(this.timeoutIdForClick),this.timeoutIdForClick=setTimeout(function(){c.data("clicked",!1)},400))}}),a.Extra.Log=a.Base.extend({events:{"click input":"clear"},initialize:function(){a.Base.prototype.initialize.apply(this,arguments),this.setOwnProperties({maxCount:20,logs:[],buffer:"",lastTime:-1,timeoutIdForLogs:0,width:500,height:200,opacity:.8})},activate:function(){this.grid.option("debug")===!0&&this.listenTo(this.grid,"afterRender",this.appendTo,this)},appendTo:function(){this.grid.$el.append(this.render().el)},render:function(){return this.$el.css({position:"absolute",right:"25px",top:"25px",opacity:this.opacity,background:"yellow",width:this.width+"px",height:this.height+"px",overflow:"auto"}),this},clear:function(){},write:function(a){this.buffer||(this.buffer=""),clearTimeout(this.timeoutIdForLogs);var b=this.buffer,c=new Date,d="["+c.getHours()+":"+c.getMinutes()+":"+c.getSeconds()+"] ",e=0;this.lastTime>0&&(e=c-this.lastTime),this.lastTime=c;var f=b.split("<br>");f.length>this.maxCount&&f.pop(),f.unshift("<b>"+d+a+" :elapsed ["+e+"]</b>"),this.buffer=f.join("<br>"),this.timeoutIdForLogs=setTimeout($.proxy(function(){this.$el.html(this.buffer)},this),100)}}),a.Extra.Selection=a.Base.extend({events:{},initialize:function(b){a.Base.prototype.initialize.apply(this,arguments),this.setOwnProperties({whichSide:b&&b.whichSide||"R",lside:null,rside:null,range:{column:[0,1],row:[2,3]}})},activate:function(){this.listenTo(this.grid.view.rside,"afterRender",this.appendToRside,"a"),this.listenTo(this.grid.view.lside,"afterRender",this.appendToLside,"b")},appendToRside:function(){this.rside=this.appendTo(this.grid.view.rside.body,a.Extra.Selection.Layer.Rside),this.show()},appendToLside:function(){this.lside=this.appendTo(this.grid.view.lside.body,a.Extra.Selection.Layer.Lside)},appendTo:function(){},startSelection:function(a,b){this.range.row[0]=this.range.row[1]=a,this.range.column[0]=this.range.column[1]=b},updateSelectionRange:function(a,b){this.range.row[1]=a,this.range.column[1]=b},endSelection:function(){this.range.row[0]=this.range.row[1]=this.range.column[0]=this.range.column[1]=-1},show:function(){var a=this.grid.dimensionModel.get("rowHeight"),b=Math.min.apply(Math,this.range.row),c=Math.max.apply(Math,this.range.row),d=Math.min.apply(Math,this.range.column),f=Math.max.apply(Math,this.range.column),g=e.getTBodyHeight(b,a),h=e.getTBodyHeight(c-b,a)-3;console.log("this.lside.$el",this.lside),this.lside.show(b,c,d,f),this.rside.show(b,c,d,f),this.lside.$el.css({top:g+"px",width:"100px",height:h+"px",display:"block"})}}),a.Extra.Selection.Layer=a.Base.extend({tagName:"div",className:"selection_layer",initialize:function(b){a.Base.prototype.initialize.apply(this,arguments),this.listenTo(this.grid.renderModel,"change:scrollTop",this._onScrollTopChange,this),this.listenTo(this.grid.renderModel,"beforeRefresh",this._onBeforeRefresh,this),this.listenTo(this.grid.renderModel,"change:top",this._onTopChange,this),this.setOwnProperties({columnWidthList:b.columnWidthList})},_onScrollTopChange:function(){},_onBeforeRefresh:function(){},_onTopChange:function(){},render:function(){return console.log("@@Selection layer render"),this}}),a.Extra.Selection.Layer.Lside=a.Extra.Selection.Layer.extend({initialize:function(){a.Extra.Selection.Layer.prototype.initialize.apply(this,arguments),console.log("LSIDE : ",this.columnWidthList)},_onScrollTopChange:function(){},_onBeforeRefresh:function(){},_onTopChange:function(){console.log(this.$el.length)},show:function(){}}),a.Extra.Selection.Layer.Rside=a.Extra.Selection.Layer.extend({initialize:function(){a.Extra.Selection.Layer.prototype.initialize.apply(this,arguments),console.log("RSIDE : ",this.columnWidthList)},_onScrollTopChange:function(){},_onBeforeRefresh:function(){},_onTopChange:function(){},show:function(){}}),a.CellFactory=a.Base.extend({initialize:function(){a.Base.prototype.initialize.apply(this,arguments);({grid:this.grid});this._initializeInstances()},_initializeInstances:function(){var b={},c={grid:this.grid},d=[new a.Renderer.Cell.MainButton(c),new a.Renderer.Cell.Normal(c),new a.Renderer.Cell.Text(c),new a.Renderer.Cell.List.Button(c),new a.Renderer.Cell.List.Select(c),new a.Renderer.Cell.Text.Convertible(c)];_.each(d,function(a){b[a.cellType]=a},this),this.setOwnProperties({instances:b})},getInstance:function(a){var b=null;switch(a){case"main":b=this.instances[a];break;case"text":b=this.instances[a];break;case"text-convertible":b=this.instances[a];break;case"select":b=this.instances[a];break;case"radio":case"checkbox":b=this.instances.button;break;default:b=this.instances.normal}return b},attachHandler:function(a){for(var b,c,d=a.find("td"),e=0;e<d.length;e++)b=d.eq(e),c=b.data("cell-type"),this.instances[c].attachHandler(b)},detachHandler:function(a){for(var b,c,d=a.find("td"),e=0;e<d.length;e++)b=d.eq(e),c=b.data("cell-type"),this.instances[c].detachHandler(b)}}),a.Clipboard=a.Base.extend({tagName:"textarea",className:"clipboard",events:{keydown:"_onKeydown",focus:"_onFocus",blur:"_onBlur"},_onFocus:function(){console.log("clipboard focus")},_onBlur:function(){console.log("clipboard blur")},initialize:function(){a.Base.prototype.initialize.apply(this,arguments),this.setOwnProperties({timeoutIdForCopy:0,timeoutIdForKeyIn:0,isLocked:!1})},render:function(){return this.$el.css({top:0,left:0,width:"100px",height:"100px"}),this},_lock:function(){},_unlock:function(){},_onKeydown:function(a){a.keyCode||a.which;return this.isLocked?(a.prevetnDefault(),!1):(clearTimeout(this.timeoutIdForKeyIn),this.isLocked=!0,this.timeoutIdForKeyIn=setTimeout($.proxy(function(){this.isLocked=!1},this),10),a.shiftKey&&(a.ctrlKey||a.metaKey)?this._keyInWithShiftAndCtrl(a):a.shiftKey?this._keyInWithShift(a):a.ctrlKey||a.metaKey?this._keyInWithCtrl(a):this._keyIn(a),void 0)},_keyIn:function(a){var b=this.grid,c=b.keyMap,d=b.focusModel,e=b.selection,f=d.which(),g=f.rowKey,h=f.columnName,i=b.dimensionModel.getDisplayRowCount(),j=a.keyCode||a.which;switch(e.endSelection(),j){case c.UP_ARROW:b.focus(d.prevRowKey(),h,!0);break;case c.DOWN_ARROW:b.focus(d.nextRowKey(),h,!0);break;case c.LEFT_ARROW:b.focus(g,d.prevColumnName(),!0);break;case c.RIGHT_ARROW:b.focus(g,d.nextColumnName(),!0);break;case c.PAGE_UP:b.focus(d.prevRowKey(i-1),h,!0);break;case c.PAGE_DOWN:b.focus(d.nextRowKey(i-1),h,!0);break;case c.ENTER:this._focusIn(g,h);break;case c.TAB:break;case c.CHAR_V:}a.preventDefault()},_focusIn:function(a,b){var c,d,e=this.grid;e.isEditable()&&(c=e.cellFactory.getInstance(e.columnModel.getEditType(b)),e.isSorted()||(d=e.renderModel.getCellData(a,b),a=d.mainRowKey),c.focusIn(e.getCellElement(a,b)))},_keyInWithShiftAndCtrl:function(a){var b=this.grid.keyMap,c=a.keyCode||a.which;switch(c){case b.UP_ARROW:break;case b.DOWN_ARROW:break;case b.LEFT_ARROW:break;case b.RIGHT_ARROW:break;case b.ENTER:break;case b.TAB:break;case b.CHAR_V:}a.preventDefault()},_updateSelectionByKeyIn:function(a,b){var c=this.grid.selection,d=this.grid.focusModel.indexOf();c.hasSelection()||c.startSelection(d.rowIdx,d.columnIdx),c.updateSelection(a,b),this.grid.focusAt(a,b,!0)},_keyInWithShift:function(a){var b=this.grid.keyMap,c=(this.grid.selection,this.grid.focusModel),d=this.grid.focusModel.indexOf(),e=this.grid.dimensionModel.getDisplayRowCount(),f=a.keyCode||a.which;switch(f){case b.UP_ARROW:this._updateSelectionByKeyIn(c.prevRowIndex(),d.columnIdx);break;case b.DOWN_ARROW:this._updateSelectionByKeyIn(c.nextRowIndex(),d.columnIdx);break;case b.LEFT_ARROW:this._updateSelectionByKeyIn(d.rowIdx,c.prevColumnIndex());break;case b.RIGHT_ARROW:this._updateSelectionByKeyIn(d.rowIdx,c.nextColumnIndex());break;case b.PAGE_UP:this._updateSelectionByKeyIn(c.prevRowIndex(e-1),d.columnIdx);break;case b.PAGE_DOWN:this._updateSelectionByKeyIn(c.nextRowIndex(e-1),d.columnIdx);break;case b.ENTER:break;case b.TAB:break;case b.CHAR_V:}a.preventDefault()},_keyInWithCtrl:function(a){var b=this.grid.keyMap,c=a.keyCode||a.which;switch(c){case b.CHAR_A:this.grid.selection.selectAll();break;case b.CHAR_C:this._copyToClipboard();break;case b.CHAR_V:}},_getClipboardString:function(){var a,b=this.grid.selection,c=this.grid.focusModel.which();return a=b.isShown()?this.grid.selection.getSelectionToString():this.grid.dataModel.get(c.rowKey).getVisibleText(c.columnName)},_copyToClipboard:function(){var a=this._getClipboardString();console.log(a),window.clipboardData?window.clipboardData.setData("Text",a)?this.$el.select():this.$el.val("").select():this.$el.val(a).select(),this.timeoutIdForCopy=setTimeout($.proxy(function(){this.$el.val("")},this),0)}}),a.RowList=a.Base.extend({initialize:function(b){a.Base.prototype.initialize.apply(this,arguments),this.setOwnProperties({whichSide:b&&b.whichSide||"R",timeoutIdForCollection:0,rowRenderer:null}),this._createRowRenderer(),this.listenTo(this.grid.renderModel,"rowListChanged",this.render,this)
},_createRowRenderer:function(){this.rowRenderer=this.createView(a.Renderer.Row,{grid:this.grid,$parent:this.$el,collection:this.collection,whichSide:this.whichSide})},render:function(){var a="",b=new Date;console.log("View.RowList.render start"),this.rowRenderer.detachHandler(),this.destroyChildren(),this._createRowRenderer(),this.collection.forEach(function(b){a+=this.rowRenderer.getHtml(b)},this),this.$el.html("").prepend(a),this.rowRenderer.attachHandler();var c=new Date;return console.log("View.RowList.addAll end",c-b),this}}),a.Selection=a.Base.extend({events:{},initialize:function(){a.Base.prototype.initialize.apply(this,arguments),this.setOwnProperties({range:{column:[-1,-1],row:[-1,-1]},spannedRange:{column:[-1,-1],row:[-1,-1]},lside:null,rside:null,pageX:0,pageY:0,intervalIdForAutoScroll:0,_isShown:!1})},attachMouseEvent:function(a,b){this.setOwnProperties({pageX:a,pageY:b}),this.grid.updateLayoutData(),$(document).on("mousemove",$.proxy(this._onMouseMove,this)),$(document).on("mouseup",$.proxy(this._onMouseUp,this)),$(document).on("selectstart",$.proxy(this._onSelectStart,this))},detachMouseEvent:function(){clearInterval(this.intervalIdForAutoScroll),this.getSelectionToString(),$(document).off("mousemove",$.proxy(this._onMouseMove,this)),$(document).off("mouseup",$.proxy(this._onMouseUp,this)),$(document).off("selectstart",$.proxy(this._onSelectStart,this))},_onMouseMove:function(a){var b;clearInterval(this.intervalIdForAutoScroll),this.hasSelection()?(b=this.getIndexFromMousePosition(a.pageX,a.pageY),this.updateSelection(b.row,b.column),this.grid.focusAt(b.row,b.column),this._isAutoScrollable(b.overflowX,b.overflowY)&&(this.intervalIdForAutoScroll=setInterval($.proxy(this._adjustScroll,this,b.overflowX,b.overflowY)))):this._getDistance(a)>10&&(b=this.getIndexFromMousePosition(this.pageX,this.pageY),this.startSelection(b.row,b.column))},_isAutoScrollable:function(a,b){return!(0===a&&0===b)},_adjustScroll:function(a,b){var c=this.grid.renderModel,d=c.get("scrollLeft"),e=c.get("maxScrollLeft"),f=c.get("scrollTop");0>a?c.set("scrollLeft",Math.min(Math.max(0,d-40),e)):a>0&&c.set("scrollLeft",Math.min(Math.max(0,d+40),e)),0>b?c.set("scrollTop",Math.max(0,f-40)):b>0&&c.set("scrollTop",Math.max(0,f+40))},_getDistance:function(a){var b=a.pageX,c=a.pageY,d=Math.abs(this.pageX-b),e=Math.abs(this.pageY-c);return Math.round(Math.sqrt(Math.pow(d,2)+Math.pow(e,2)))},_onMouseUp:function(){this.detachMouseEvent()},getIndexFromMousePosition:function(a,b){var c,d,e,f=this._getContainerPosition(a,b),g=this.grid.dimensionModel,h=this.grid.renderModel,i=g.getColumnWidthList(),j=h.get("scrollTop"),k=h.get("scrollLeft"),l=g.getTotalWidth(),m=f.pageY+j,n=f.pageX,o=0,p=0,q=g.get("lsideWidth")>f.pageX,r=i.length,s=0,t=this.grid.option("scrollX")?g.get("bodyHeight")-this.grid.scrollBarSize:g.get("bodyHeight"),u=this.grid.option("scrollY")?g.get("width")-this.grid.scrollBarSize:g.get("width");if(q||(n+=k),c=Math.max(0,Math.min(Math.floor(m/(g.get("rowHeight")+1)),this.grid.dataModel.length-1)),f.pageY<0?p=-1:f.pageY>t&&(p=1),f.pageX<0?o=-1:f.pageX>u&&(o=1),0>n)d=0;else if(n>l)d=r-1;else for(e=0;r>e;e++)if(s+=i[e]+1,s>=n){d=e;break}return{row:c,column:d,overflowX:o,overflowY:p}},getSelectionToString:function(){var a,b,c,d,e,f=this.grid.columnModel.get("columnModelList").slice(this.spannedRange.column[0],this.spannedRange.column[1]+1),g={_button:!0},h=f.length,i=[],j=[],k=[];for(b=0;h>b;b++)i.push(f[b].columnName);for(d=this.grid.dataModel.slice(this.spannedRange.row[0],this.spannedRange.row[1]+1),h=d.length,a=i.length,b=0;h>b;b++){for(j=[],c=0;a>c;c++)g[i[c]]||j.push(d[b].getVisibleText(i[c]));k.push(j.join("	"))}return e=k.join("\n")},createLayer:function(b){var c="R"===b?a.Selection.Layer.Rside:a.Selection.Layer.Lside,d=this._getLayer(b);return d&&d.destroy?d.destroy():null,d=this.createView(c,{grid:this.grid,columnWidthList:this.grid.dimensionModel.getColumnWidthList(b)}),"R"===b?this.rside=d:this.lside=d,d},selectAll:function(){this.startSelection(0,0),this.updateSelection(this.grid.dataModel.length-1,this.grid.columnModel.getVisibleColumnModelList().length-1)},startSelection:function(a,b){this.range.row[0]=this.range.row[1]=a,this.range.column[0]=this.range.column[1]=b,this.show()},updateSelection:function(a,b){this.range.row[1]=a,this.range.column[1]=b,this.show()},endSelection:function(){this.range.row[0]=this.range.row[1]=this.range.column[0]=this.range.column[1]=-1,this.spannedRange.row[0]=this.spannedRange.row[1]=this.spannedRange.column[0]=this.spannedRange.column[1]=-1,this.hide()},show:function(){if(this.hasSelection()){this._isShown=!0;var a,b=this.grid.columnModel.get("columnFixIndex"),c=(this.grid.dimensionModel.get("rowHeight"),Math.min.apply(Math,this.range.row)),d=Math.max.apply(Math,this.range.row),e=Math.min.apply(Math,this.range.column),f=Math.max.apply(Math,this.range.column),g={row:[c,d],column:[e,f]};if(!this.grid.isSorted()){a=$.extend([],g.row);do a=$.extend([],g.row),g=this._getRowSpannedIndex(g);while(g.row[0]!==a[0]||g.row[1]!==a[1])}this.spannedRange=g,this.lside.show(g),this.rside.show({row:g.row,column:[Math.max(-1,g.column[0]-b),Math.max(-1,g.column[1]-b)]})}},hide:function(){this._isShown=!1,this.lside.hide(),this.rside.hide()},isShown:function(){return this._isShown},_getLayer:function(a){return"R"===a?this.rside:this.lside},_getContainerPosition:function(a,b){var c=this.grid.dimensionModel,d=a-c.get("offsetLeft"),e=b-(c.get("offsetTop")+c.get("headerHeight")+2);return{pageX:d,pageY:e}},_onSelectStart:function(a){a.preventDefault()},hasSelection:function(){return!(-1===this.range.row[0])},_getRowSpannedIndex:function(a){function b(a){var b,c=a.startIndex,e=a.endIndex,f=a.startRowSpanDataMap&&a.startRowSpanDataMap[d],g=a.startIndexList,h=a.endIndexList;f&&(f.isMainRow?(b=c+f.count-1,b>e&&h.push(b)):(b=c+f.count,g.push(b)))}function c(a){var b,c,d=a.endIndex,e=a.columnName,f=a.endRowSpanDataMap&&a.endRowSpanDataMap[e],g=a.endIndexList,h=a.dataModel;f&&(f.isMainRow?(b=d+f.count-1,g.push(b)):(b=d+f.count,c=h.at(b).getRowSpanData(e),b+=c.count-1,b>d&&g.push(b)))}for(var d,e,f=this.grid.columnModel.get("columnModelList").slice(a.column[0],a.column[1]+1),g=this.grid.dataModel,h=f.length,i=[a.row[0]],j=[a.row[1]],k=g.at(a.row[0]).getRowSpanData(),l=g.at(a.row[1]).getRowSpanData(),m=$.extend({},a),n=0;h>n;n++)d=f[n].columnName,e={columnName:d,startIndex:a.row[0],endIndex:a.row[1],endRowSpanDataMap:l,startRowSpanDataMap:k,startIndexList:i,endIndexList:j,dataModel:g},b(e),c(e);return m.row=[Math.min.apply(Math,i),Math.max.apply(Math,j)],m}}),a.Selection.Layer=a.Base.extend({tagName:"div",className:"selection_layer",initialize:function(b){a.Base.prototype.initialize.apply(this,arguments),this.listenTo(this.grid.renderModel,"change:scrollTop",this._onScrollTopChange,this),this.listenTo(this.grid.renderModel,"beforeRefresh",this._onBeforeRefresh,this),this.listenTo(this.grid.dimensionModel,"columnWidthChanged",this._updateColumnWidthList,this),this.setOwnProperties({columnWidthList:b.columnWidthList,spannedRange:{row:[-1,-1],column:[-1,-1]},whichSide:"R"})},_updateColumnWidthList:function(){this.columnWidthList=this.grid.dimensionModel.getColumnWidthList(this.whichSide)},_onScrollTopChange:function(){},_onBeforeRefresh:function(){},_getGeometryStyles:function(a){a=a||this.indexObj;var b,c,d=this.columnWidthList,f=a.row,g=a.column,h=this.grid.dimensionModel.get("rowHeight"),i=e.getTBodyHeight(f[0],h)+1,j=e.getTBodyHeight(f[1]-f[0]+1,h)-3,k=d.length,l="block",m=0,n=0;for(c=0;c<g[1]+1&&k>c;c++)c<g[0]?m+=d[c]+1:n+=d[c]+1;return n-=1,(0>=n||0>=j)&&(l="none"),b={display:l,width:n+"px",height:j+"px",top:i+"px",left:m+"px"}},show:function(a){this.indexObj=a,this.$el.css(this._getGeometryStyles(a))},hide:function(){this.$el.css({display:"none",width:"0px",height:"0px",top:0,left:0})},render:function(){return this}}),a.Selection.Layer.Lside=a.Selection.Layer.extend({initialize:function(){a.Selection.Layer.prototype.initialize.apply(this,arguments),this.setOwnProperties({whichSide:"L"})}}),a.Selection.Layer.Rside=a.Selection.Layer.extend({initialize:function(){a.Selection.Layer.prototype.initialize.apply(this,arguments),this.setOwnProperties({whichSide:"R"})}});var f=window.Grid=a.Base.extend({scrollBarSize:17,minimumHeight:150,lside:null,rside:null,toolbar:null,cellFactory:null,events:{click:"_onClick",mousedown:"_onMouseDown"},keyMap:{TAB:9,ENTER:13,CTRL:17,ESC:27,LEFT_ARROW:37,UP_ARROW:38,RIGHT_ARROW:39,DOWN_ARROW:40,CHAR_A:65,CHAR_C:67,CHAR_F:70,CHAR_R:82,CHAR_V:86,LEFT_WINDOW_KEY:91,F5:116,BACKSPACE:8,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,HOME:36,END:35,DEL:46,UNDEFINED:229},initialize:function(b){a.Base.prototype.initialize.apply(this,arguments);var c=e.getUniqueKey();this.__instance[c]=this;var d={debug:!1,columnFixIndex:0,columnModelList:[],keyColumnName:null,selectType:"",autoNumbering:!0,headerHeight:35,rowHeight:27,displayRowCount:10,minimumColumnWidth:50,notUseSmartRendering:!1,columnMerge:[],minimumWidth:300,scrollX:!0,scrollY:!0,useDataCopy:!0,toolbar:{hasResizeHandler:!0,hasControlPannel:!0}};b=$.extend(!0,d,b),this.setOwnProperties({cellFactory:null,selection:null,columnModel:null,dataModel:null,renderModel:null,layoutModel:null,focusModel:null,view:{lside:null,rside:null,toolbar:null,clipboard:null},id:c,options:b,timeoutIdForResize:0}),this._initializeModel(),this._initializeListener(),this._initializeView(),this._initializeScrollBar(),this._attachExtraEvent(),this.render(),this.updateLayoutData()},_attachExtraEvent:function(){$(window).on("resize",$.proxy(this._onWindowResize,this))},_onWindowResize:function(){clearTimeout(this.timeoutIdForResize),this.timeoutIdForResize=setTimeout($.proxy(function(){var a=Math.max(this.option("minimumWidth"),this.$el.css("width","100%").width());this.dimensionModel.set("width",a)},this),100)},_initializeListener:function(){this.listenTo(this.dimensionModel,"change:width",this._onWidthChange),this.listenTo(this.dimensionModel,"change:bodyHeight",this._setHeight)},updateLayoutData:function(){var a=this.$el.offset(),b=this.dimensionModel.getTotalWidth("R"),c=b-this.dimensionModel.get("rsideWidth");this.renderModel.set({maxScrollLeft:c}),this.dimensionModel.set({offsetTop:a.top,offsetLeft:a.left,width:this.$el.width(),height:this.$el.height(),toolbarHeight:this.view.toolbar.$el.height()})},_onWidthChange:function(){this.updateLayoutData()},option:function(a,b){return void 0===b?this.options[a]:(this.options[a]=b,this)},_onClick:function(a){var b=$(a.target);!(b.is("input")||b.is("a")||b.is("button")||b.is("select")||b.is("label"))},_onMouseDown:function(a){var b=$(a.target);b.is("input")||b.is("a")||b.is("button")||b.is("select")||(a.preventDefault(),this.focusClipboard(),this.selection.show())},focusClipboard:function(){this.view.clipboard.$el.focus()},_initializeModel:function(){var d=this.$el.offset();this.columnModel=new c.ColumnModel({grid:this,keyColumnName:this.option("keyColumnName"),columnFixIndex:this.option("columnFixIndex")}),this.setColumnModelList(this.option("columnModelList")),this.dimensionModel=new b.Dimension({grid:this,offsetTop:d.top,offsetLeft:d.left,width:this.$el.width(),height:this.$el.height(),headerHeight:this.option("headerHeight"),rowHeight:this.option("rowHeight")}),this.focusModel=new b.Focus({grid:this}),this.dataModel=new c.RowList({grid:this}),this.renderModel=this.option("notUseSmartRendering")===!0?new b.Renderer({grid:this}):new b.Renderer.Smart({grid:this}),this.cellFactory=this.createView(a.CellFactory,{grid:this})},_initializeView:function(){this.cellFactory=this.createView(a.CellFactory,{grid:this}),this.selection=this.createView(a.Selection,{grid:this}),this.view.lside=this.createView(a.Layout.Frame.Lside,{grid:this}),this.view.rside=this.createView(a.Layout.Frame.Rside,{grid:this}),this.view.toolbar=this.createView(a.Layout.Toolbar,{grid:this}),this.view.clipboard=this.createView(a.Clipboard,{grid:this})},_initializeScrollBar:function(){},render:function(){this.trigger("beforeRender"),this.$el.attr("instanceId",this.id).append(this.view.lside.render().el).append(this.view.rside.render().el).append(this.view.toolbar.render().el).append(this.view.clipboard.render().el),this._setHeight(),this.trigger("afterRender")},_setHeight:function(){var a=this.dimensionModel.get("bodyHeight"),b=this.dimensionModel.get("headerHeight"),c=this.view.toolbar.$el.height(),d=c+b+a;this.$el.css("height",d+"px"),this.dimensionModel.set({toolbarHeight:c})},isSorted:function(){return this.dataModel.isSortedByField()},isEditable:function(a,b){var c=this.focusModel.which();a=void 0!==a?a:c.rowKey,b=void 0!==b?b:c.columnName;var d,e,f=this.columnModel,g=this.dataModel,h=f.getEditType(b);return h?(d=g.get(a),e=d.getRelationResult()[b],!(e&&(e.isDisabled||e.isEditable===!1))):!1},getCellElement:function(a,b){var c=this.columnModel.isLside(b)?this.view.lside.$el:this.view.rside.$el;return c.find('tr[key="'+a+'"]').find('td[columnname="'+b+'"]')},setRowList:function(a){this.dataModel.set(a,{parse:!0})},setValue:function(a,b,c,d){this.dataModel.setValue(a,b,c,d)},setColumnValue:function(a,b,c){this.dataModel.setColumnValue(a,b,c)},appendRow:function(a){this.dataModel.append(a)},prependRow:function(a){this.dataModel.prepend(a)},setColumnIndex:function(a){this.option({columnFixIndex:a}),this.columnModel.set({columnFixIndex:a})},setColumnModelList:function(a){this.columnModel.set("columnModelList",a)},sort:function(a){this.dataModel.sortByField(a)},getRowList:function(){return this.dataModel.toJSON()},getCheckedRowList:function(){return this.dataModel.where({_button:!0})},getCheckedRowKeyList:function(){var a=[];return _.each(this.dataModel.where({_button:!0}),function(b){a.push(b.get("rowKey"))},this),a},getModifiedRowList:function(){return this.dataModel.getModifiedRowList()},disableCell:function(){},enableCell:function(){},setEditOptionList:function(){},checkRow:function(a){this.setValue(a,"_button",!0)},checkAllRow:function(){this.dataModel.setColumnValue("_button",!0)},uncheckAllRow:function(){this.dataModel.setColumnValue("_button",!1)},focus:function(a,b,c){this.focusModel.focus(a,b,c)},focusAt:function(a,b,c){this.focus(this.dataModel.at(a).get("rowKey"),this.columnModel.at(b).columnName,c)},blur:function(){this.focusModel.blur()},_getDataCollection:function(a){return this.renderModel.get(a)},destroy:function(){this.destroyChildren(),this.$el.removeAttr("instanceId"),this.stopListening();for(var a in this)this[a]=null,delete this[a]}});f.prototype.__instance={},f.getInstanceById=function(a){return this.prototype.__instance[a]},a.Base.extend({})}();